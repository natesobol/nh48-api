<!DOCTYPE html>
<html>
<head>
    <title>Catalog Test</title>
    <style>
        body { font-family: monospace; background: #0a0a0a; color: #fff; padding: 20px; }
        .result { margin: 20px 0; padding: 10px; background: #1a1a1a; border-radius: 5px; }
        .success { border-left: 4px solid #22c55e; }
        .error { border-left: 4px solid #ef4444; }
    </style>
</head>
<body>
    <h1>Catalog JSON Parse Test</h1>
    <div id="results"></div>

    <script>
        const API_URLS = [
            'https://cdn.jsdelivr.net/gh/natesobol/nh48-api@main/data/nh48.json',
            'https://raw.githubusercontent.com/natesobol/nh48-api/main/data/nh48.json'
        ];

        function cleanJSON(raw){
            // Remove contentReference annotations
            let cleaned = raw.replace(/:contentReference\[.*?\]\{index=\d+\}/g, '');
            // Remove comments that look like: /* ... omitted */
            cleaned = cleaned.replace(/\/\*\s*Lines?\s+\d+[\d\-,\s]*omitted\s*\*\//g, '');
            return cleaned;
        }

        async function test() {
            const results = document.getElementById('results');
            
            for (let i = 0; i < API_URLS.length; i++) {
                const url = API_URLS[i];
                const div = document.createElement('div');
                div.className = 'result';
                
                try {
                    const res = await fetch(url);
                    if (!res.ok) {
                        div.className += ' error';
                        div.innerHTML = `<strong>Attempt ${i+1}: ${url}</strong><br>Status: ${res.status} ${res.statusText}`;
                        results.appendChild(div);
                        continue;
                    }
                    
                    const text = await res.text();
                    const cleaned = cleanJSON(text);
                    
                    let obj;
                    try {
                        obj = JSON.parse(cleaned);
                    } catch (err) {
                        div.className += ' error';
                        div.innerHTML = `<strong>Attempt ${i+1}: ${url}</strong><br>Parse Error: ${err.message}`;
                        results.appendChild(div);
                        continue;
                    }
                    
                    const peaks = Object.keys(obj);
                    const peaksWithPhotos = peaks.filter(slug => {
                        const p = obj[slug];
                        return p.photos && Array.isArray(p.photos) && p.photos.length > 0;
                    });
                    
                    div.className += ' success';
                    div.innerHTML = `
                        <strong>âœ“ Attempt ${i+1}: ${url}</strong><br>
                        Total peaks: ${peaks.length}<br>
                        Peaks with photos: ${peaksWithPhotos.length}<br>
                        <details>
                            <summary>Peaks with photos:</summary>
                            ${peaksWithPhotos.map(slug => {
                                const p = obj[slug];
                                const first = p.photos[0];
                                const url = typeof first === 'string' ? first : (first?.url || 'NO URL');
                                return `<div>${p.peakName || slug}: ${p.photos.length} photo(s), first URL: ${url.substring(0, 70)}...</div>`;
                            }).join('')}
                        </details>
                    `;
                    results.appendChild(div);
                    return; // Success!
                    
                } catch (err) {
                    div.className += ' error';
                    div.innerHTML = `<strong>Attempt ${i+1}: ${url}</strong><br>Error: ${err.message}`;
                    results.appendChild(div);
                }
            }
        }
        
        test();
    </script>
</body>
</html>
