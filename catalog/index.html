<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Browse the NH48 Peak Catalog with elevation, prominence, range, difficulty and photo thumbnails for all 48 four-thousand-foot peaks in New Hampshire. Search, filter and sort using this open dataset. Open API and datasets for New Hampshire’s 4,000-foot mountains.">
    <meta name="keywords" content="NH48 API, New Hampshire 4000 footers, peak catalog, White Mountains data, hiking database, open hiking API, peak metadata, mountain photos, NH 48 peaks dataset, White Mountain peak list, open source hiking API">
    <meta name="robots" content="index,follow">
    <link rel="canonical" href="https://nh48.info/catalog">
    <link rel="alternate" hreflang="en" href="https://nh48.info/">
    <link rel="alternate" hreflang="es" href="https://nh48.info/i18n/es.html">
    <link rel="alternate" hreflang="fr" href="https://nh48.info/i18n/fr.html">
    <link rel="alternate" hreflang="de" href="https://nh48.info/i18n/de.html">
    <link rel="alternate" hreflang="zh" href="https://nh48.info/i18n/zh.html">
    <link rel="alternate" hreflang="zh-Hans" href="https://nh48.info/i18n/zh-Hans.html">
    <link rel="alternate" hreflang="ja" href="https://nh48.info/i18n/ja.html">
    <link rel="alternate" hreflang="ar" href="https://nh48.info/i18n/ar.html">
    <link rel="alternate" hreflang="hi-IN" href="https://nh48.info/i18n/hi.html">
    <link rel="alternate" hreflang="pt" href="https://nh48.info/i18n/pt.html">
    <link rel="alternate" hreflang="ru" href="https://nh48.info/i18n/ru.html">
    <link rel="alternate" hreflang="id" href="https://nh48.info/i18n/id.html">
    <link rel="alternate" hreflang="it" href="https://nh48.info/i18n/it.html">
    <link rel="alternate" hreflang="ko" href="https://nh48.info/i18n/ko.html">
    <link rel="alternate" hreflang="tr" href="https://nh48.info/i18n/tr.html">
    <link rel="alternate" hreflang="vi" href="https://nh48.info/i18n/vi.html">
    <link rel="alternate" hreflang="pl" href="https://nh48.info/i18n/pl.html">
    <link rel="alternate" hreflang="x-default" href="https://nh48.info/">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://nh48.info/catalog">
    <meta property="og:title" content="NH48 Peak Catalog – Data &amp; photos for New Hampshire’s 4000-footers">
    <meta property="og:description" content="Browse the NH48 Peak Catalog with elevation, prominence, range, difficulty and photo thumbnails for all 48 four-thousand-foot peaks in New Hampshire. Search, filter and sort using this open dataset. Open API and datasets for New Hampshire’s 4,000-foot mountains.">
    <meta property="og:image" content="https://nh48.info/nh48-preview.png">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="https://nh48.info/catalog">
    <meta name="twitter:title" content="NH48 Peak Catalog – Data &amp; photos for New Hampshire's 4000-footers">
    <meta name="twitter:description" content="Browse the NH48 Peak Catalog with elevation, prominence, range, difficulty and photo thumbnails for all 48 four-thousand-foot peaks in New Hampshire. Search, filter and sort using this open dataset. Open API and datasets for New Hampshire’s 4,000-foot mountains.">
    <meta name="twitter:image" content="https://nh48.info/nh48-preview.png">
    
    <title>NH48 Peak Catalog – Data &amp; photos for New Hampshire’s 4000-footers</title>
    <link rel="icon" type="image/png" href="../nh48API_logo.png">
    <link rel="stylesheet" href="../css/nh48_catalog.css">
    <link rel="stylesheet" href="/css/quick-browse-footer.css">
    <script type="module" src="../js/i18n.js"></script>
    <script>
      (function redirectToApp() {
        const host = location.hostname;

        const isPreviewHost =
          host === "localhost" ||
          host === "127.0.0.1" ||
          host.includes("github") ||
          host.endsWith("githubpreview.dev");

        if (isPreviewHost) {
          return;
        }

        const target = "https://nh48.info/pages/nh48_catalog.html";
        const ua = (typeof navigator !== "undefined" && navigator.userAgent) || "";
        const botSignatures = [
          "adsbot-google",
          "ahrefsbot",
          "applebot",
          "baiduspider",
          "bingbot",
          "bingpreview",
          "chatgpt",
          "claudebot",
          "duckduckbot",
          "exabot",
          "facebookexternalhit",
          "facebot",
          "gptbot",
          "google-inspectiontool",
          "googlebot",
          "ia_archiver",
          "linkedinbot",
          "mediapartners-google",
          "petalbot",
          "redditbot",
          "semrushbot",
          "slurp",
          "sogou",
          "twitterbot",
          "yandex"
        ];
        const uaLower = ua.toLowerCase();
        const isKnownBot = botSignatures.some((signature) => uaLower.includes(signature));
        const shouldRedirect = !isKnownBot && typeof window !== "undefined" && target && window.location.href !== target;

        if (shouldRedirect) {
          window.location.replace(target);
        }
      })();
    </script>
<noscript>
      <p>
        JavaScript is required to continue.
        <a href="https://nh48.info/pages/nh48_catalog.html">Continue</a>
      </p>
    </noscript>

    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "Dataset",
        "name": "NH48 API – New Hampshire 4000-Footers Data",
        "description": "Structured data and photos for the 48 four-thousand-foot peaks of the White Mountain National Forest, including elevation, prominence, difficulty, routes and rich photo metadata.",
        "url": "https://nh48.info/",
        "license": "https://creativecommons.org/licenses/by/4.0/",
        "creator": {
          "@type": "Person",
          "name": "Nathan Sobol",
          "url": "https://www.nh48pics.com/"
        },
        "keywords": ["NH48", "White Mountains", "4000 footers", "hiking data", "peak metadata", "photo metadata", "open dataset"],
        "distribution": {
          "@type": "DataDownload",
          "contentUrl": "https://cdn.jsdelivr.net/gh/natesobol/nh48-api@main/data/nh48.json",
          "encodingFormat": "application/json"
        },
        "temporalCoverage": "2025-12-06/2025-12-06",
        "spatialCoverage": {
          "@type": "Place",
          "name": "White Mountain National Forest",
          "geo": {"@type": "GeoShape", "circle": "44.15 -71.34 50km"}
        }
      }
    </script>
    <!--
      Enhanced catalog page for the NH48 peak list.

      This version adds:
        • Larger cards in a 2-column layout.
        • Sort-by dropdown covering all general info API fields.
        • A two-tier filter: 1) choose field, 2) choose value (Range, Difficulty, Trail Type, Exposure).
        • Cards display the same "General Peak Info" as the details page.
    -->
  </head>
  <body data-route="catalog" data-page="catalog">
    <div id="nav-placeholder"></div>
    <script>
      document.addEventListener('DOMContentLoaded', () => {
        const navPlaceholder = document.getElementById('nav-placeholder');
        const footerPlaceholder = document.getElementById('footer-placeholder');
        const activeRoute = document.body.dataset.route || document.body.dataset.page;

        if (navPlaceholder) {
          fetch('/pages/nav.html')
            .then(response => response.text())
            .then(html => {
              navPlaceholder.innerHTML = html;
              const links = navPlaceholder.querySelectorAll('.site-nav-links a');
              links.forEach(link => {
                const routes = (link.dataset.routes || link.dataset.route || '')
                  .split(',')
                  .map(value => value.trim())
                  .filter(Boolean);

                if (routes.includes(activeRoute)) {
                  link.classList.add('active');
                  link.setAttribute('aria-current', 'page');
                }
              });
            })
            .catch(err => console.error('Failed to load navigation:', err));
        }

        if (footerPlaceholder) {
          fetch('/pages/footer.html')
            .then(response => response.text())
            .then(html => {
              footerPlaceholder.innerHTML = html;
            })
            .catch(err => console.error('Failed to load footer:', err));
        }
      });
    </script>
    <div class="wrap">
      <header>
        <h1 data-i18n="catalog.title">NH48 Peak Catalog</h1>
        <p data-i18n="catalog.intro">Explore all forty-eight of New Hampshire’s 4,000-footers in one interactive catalog. Click any peak to view detailed summit info, routes, difficulty, and photos w/ creator metadata.</p>
      </header>

      <!-- search with datalist for suggestions -->
      <div class="search">
        <input type="text" id="searchInput" list="nameSuggestions" data-i18n="catalog.search" data-i18n-attr="placeholder,aria-label" placeholder="Search peaks by name…" aria-label="Search peaks by name" />
        <datalist id="nameSuggestions"></datalist>
      </div>

      <!-- controls for sorting, filtering, and columns (desktop only) -->
      <div class="controls">
        <div class="control">
          <label for="sortSelect" data-i18n="catalog.sort.label">Sort by:</label>
          <select id="sortSelect" data-i18n="catalog.sort" data-i18n-attr="aria-label" aria-label="Sort peaks by attribute">
            <option value="name" data-i18n="catalog.sort.name">Name (A–Z)</option>
            <option value="elev-asc" data-i18n="catalog.sort.elevAsc">Elevation ↑</option>
            <option value="elev-desc" data-i18n="catalog.sort.elevDesc">Elevation ↓</option>
            <option value="prom-asc" data-i18n="catalog.sort.promAsc">Prominence ↑</option>
            <option value="prom-desc" data-i18n="catalog.sort.promDesc">Prominence ↓</option>
            <option value="difficulty-asc" data-i18n="catalog.sort.diffAsc">Difficulty A–Z</option>
            <option value="difficulty-desc" data-i18n="catalog.sort.diffDesc">Difficulty Z–A</option>
            <option value="range-asc" data-i18n="catalog.sort.rangeAsc">Range A–Z</option>
            <option value="trail-asc" data-i18n="catalog.sort.trailAsc">Trail Type A–Z</option>
            <option value="exposure-asc" data-i18n="catalog.sort.exposureAsc">Exposure A–Z</option>
          </select>
        </div>

        <div class="control">
          <label for="unitsSelect" data-i18n="common.unitsLabel">Units:</label>
          <select id="unitsSelect" data-i18n-attr="aria-label" data-i18n="common.units" aria-label="Select units">
            <option value="feet" data-i18n="common.unitsFeet">Feet</option>
            <option value="meters" data-i18n="common.unitsMeters">Meters</option>
          </select>
        </div>

        <!-- Column selector -->
        <div class="control column-selector-control">
          <label for="columnSelect" data-i18n="catalog.columns.label">Columns:</label>
          <select id="columnSelect" data-i18n="catalog.columns" data-i18n-attr="aria-label" aria-label="Select number of catalog columns">
            <option value="2">2</option>
            <option value="3" selected>3</option>
            <option value="4">4</option>
            <option value="5">5</option>
          </select>
        </div>
        <div class="control">
          <label for="viewSelect">View:</label>
          <select id="viewSelect" aria-label="Select catalog view">
            <option value="grid" selected>Grid</option>
            <option value="list">List</option>
          </select>
        </div>
        <div class="control api-variables-control">
          <label for="apiVariablesToggle">API Variables</label>
          <input type="checkbox" id="apiVariablesToggle" aria-label="Toggle API variable labels">
        </div>
        <div class="control nh48-lang-control">
          <div class="nh48-lang" id="langPicker" data-i18n="common.languagePicker" data-i18n-attr="aria-label" aria-label="Language picker"></div>
        </div>
      </div>

      <div id="catalogLoading" class="loading-indicator" aria-live="polite">
        <span class="loading-spinner" aria-hidden="true"></span>
        <span class="loading-text" data-i18n="common.loading">Loading…</span>
      </div>
      <div id="grid" class="grid"></div>
      <nav id="pagination" class="pagination"></nav>
      <div id="emptyMessage" class="empty" data-i18n="catalog.empty" hidden>No peaks found.</div>
    </div>

    <script>
      // API endpoints to attempt in order.
      const API_URLS = [
        'https://cdn.jsdelivr.net/gh/natesobol/nh48-api@main/data/nh48.json',
        'https://raw.githubusercontent.com/natesobol/nh48-api/main/data/nh48.json'
      ];
      const PHOTO_BASE_URL = 'https://photos.nh48.info';
      const PHOTO_PATH_PREFIX = '/nh48-photos/';

      const t = (key, vars) => (window.NH48_I18N && window.NH48_I18N.t ? window.NH48_I18N.t(key, vars) : key);

      const trackEvent = (name, params = {}) => {
        const analytics = window.NH48_INFO_ANALYTICS;
        if (analytics && analytics.logEvent && analytics.analytics) {
          analytics.logEvent(analytics.analytics, name, {
            page: location.pathname,
            ...params
          });
        }
      };

      function getPlaceholder() {
        return 'data:image/svg+xml;utf8,' + encodeURIComponent(
          `<svg xmlns="http://www.w3.org/2000/svg" width="1200" height="800"><rect width="100%" height="100%" fill="#172032"/><text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle" fill="#64748b" font-family="system-ui" font-size="22">${t('common.noImage')}</text></svg>`
        );
      }

      function normalizePhotoUrl(url){
        if(!url) return url;
        if(url.startsWith(PHOTO_BASE_URL)) return url;
        const isJsdelivrPhoto = url.includes('cdn.jsdelivr.net/gh/natesobol/nh48-api@main/photos/');
        const isGithubRawPhoto = url.includes('raw.githubusercontent.com/natesobol/nh48-api/main/photos/');
        const isR2PathStyle = url.includes('r2.cloudflarestorage.com/nh48-photos/');
        const isR2BucketHost = url.includes('r2.cloudflarestorage.com/') && !url.includes('/nh48-photos/');
        if(isR2PathStyle){
          const [, tail] = url.split(PHOTO_PATH_PREFIX);
          return tail ? `${PHOTO_BASE_URL}/${tail}` : url;
        }
        if(isR2BucketHost){
          const bucketTail = url.split('r2.cloudflarestorage.com/')[1];
          if(bucketTail){
            const normalizedTail = bucketTail.replace(/^nh48-photos\//, '');
            return `${PHOTO_BASE_URL}/${normalizedTail}`;
          }
        }
        if(isJsdelivrPhoto || isGithubRawPhoto){
          const [, tail] = url.split('/photos/');
          return tail ? `${PHOTO_BASE_URL}/${tail}` : url;
        }
        return url;
      }

      // Pagination
      const ITEMS_PER_PAGE = 30;
      let currentPage = 1;

      let peaks = [];
      let activeSort = 'name';

      const UNIT_STORAGE_KEY = 'nh48_units';
      const API_VARIABLES_STORAGE_KEY = 'nh48-catalog-api-variables';
      const UNITS = {
        FEET: 'feet',
        METERS: 'meters'
      };
      let currentUnits = UNITS.FEET;
      let showApiVariables = false;

      const FRIENDLY_LABELS = {
        elevation: 'catalog.card.elevation',
        prominence: 'catalog.card.prominence',
        range: 'catalog.card.range',
        trailType: 'catalog.card.trailType',
        difficulty: 'catalog.card.difficulty',
        exposure: 'catalog.card.exposure'
      };

      const FRIENDLY_LABEL_TEXT = {
        elevation: 'Elevation',
        prominence: 'Prominence',
        range: 'Range',
        trailType: 'Trail Type',
        difficulty: 'Difficulty',
        exposure: 'Exposure'
      };

      const API_LABELS = {
        elevation: 'Elevation (ft)',
        prominence: 'Prominence (ft)',
        range: 'Range / Subrange',
        trailType: 'Trail Type',
        difficulty: 'Difficulty',
        exposure: 'Exposure Level'
      };

      function getCatalogLabel(key){
        if(showApiVariables){
          return API_LABELS[key] || key;
        }
        const i18nKey = FRIENDLY_LABELS[key];
        if(i18nKey){
          const translated = t(i18nKey);
          if(translated && !translated.startsWith('catalog.') && !translated.includes('card.')){
            return translated;
          }
        }
        return FRIENDLY_LABEL_TEXT[key] || key;
      }

      function cleanJSON(raw){
        let cleaned = raw.replace(/:contentReference\[.*?\]\{index=\d+\}/g, '');
        cleaned = cleaned.replace(/\/\*\s*Lines?\s+\d+[\d\-,\s]*omitted\s*\*\//g, '');
        return cleaned;
      }

      async function fetchPeaks(){
        for(let i=0;i<API_URLS.length;i++){
          const url = API_URLS[i];
          try{
            const res = await fetch(url, { mode:'cors' });
            if(!res.ok){
              console.log(`Attempt ${i+1}: Status ${res.status} ${res.statusText}`);
              continue;
            }
            const text = await res.text();
            const cleaned = cleanJSON(text);
            let obj;
            try{
              obj = JSON.parse(cleaned);
            }catch(err){
              console.error(`JSON parse error: ${err.message}`);
              continue;
            }
            const arr = Object.keys(obj).map(slug => {
              const p = obj[slug] || {};
              p.slug = slug;
              p.peakName = p.peakName || p['Peak Name'] || slug;
              return p;
            });
            console.log(`Loaded ${arr.length} peaks from ${url}`);
            trackEvent('catalog_data_loaded', { source: url, count: arr.length });
            return arr;
          }catch(err){
            console.error(`Fetch error: ${err.message || err}`);
            trackEvent('catalog_data_fetch_error', { source: url });
          }
        }
        throw new Error('All API endpoints failed');
      }

      function normalizeToken(value){
        return String(value || '').trim().toLowerCase();
      }

      function translateSeason(value){
        const key = normalizeToken(value);
        const map = {
          spring: 'season.spring',
          summer: 'season.summer',
          fall: 'season.fall',
          autumn: 'season.autumn',
          winter: 'season.winter'
        };
        return map[key] ? t(map[key]) : value;
      }

      function translateTimeOfDay(value){
        const key = normalizeToken(value);
        const map = {
          sunrise: 'time.sunrise',
          sunset: 'time.sunset',
          morning: 'time.morning',
          afternoon: 'time.afternoon',
          evening: 'time.evening',
          night: 'time.night',
          day: 'time.day',
          dawn: 'time.dawn',
          dusk: 'time.dusk'
        };
        return map[key] ? t(map[key]) : value;
      }

      const TRAIL_TYPE_TRANSLATIONS = {
        'Loop': 'values.trailType.loop',
        'Loop or Out & back': 'values.trailType.loop_or_out_back',
        'Loop or traverse': 'values.trailType.loop_or_traverse',
        'Loop or traverse along ridge': 'values.trailType.loop_or_traverse_along_ridge',
        'Out & back': 'values.trailType.out_back',
        'Out & back  - common.': 'values.trailType.out_back_common',
        'Out & back  - common. or long traverse': 'values.trailType.out_back_common_or_long_traverse',
        'Out & back  - common. or loop with connector trails': 'values.trailType.out_back_common_or_loop_with_connector_trails',
        'Out & back  - common. or small loop including Mt Webster': 'values.trailType.out_back_common_or_small_loop_including_mt_webster',
        'Out & back  - commonly.': 'values.trailType.out_back_commonly',
        'Out & back or loop': 'values.trailType.out_back_or_loop',
        'Out & back or loop  - with Tom and Willey.': 'values.trailType.out_back_or_loop_with_tom_and_willey',
        'Out & back or loop combining trails': 'values.trailType.out_back_or_loop_combining_trails',
        'Out & back or loop options': 'values.trailType.out_back_or_loop_options',
        'Out & back or point-to-point traverse': 'values.trailType.out_back_or_point_to_point_traverse',
        'Out & back or traverse': 'values.trailType.out_back_or_traverse'
      };

      const DIFFICULTY_TRANSLATIONS = {
        'Moderate': 'values.difficulty.moderate',
        'Moderate/Difficult': 'values.difficulty.moderate_difficult',
        'Difficult': 'values.difficulty.difficult',
        'Very Difficult': 'values.difficulty.very_difficult',
        'Very difficult': 'values.difficulty.very_difficult',
        'Extremely Difficult': 'values.difficulty.extremely_difficult'
      };

      function translateTrailType(value){
        if(!value || showApiVariables) return value;
        const raw = String(value);
        const key = raw.startsWith('values.trailType.') ? raw : TRAIL_TYPE_TRANSLATIONS[raw];
        if(!key) return value;
        const translated = t(key);
        return translated && translated !== key && !translated.startsWith('values.') ? translated : value;
      }

      function translateDifficulty(value){
        if(!value || showApiVariables) return value;
        const raw = String(value);
        const key = raw.startsWith('values.difficulty.') ? raw : DIFFICULTY_TRANSLATIONS[raw];
        if(!key) return value;
        const translated = t(key);
        return translated && translated !== key && !translated.startsWith('values.') ? translated : value;
      }

      function translateExposure(value){
        if(!value || showApiVariables) return value;
        const trimmed = String(value).trim();
        if(trimmed.startsWith('values.exposure.')){
          const translated = t(trimmed);
          if(translated && translated !== trimmed && !translated.startsWith('values.exposure')){
            return translated;
          }
          return value;
        }
        const match = trimmed.match(/^(Low to Medium|Low|Medium|High)/i);
        if(!match) return value;
        const normalized = match[1].toLowerCase().replace(/\s+/g, '_');
        const translated = t(`values.exposure.${normalized}`);
        if(!translated || translated.startsWith('values.exposure')) return value;
        return trimmed.replace(match[1], translated);
      }

      function formatElevation(value){
        if(value === undefined || value === null || value === '') return '—';
        const num = Number(value);
        if(!Number.isFinite(num)) return '—';
        if(currentUnits === UNITS.METERS){
          return `${Math.round(num * 0.3048)} m`;
        }
        return `${num} ft`;
      }

      function formatProminence(value){
        return formatElevation(value);
      }

      function setUnits(units, { persist = true } = {}){
        if(!Object.values(UNITS).includes(units)){
          units = UNITS.FEET;
        }
        currentUnits = units;
        const select = document.getElementById('unitsSelect');
        if(select){
          select.value = units;
        }
        if(persist){
          localStorage.setItem(UNIT_STORAGE_KEY, units);
        }
      }

      function setApiVariableLabels(enabled, { persist = true } = {}){
        showApiVariables = Boolean(enabled);
        const toggle = document.getElementById('apiVariablesToggle');
        if(toggle){
          toggle.checked = showApiVariables;
        }
        if(persist){
          localStorage.setItem(API_VARIABLES_STORAGE_KEY, showApiVariables ? 'true' : 'false');
        }
      }

      function syncUnitsWithLanguage(lang){
        if(lang && lang !== 'en'){
          setUnits(UNITS.METERS, { persist: false });
        }else{
          setUnits(UNITS.FEET, { persist: false });
        }
      }

      function setCatalogLoading(isLoading){
        const loadingEl = document.getElementById('catalogLoading');
        const grid = document.getElementById('grid');
        if(loadingEl){
          loadingEl.hidden = !isLoading;
        }
        if(grid){
          grid.hidden = isLoading;
        }
      }

      function buildPhotoAlt(p, photo){
        if(photo && typeof photo === 'object'){
          const explicit = photo.alt && String(photo.alt).trim();
          if(explicit){
            return explicit;
          }
          const season = photo.season ? translateSeason(photo.season) : '';
          const timeOfDay = photo.timeOfDay ? translateTimeOfDay(photo.timeOfDay) : '';
          const text = t('photo.altTemplate', {
            peak: p.peakName,
            season: season ? `${season}` : '',
            timeOfDay: timeOfDay ? `${timeOfDay}` : ''
          }).replace(/\s+/g, ' ').replace(/\s—\s$/, '').trim();
          return text.replace(/\s—\s$/, '').replace(/\s$/, '').replace(/—\s*$/, '').trim();
        }
        return t('photo.altTemplate', { peak: p.peakName, season: '', timeOfDay: '' }).replace(/\s+/g, ' ').replace(/\s—\s$/, '').trim();
      }

      function createCard(p){
        const card = document.createElement('article');
        card.className = 'card';

        // Thumbnail
        const placeholder = getPlaceholder();
        let thumbSrc = placeholder;
        let thumbAlt = t('photo.altTemplate', { peak: p.peakName, season: '', timeOfDay: '' }).replace(/\s+/g, ' ').replace(/\s—\s$/, '').trim();
        if (Array.isArray(p.photos) && p.photos.length > 0) {
          const first = p.photos[0];
          thumbAlt = buildPhotoAlt(p, first);
          if (typeof first === 'string') {
            thumbSrc = normalizePhotoUrl(first);
          } else if (first && first.url) {
            thumbSrc = normalizePhotoUrl(first.url);
          }
        }

        const elev = p['Elevation (ft)'];
        const prom = p['Prominence (ft)'];
        const range = p['Range / Subrange'] || '—';
        const trail = translateTrailType(p['Trail Type']) || '—';
        const difficulty = translateDifficulty(p['Difficulty']) || '—';
        const exposure = translateExposure(p['Exposure Level'] || p['Weather Exposure Rating']) || '—';

        const dataSrc = thumbSrc !== placeholder ? thumbSrc : '';
        card.innerHTML = `
          <div class="thumb">
            <img src="${placeholder}" ${dataSrc ? `data-src="${dataSrc}"` : ''} alt="${thumbAlt}" loading="lazy" decoding="async">
          </div>
          <div class="body">
            <h3>${p.peakName}</h3>
            <div class="card-meta">
              <div class="meta-row"><span class="meta-label">${getCatalogLabel('elevation')}</span><span class="meta-value">${formatElevation(elev)}</span></div>
              <div class="meta-row"><span class="meta-label">${getCatalogLabel('prominence')}</span><span class="meta-value">${formatProminence(prom)}</span></div>
              <div class="meta-row"><span class="meta-label">${getCatalogLabel('range')}</span><span class="meta-value">${range}</span></div>
              <div class="meta-row"><span class="meta-label">${getCatalogLabel('trailType')}</span><span class="meta-value">${trail}</span></div>
              <div class="meta-row"><span class="meta-label">${getCatalogLabel('difficulty')}</span><span class="meta-value">${difficulty}</span></div>
              <div class="meta-row"><span class="meta-label">${getCatalogLabel('exposure')}</span><span class="meta-value">${exposure}</span></div>
            </div>
          </div>`;

        card.addEventListener('click', () => {
          trackEvent('catalog_peak_open', { slug: p.slug, name: p.peakName });
          window.location.href = `/peaks/${encodeURIComponent(p.slug)}/`;
        });

        return card;
      }

      function createListItem(p){
        const item = document.createElement('article');
        item.className = 'list-item';

        const placeholder = getPlaceholder();
        let thumbSrc = placeholder;
        let thumbAlt = t('photo.altTemplate', { peak: p.peakName, season: '', timeOfDay: '' }).replace(/\s+/g, ' ').replace(/\s—\s$/, '').trim();
        if (Array.isArray(p.photos) && p.photos.length > 0) {
          const first = p.photos[0];
          thumbAlt = buildPhotoAlt(p, first);
          if (typeof first === 'string') {
            thumbSrc = normalizePhotoUrl(first);
          } else if (first && first.url) {
            thumbSrc = normalizePhotoUrl(first.url);
          }
        }

        const elev = p['Elevation (ft)'];
        const range = p['Range / Subrange'] || '—';
        const href = `/peaks/${encodeURIComponent(p.slug)}/`;

        const dataSrc = thumbSrc !== placeholder ? thumbSrc : '';
        item.innerHTML = `
          <div class="list-thumb">
            <img src="${placeholder}" ${dataSrc ? `data-src="${dataSrc}"` : ''} alt="${thumbAlt}" loading="lazy" decoding="async">
          </div>
          <div class="list-content">
            <div class="list-main">
              <h3>${p.peakName}</h3>
              <div class="list-meta">
                <div>
                  <span class="list-label">${getCatalogLabel('elevation')}</span>
                  <span>${formatElevation(elev)}</span>
                </div>
                <div>
                  <span class="list-label">${getCatalogLabel('range')}</span>
                  <span>${range}</span>
                </div>
              </div>
            </div>
            <a class="list-link" href="${href}">View details →</a>
          </div>
        `;

        item.addEventListener('click', () => {
          trackEvent('catalog_peak_open', { slug: p.slug, name: p.peakName });
          window.location.href = href;
        });

        return item;
      }

      function setupLazyLoading(){
        const imgs = Array.from(document.querySelectorAll('img[data-src]'));
        if(imgs.length === 0) return;

        if (!('IntersectionObserver' in window)) {
          imgs.forEach(img => {
            const real = img.getAttribute('data-src');
            if(real){ img.src = real; img.removeAttribute('data-src'); }
          });
          return;
        }

        const observer = new IntersectionObserver((entries, obs) => {
          entries.forEach(entry => {
            if(entry.isIntersecting){
              const img = entry.target;
              const real = img.getAttribute('data-src');
              if(real){ img.src = real; img.removeAttribute('data-src'); }
              obs.unobserve(img);
            }
          });
        }, { rootMargin: '200px' });
        imgs.forEach(img => observer.observe(img));
      }

      function deferInitialImageLoads(){
        requestAnimationFrame(() => {
          requestAnimationFrame(() => {
            setupLazyLoading();
          });
        });
      }

      function renderGrid(list){
        const grid = document.getElementById('grid');
        const empty = document.getElementById('emptyMessage');
        grid.innerHTML = '';
        if(!list || list.length === 0){
          empty.hidden = false;
          return;
        }
        empty.hidden = true;
        list.forEach(p => grid.appendChild(createCard(p)));
        deferInitialImageLoads();
      }

      function renderList(list){
        const grid = document.getElementById('grid');
        const empty = document.getElementById('emptyMessage');
        grid.innerHTML = '';
        if(!list || list.length === 0){
          empty.hidden = false;
          return;
        }
        empty.hidden = true;
        list.forEach(p => grid.appendChild(createListItem(p)));
        deferInitialImageLoads();
      }

      // Build suggestions list, stripping common words
      function updateSuggestions(){
        const list = peaks.map(p => p.peakName.replace(/\b(Mount|Mountain|Peak)\b/gi, '').trim()).filter(Boolean);
        const seen = new Set();
        const unique = [];
        list.forEach(name => {
          const key = name.toLowerCase();
          if(!seen.has(key)){
            seen.add(key);
            unique.push(name);
          }
        });
        const dl = document.getElementById('nameSuggestions');
        dl.innerHTML = unique.sort().map(name => `<option value="${name}"></option>`).join('');
      }

      function sortPeaks(list){
        const arr = list.slice();
        arr.sort((a, b) => {
          switch(activeSort){
            case 'name':
              return (a.peakName || '').localeCompare(b.peakName || '');
            case 'elev-asc':
              return (a['Elevation (ft)'] || 0) - (b['Elevation (ft)'] || 0);
            case 'elev-desc':
              return (b['Elevation (ft)'] || 0) - (a['Elevation (ft)'] || 0);
            case 'prom-asc':
              return (a['Prominence (ft)'] || 0) - (b['Prominence (ft)'] || 0);
            case 'prom-desc':
              return (b['Prominence (ft)'] || 0) - (a['Prominence (ft)'] || 0);
            case 'difficulty-asc':
              return ((a['Difficulty'] || '')).localeCompare((b['Difficulty'] || ''));
            case 'difficulty-desc':
              return ((b['Difficulty'] || '')).localeCompare((a['Difficulty'] || ''));
            case 'range-asc':
              return ((a['Range / Subrange'] || '')).localeCompare((b['Range / Subrange'] || ''));
            case 'trail-asc':
              return ((a['Trail Type'] || '')).localeCompare((b['Trail Type'] || ''));
            case 'exposure-asc':
              return ((a['Exposure Level'] || a['Weather Exposure Rating'] || ''))
                .localeCompare((b['Exposure Level'] || b['Weather Exposure Rating'] || ''));
          }
          return 0;
        });
        return arr;
      }

      // Render pagination controls
      function renderPagination(totalPages){
        const nav = document.getElementById('pagination');
        nav.innerHTML = '';
        if(totalPages <= 1){
          return;
        }
        const makeBtn = (label, page) => {
          const btn = document.createElement('button');
          btn.textContent = label;
          if(page === currentPage){
            btn.disabled = true;
            btn.classList.add('active');
          }
          btn.addEventListener('click', () => {
            currentPage = page;
            trackEvent('catalog_pagination_click', { label, page });
            updateDisplay();
          });
          return btn;
        };
        // First and previous
        nav.appendChild(makeBtn('«', 1));
        nav.appendChild(makeBtn('‹', Math.max(1, currentPage - 1)));
        // Window of pages
        const delta = 2;
        const start = Math.max(1, currentPage - delta);
        const end = Math.min(totalPages, currentPage + delta);
        for(let i=start; i<=end; i++){
          nav.appendChild(makeBtn(i.toString(), i));
        }
        // Next and last
        nav.appendChild(makeBtn('›', Math.min(totalPages, currentPage + 1)));
        nav.appendChild(makeBtn('»', totalPages));
      }

      function updateDisplay(){
        let list = peaks;

        // Search filter from input
        const searchVal = document.getElementById('searchInput').value.trim().toLowerCase();
        if(searchVal){
          list = list.filter(p => p.peakName && p.peakName.toLowerCase().includes(searchVal));
        }

        list = sortPeaks(list);

        // Pagination
        const totalPages = Math.ceil(list.length / ITEMS_PER_PAGE);
        if(currentPage > totalPages){
          currentPage = totalPages || 1;
        }
        const startIdx = (currentPage - 1) * ITEMS_PER_PAGE;
        const endIdx = startIdx + ITEMS_PER_PAGE;
        const pageItems = list.slice(startIdx, endIdx);

        if(currentView === 'list'){
          renderList(pageItems);
        }else{
          renderGrid(pageItems);
        }
        renderPagination(totalPages);
      }

      async function init(){
        try{
          setCatalogLoading(true);
          peaks = await fetchPeaks();
          updateSuggestions();
          updateDisplay();
          trackEvent('catalog_render_complete', { peakCount: peaks.length });
        }catch(err){
          console.error('Error loading peaks:', err);
          trackEvent('catalog_data_failed', { message: err.message });
          const emptyMessage = document.getElementById('emptyMessage');
          if (emptyMessage) {
            emptyMessage.textContent = t('catalog.error');
            emptyMessage.hidden = false;
          }
        }finally{
          setCatalogLoading(false);
        }

        const searchInput = document.getElementById('searchInput');
        if (searchInput) {
          let searchDebounce;
          searchInput.addEventListener('input', () => {
            currentPage = 1;
            updateDisplay();
            clearTimeout(searchDebounce);
            searchDebounce = setTimeout(() => {
              trackEvent('catalog_search', { query: searchInput.value.trim().toLowerCase() });
            }, 400);
          });
        }

        const sortSelect = document.getElementById('sortSelect');
        if (sortSelect) {
          sortSelect.addEventListener('change', (e) => {
            activeSort = e.target.value;
            currentPage = 1;
            updateDisplay();
            trackEvent('catalog_sort_change', { sort: activeSort });
          });
        }
        const unitsSelect = document.getElementById('unitsSelect');
        if(unitsSelect){
          unitsSelect.addEventListener('change', (e) => {
            setUnits(e.target.value);
            updateDisplay();
            trackEvent('catalog_units_change', { units: e.target.value });
          });
        }
        const apiVariablesToggle = document.getElementById('apiVariablesToggle');
        if(apiVariablesToggle){
          apiVariablesToggle.addEventListener('change', (e) => {
            setApiVariableLabels(e.target.checked);
            updateDisplay();
            trackEvent('catalog_api_variables_toggle', { enabled: e.target.checked });
          });
        }
      }

      window.addEventListener('load', init);

      if (window.NH48_I18N && window.NH48_I18N.onLangChange) {
        window.NH48_I18N.onLangChange((lang) => {
          syncUnitsWithLanguage(lang);
          updateDisplay();
          trackEvent('catalog_language_change', { language: lang });
        });
      }

      // Column selector handler
      const columnSelect = document.getElementById('columnSelect');
      const viewSelect = document.getElementById('viewSelect');
      const grid = document.getElementById('grid');
      const columnControl = columnSelect ? columnSelect.closest('.control') : null;
      let currentView = 'grid';

      const applyView = (view, { persist = true } = {}) => {
        currentView = view === 'list' ? 'list' : 'grid';
        if(viewSelect){
          viewSelect.value = currentView;
        }
        if(grid){
          grid.setAttribute('data-view', currentView);
        }
        if(columnSelect){
          const disableColumns = currentView === 'list';
          columnSelect.disabled = disableColumns;
          if(columnControl){
            columnControl.classList.toggle('is-disabled', disableColumns);
          }
        }
        if(persist){
          localStorage.setItem('nh48-catalog-view', currentView);
        }
      };
      
      // Load saved column preference
      const savedColumns = localStorage.getItem('nh48-catalog-columns');
      if (savedColumns && ['2', '3', '4', '5'].includes(savedColumns)) {
        columnSelect.value = savedColumns;
        grid.setAttribute('data-columns', savedColumns);
      } else {
        grid.setAttribute('data-columns', '3');
      }

      const savedView = localStorage.getItem('nh48-catalog-view');
      applyView(savedView || 'grid', { persist: false });

      syncUnitsWithLanguage(window.NH48_I18N ? window.NH48_I18N.getLang() : 'en');

      const savedApiVariables = localStorage.getItem(API_VARIABLES_STORAGE_KEY);
      if(savedApiVariables === 'true'){
        setApiVariableLabels(true, { persist: false });
      }
      
      columnSelect.addEventListener('change', function() {
        const columns = this.value;
        grid.setAttribute('data-columns', columns);
        localStorage.setItem('nh48-catalog-columns', columns);
        trackEvent('catalog_columns_change', { columns });
      });

      viewSelect.addEventListener('change', function() {
        applyView(this.value);
        currentPage = 1;
        updateDisplay();
        trackEvent('catalog_view_change', { view: currentView });
      });
    </script>
    <div id="footer-placeholder"></div>
<script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
      import { getAnalytics, logEvent } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-analytics.js";

      const firebaseConfig = {
        apiKey: "AIzaSyCUShYXwxGVEDNzMeIwSFPmDaYeXSqRK4A",
        authDomain: "nh48-info.firebaseapp.com",
        projectId: "nh48-info",
        storageBucket: "nh48-info.firebasestorage.app",
        messagingSenderId: "732743288228",
        appId: "1:732743288228:web:d82d62cae0c3999ee5ad31",
        measurementId: "G-Q9F2W8YB7D"
      };

      const app = initializeApp(firebaseConfig);
      const analytics = getAnalytics(app);

      // Expose globally for app scripts
      window.NH48_INFO_ANALYTICS = {
        analytics,
        logEvent
      };

      // Base page-load event
      logEvent(analytics, "page_loaded", {
        site: "nh48-info",
        page: location.pathname
      });
    </script>
  </body>
</html>
