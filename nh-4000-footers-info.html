<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <!-- Favicons - ICO format preferred for Google compatibility -->
    <link rel="icon" href="/favicons/favicon.ico" sizes="48x48">
    <link rel="icon" type="image/x-icon" href="/favicons/favicon.ico">
    <link rel="shortcut icon" href="/favicons/favicon.ico">
    <link rel="icon" type="image/x-icon" sizes="16x16" href="/favicons/favicon-16x16.ico">
    <link rel="icon" type="image/x-icon" sizes="32x32" href="/favicons/favicon-32x32.ico">
    <link rel="icon" type="image/x-icon" sizes="48x48" href="/favicons/favicon-48x48.ico">
    <link rel="icon" type="image/x-icon" sizes="96x96" href="/favicons/favicon-96x96.ico">
    <!-- PNG fallbacks for browsers that prefer PNG -->
    <link rel="icon" type="image/png" sizes="16x16" href="/favicons/favicon-16.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicons/favicon-32.png">
    <link rel="icon" type="image/png" sizes="48x48" href="/favicons/favicon-48x48.png">
    <link rel="icon" type="image/png" sizes="96x96" href="/favicons/favicon-96x96.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/favicons/apple-touch-icon.png">
    <link rel="manifest" href="/manifest.json">
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>NH 48 4,000-Footers Information â€“ Unofficial Community Resource | NH48 Info</title>
    <meta
      name="description"
      content="Community-curated overview of New Hampshire's 4,000-footers with routes, ranges, season tips, and data tools. Not affiliated with the AMCâ€”verify details with official AMC resources."
    />
    <meta
      name="keywords"
      content="NH48 info, New Hampshire 4000 footers, AMC 4000 footer list, White Mountains hiking, Presidential Range, Franconia Ridge, NH48 data API"
    />
    <meta name="robots" content="index, follow" />
    <link rel="canonical" href="https://nh48.info/nh-4000-footers-info" />
    <meta property="og:type" content="website" />
    <meta property="og:locale" content="en_US" />
    <meta property="og:site_name" content="NH48pics" />
    <meta property="og:title" content="NH 48 4,000-Footers: Unofficial Community Information" />
    <meta property="og:description" content="Friendly, community-compiled info on New Hampshire's 4,000-footers with live data, maps, and planning notes. Always confirm with the AMC." />
    <meta property="og:url" content="https://nh48.info/nh-4000-footers-info" />
    <meta property="og:image" content="https://photos.nh48.info/cdn-cgi/image/format=jpg,quality=85,width=1200/mount-madison/mount-madison__001.jpg" />
    <meta property="og:image:alt" content="Mount Madison summit boulders under dramatic skies in the Presidential Range" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:site" content="@nate_dumps_pics" />
    <meta name="twitter:creator" content="@nate_dumps_pics" />
    <meta name="twitter:title" content="NH 48 4,000-Footers: Unofficial Community Information" />
    <meta name="twitter:description" content="Friendly, community-compiled info on New Hampshire's 4,000-footers with live data, maps, and planning notes." />
    <meta name="twitter:image" content="https://photos.nh48.info/cdn-cgi/image/format=jpg,quality=85,width=1200/mount-madison/mount-madison__001.jpg" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": ["Article", "Guide"],
        "mainEntityOfPage": {
          "@type": "WebPage",
          "@id": "https://nh48.info/nh-4000-footers-info"
        },
        "headline": "NH 48 4,000-Footers Information â€“ Unofficial Community Resource",
        "description": "Community-curated overview of New Hampshire's 4,000-footers with routes, ranges, season tips and API resources.",
        "image": {
          "@type": "ImageObject",
          "url": "https://photos.nh48.info/cdn-cgi/image/format=jpg,quality=85,width=1200/mount-madison/mount-madison__001.jpg",
          "width": 1200,
          "height": 800
        },
        "author": {
          "@type": "Organization",
          "name": "NH48 Community"
        },
        "publisher": {
          "@type": "Organization",
          "@id": "https://nh48.info/#organization",
          "name": "NH48pics",
          "logo": {
            "@type": "ImageObject",
            "url": "https://nh48.info/favicons/favicon-96.png",
            "width": 96,
            "height": 96
          }
        },
        "datePublished": "2023-10-01",
        "dateModified": "2025-02-16"
      }
    </script>
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "FAQPage",
        "mainEntity": [
          {
            "@type": "Question",
            "name": "Which NH 4,000 footer is the easiest?",
            "acceptedAnswer": {
              "@type": "Answer",
              "text": "Mt. Tecumseh and Mt. Waumbek are considered the easiest NH48 summits due to short mileage, moderate elevation gain and sheltered routes."
            }
          },
          {
            "@type": "Question",
            "name": "What qualifies a peak as an NH 4,000-footer?",
            "acceptedAnswer": {
              "@type": "Answer",
              "text": "A New Hampshire 4,000-footer is a peak in the state that reaches at least 4,000 feet in elevation and meets the Appalachian Mountain Club prominence criteria. The AMC maintains the official list of 48 peaks."
            }
          },
          {
            "@type": "Question",
            "name": "How many NH 4,000-footers are there?",
            "acceptedAnswer": {
              "@type": "Answer",
              "text": "There are 48 officially recognized 4,000-foot mountains in New Hampshireâ€™s White Mountains. Completing them earns hikers entry into the AMC Four-Thousand-Footer Club."
            }
          },
          {
            "@type": "Question",
            "name": "Do I need a permit to hike the NH 4,000-footers?",
            "acceptedAnswer": {
              "@type": "Answer",
              "text": "No backcountry permit is required for day hikes, but many trailheads in the White Mountain National Forest require a parking pass or day-use fee. Display a valid pass at the trailhead lot."
            }
          },
          {
            "@type": "Question",
            "name": "Are dogs allowed on NH 4,000-footer trails?",
            "acceptedAnswer": {
              "@type": "Answer",
              "text": "Dogs are generally allowed but should be under control or leashed. Alpine zones are fragile; pack out pet waste and respect other hikers."
            }
          },
          {
            "@type": "Question",
            "name": "When is the best time of year to hike the NH 4,000-footers?",
            "acceptedAnswer": {
              "@type": "Answer",
              "text": "Late spring through early fall offers the most favorable weather. Winter ascents count toward the list but require snowshoes or traction, warm layers and cold-weather experience."
            }
          },
          {
            "@type": "Question",
            "name": "Which NH 4,000-footer is the hardest?",
            "acceptedAnswer": {
              "@type": "Answer",
              "text": "Owls Head (remote and long) and the higher Presidential peaks like Mount Adams or Mount Jefferson (steep and exposed) are often cited as among the most challenging."
            }
          },
          {
            "@type": "Question",
            "name": "How long does it take to complete all 48 peaks?",
            "acceptedAnswer": {
              "@type": "Answer",
              "text": "Completion time varies widely. Some finish in a single season, while many take one to two years of weekend hiking or longer."
            }
          },
          {
            "@type": "Question",
            "name": "How do I document completion for the AMC Four-Thousand-Footer award?",
            "acceptedAnswer": {
              "@type": "Answer",
              "text": "Submit ascent dates to the Appalachian Mountain Club with the nominal fee. The AMC verifies the list and provides the certificate and patch."
            }
          },
          {
            "@type": "Question",
            "name": "Do peaks outside New Hampshire count toward the list?",
            "acceptedAnswer": {
              "@type": "Answer",
              "text": "No. The NH48 list includes only New Hampshire mountains. The New England 67 list adds the 4,000-footers in Maine and Vermont."
            }
          },
          {
            "@type": "Question",
            "name": "Are there NH 4,000-footers accessible by tram or car?",
            "acceptedAnswer": {
              "@type": "Answer",
              "text": "Cannon Mountain has an aerial tramway and Mount Washington has an auto road and cog railway. Summits reached by mechanical means do not countâ€”ascend on foot for official credit."
            }
          },
          {
            "@type": "Question",
            "name": "What gear should I carry when hiking the NH48?",
            "acceptedAnswer": {
              "@type": "Answer",
              "text": "Carry the 10 essentials: map and compass, headlamp, extra clothing, rain gear, food, water, first-aid kit, fire starter, knife and whistle. In winter add insulated boots, traction devices and snowshoes."
            }
          },
          {
            "@type": "Question",
            "name": "Are there shelters or campsites near the NH 4,000-footers?",
            "acceptedAnswer": {
              "@type": "Answer",
              "text": "The White Mountains have AMC huts, shelters and designated campsites on many routes. Backcountry camping is generally allowed below treeline and away from trails and water sources; follow forest regulations."
            }
          },
          {
            "@type": "Question",
            "name": "Where can I find maps or GPX files for these peaks?",
            "acceptedAnswer": {
              "@type": "Answer",
              "text": "NH48.info provides interactive maps and route data, and the dataset includes GPX routes accessible via the API. Commercial topo maps and GPS apps are also commonly used."
            }
          },
          {
            "@type": "Question",
            "name": "Which NH 4,000-footer has the best views?",
            "acceptedAnswer": {
              "@type": "Answer",
              "text": "Favorites include Mount Lafayette, Mount Carrigainâ€™s fire tower, Bondcliff, Mount Moosilauke and Mount Adams. Clear days provide sweeping White Mountain vistas."
            }
          },
          {
            "@type": "Question",
            "name": "Which peaks are good for families or beginner hikers?",
            "acceptedAnswer": {
              "@type": "Answer",
              "text": "Peaks like Mount Pierce, Mount Jackson, Mount Hale and Mount Tecumseh offer moderate distances and steady grades that suit many beginners."
            }
          },
          {
            "@type": "Question",
            "name": "Are there winter peaks suitable for beginners?",
            "acceptedAnswer": {
              "@type": "Answer",
              "text": "Yes. Waumbek, Pierce and Jackson have relatively sheltered routes and are popular winter introductions when properly equipped."
            }
          },
          {
            "@type": "Question",
            "name": "Do winter ascents count toward the NH48 list?",
            "acceptedAnswer": {
              "@type": "Answer",
              "text": "Yes. Winter climbs (December 21 â€“ March 21) count toward the primary NH48 completion and also the AMC Winter Four-Thousand-Footer award."
            }
          },
          {
            "@type": "Question",
            "name": "Do I need to hike both summits of peaks with multiple tops?",
            "acceptedAnswer": {
              "@type": "Answer",
              "text": "Some peaks have sub-summits that count separately (for example, Mount Osceola and East Osceola, Mount Bond and Bondcliff). Others are not countedâ€”follow the AMC list for official summits."
            }
          },
          {
            "@type": "Question",
            "name": "Are there seasonal trail closures?",
            "acceptedAnswer": {
              "@type": "Answer",
              "text": "Trail conditions vary. Routes can close temporarily for maintenance, blowdowns or wildlife nesting. Check White Mountain National Forest and AMC advisories before you hike."
            }
          },
          {
            "@type": "Question",
            "name": "Can I combine multiple peaks in one hike?",
            "acceptedAnswer": {
              "@type": "Answer",
              "text": "Yes. Popular traverses include Franconia Ridge (Lafayette and Lincoln), the Willey Range (Field, Willey and Tom), the Carter-Moriah Range and the Bonds."
            }
          },
          {
            "@type": "Question",
            "name": "How much elevation gain should I expect?",
            "acceptedAnswer": {
              "@type": "Answer",
              "text": "Elevation gain varies by peak. Easier summits like Waumbek and Tecumseh involve roughly 1,600 feet of climb, while longer trips like Mount Adams or Owls Head can exceed 4,000 feet."
            }
          },
          {
            "@type": "Question",
            "name": "Are there reliable water sources along the trails?",
            "acceptedAnswer": {
              "@type": "Answer",
              "text": "Many routes cross streams where you can filter water, but above treeline water is scarce. Always carry enough and treat all natural sources."
            }
          },
          {
            "@type": "Question",
            "name": "Will my cell phone work on the 4,000-footers?",
            "acceptedAnswer": {
              "@type": "Answer",
              "text": "Coverage is inconsistent. You may get signal on open ridges and summits, but do not rely on itâ€”carry a map and know how to navigate without electronics."
            }
          },
          {
            "@type": "Question",
            "name": "Where can I check the forecast for the White Mountains?",
            "acceptedAnswer": {
              "@type": "Answer",
              "text": "Use the Mount Washington Observatory Higher Summit Forecast and the National Weather Service. Weather changes quickly in the Whites."
            }
          },
          {
            "@type": "Question",
            "name": "Who maintains the NH 4,000-footer trails?",
            "acceptedAnswer": {
              "@type": "Answer",
              "text": "The U.S. Forest Service, Appalachian Mountain Club, local hiking clubs and volunteer trail adopters maintain the trail network."
            }
          },
          {
            "@type": "Question",
            "name": "Are there long-distance trails that traverse NH 4,000-footers?",
            "acceptedAnswer": {
              "@type": "Answer",
              "text": "Yes. The Appalachian Trail crosses several NH48 peaks, and the Cohos Trail and New England 100 Highest routes traverse sections of the Whites."
            }
          },
          {
            "@type": "Question",
            "name": "Do I need to treat water from mountain springs?",
            "acceptedAnswer": {
              "@type": "Answer",
              "text": "Yes. All backcountry water in the Whites should be filtered, boiled or treated to avoid giardia and other pathogens."
            }
          },
          {
            "@type": "Question",
            "name": "Are fires allowed on NH 4,000-footer peaks?",
            "acceptedAnswer": {
              "@type": "Answer",
              "text": "Campfires are prohibited above treeline and discouraged elsewhere. Use a stove and follow Leave No Trace principles."
            }
          },
          {
            "@type": "Question",
            "name": "Are there recommended guidebooks or resources for planning hikes?",
            "acceptedAnswer": {
              "@type": "Answer",
              "text": "The AMC White Mountain Guide is the definitive resource. NH48.info data, trip reports and trail apps like Gaia GPS or AllTrails are also helpful."
            }
          },
          {
            "@type": "Question",
            "name": "Is there a community or club for NH 4,000-footer hikers?",
            "acceptedAnswer": {
              "@type": "Answer",
              "text": "The AMC Four Thousand Footer Club recognizes finishers and holds annual award events. Social media groups also share trip reports and advice."
            }
          },
          {
            "@type": "Question",
            "name": "Which range has the most dangerous weather?",
            "acceptedAnswer": {
              "@type": "Answer",
              "text": "The Presidential Range is the most weather-exposed; expect rapid temperature changes, high winds and long above-treeline stretches."
            }
          },
          {
            "@type": "Question",
            "name": "How do I find individual peak details?",
            "acceptedAnswer": {
              "@type": "Answer",
              "text": "Use the links in the Current NH 4,000-Footer List. Each row links to /peak/slug/ and the peak pages link back to this info page."
            }
          }
        ]
      }
    </script>
    <link rel="stylesheet" href="/css/quick-browse-footer.css" />
    <script type="module" src="/js/i18n.js"></script>
    <script src="/js/quick-browse-footer.js" defer></script>
    <style>
      :root{
        --background:#0a0a0a;
        --surface:#12121a;
        --card:#171a22;
        --text:#ffffff;
        --muted:#c6d1df;
        --border: rgba(255, 255, 255, 0.15);
        --primary:#22c55e;
        --primary-strong:#4ade80;
        --card-gradient: linear-gradient(145deg, rgba(255,255,255,0.04) 0%, rgba(255,255,255,0.01) 100%);
        --card-border: rgba(203, 213, 245, 0.12);
        --card-radius: 20px;
        --card-shadow: 0 12px 32px rgba(0, 0, 0, 0.3);

        --bg: var(--background);
        --panel: var(--surface);
        --ink: var(--text);
        --stroke: var(--border);
        --accent: var(--primary);
        --accent-strong: var(--primary-strong);
      }
      *,
      *::before,
      *::after {
        box-sizing: border-box;
      }
      body {
        margin: 0;
        font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
        background: var(--bg);
        color: var(--ink);
        -webkit-font-smoothing: antialiased;
      }
      a {
        color: var(--accent);
      }
      a:hover {
        color: var(--accent-strong);
      }
      .wrap {
        max-width: 1200px;
        margin: 0 auto;
        padding: 16px 18px 64px;
      }
      header.hero {
        display: grid;
        grid-template-columns: minmax(0, 1fr) minmax(220px, 320px);
        gap: 22px;
        align-items: center;
        background: var(--card-gradient);
        border: 1px solid var(--card-border);
        border-radius: var(--card-radius);
        padding: 28px;
        box-shadow: var(--card-shadow);
        margin: 14px 0 28px;
      }
      header.hero h1 {
        font-size: clamp(32px, 4vw, 44px);
        margin: 0 0 12px;
      }
      header.hero p {
        color: var(--muted);
        max-width: 900px;
        font-size: 17px;
        line-height: 1.6;
      }
      .submit-edit-cta{
        margin: 16px 0 0;
      }
      .hero-meta {
        padding: 18px;
        border-radius: 16px;
        border: 1px solid rgba(203, 213, 245, 0.2);
        background: rgba(34, 197, 94, 0.08);
      }
      .hero-meta p {
        margin: 0;
        font-size: 14px;
      }
      .submit-edit-link{
        display: inline-block;
        padding: 10px 18px;
        border-radius: 12px;
        background: var(--accent);
        color: #ffffff;
        text-decoration: none;
        font-weight: 600;
        transition: background 0.2s ease, transform 0.2s ease;
      }
      .submit-edit-link:hover,
      .submit-edit-link:focus-visible{
        background: var(--accent-strong);
        transform: translateY(-1px);
      }
      .snapshot-title {
        margin: 18px 0 8px;
        font-size: 1.15rem;
        color: var(--ink);
      }
      .toc {
        margin: 12px 0 0;
        padding: 0;
        border: none;
        background: transparent;
      }
      .toc ol {
        list-style: none;
        padding: 0;
        margin: 14px 0 0;
        counter-reset: toc-items;
        display: grid;
        gap: 8px;
      }
      .toc li {
        counter-increment: toc-items;
      }
      .toc li::before {
        content: counter(toc-items) ".";
        color: var(--primary);
        font-weight: 700;
        margin-right: 8px;
      }
      .toc a {
        color: var(--muted);
        text-decoration: none;
        padding: 6px 0;
        font-weight: 600;
        font-size: 0.95rem;
      }
      .toc a:hover,
      .toc a:focus-visible {
        color: var(--accent);
        outline: 2px solid rgba(34, 197, 94, 0.4);
        outline-offset: 3px;
        border-radius: 6px;
      }
      .toc a.active {
        color: var(--accent);
      }
      .toc-layout {
        margin: 24px 0 28px;
      }
      .toc-panel {
        background: var(--surface);
        border: 1px solid var(--border);
        border-radius: 14px;
        padding: 24px;
      }
      .toc-panel .snapshot-title {
        margin: 0;
        font-size: clamp(1.35rem, 2.4vw, 1.8rem);
      }
      .hero-card {
        background: var(--card-gradient);
        border: 1px solid var(--card-border);
        border-radius: var(--card-radius);
        box-shadow: var(--card-shadow);
        transition: transform 0.3s ease, box-shadow 0.3s ease, border-color 0.3s ease;
      }
      .hero-card:hover {
        transform: translateY(-3px);
        border-color: rgba(34, 197, 94, 0.3);
        box-shadow: 0 12px 40px rgba(0, 0, 0, 0.4);
      }
      .section {
        margin: 28px 0;
      }
      .section-banner {
        position: relative;
        width: 100%;
        min-height: 240px;
        background-size: cover;
        background-position: center;
        border-radius: 14px;
        padding: 20px;
        margin-bottom: 14px;
        display: flex;
        align-items: flex-end;
      }
      .section-banner::before {
        content: "";
        position: absolute;
        inset: 0;
        background: linear-gradient(180deg, rgba(0, 0, 0, 0.55) 0%, rgba(0, 0, 0, 0.75) 100%);
        border-radius: inherit;
        pointer-events: none;
      }
      .section-banner.light-text h2 a {
        color: #ffffff;
        text-shadow: 0 1px 4px rgba(0, 0, 0, 0.6);
      }
      .section-banner.dark-text h2 a {
        color: #0f172a;
        text-shadow: 0 1px 4px rgba(255, 255, 255, 0.6);
      }
      .section-banner h2 {
        position: relative;
        z-index: 1;
        margin: 0;
        font-size: clamp(1.6rem, 2.6vw, 2.1rem);
        font-weight: 500;
      }
      .section-banner h2 a {
        text-decoration: none;
      }
      section {
        margin: 24px 0 20px;
      }
      h2 {
        font-size: 26px;
        margin-bottom: 12px;
      }
      p,
      li {
        line-height: 1.7;
        color: var(--muted);
      }
      .content-grid {
        display: grid;
        grid-template-columns: 1fr;
        gap: 18px;
        align-items: start;
      }
      .stacked-grid {
        grid-template-columns: 1fr;
      }
      .panel {
        background: var(--card-gradient);
        border: 1px solid var(--card-border);
        border-radius: var(--card-radius);
        padding: 16px;
        box-shadow: var(--card-shadow);
      }
      .warning-panel {
        margin: 16px 0 24px;
        border: 2px solid #fbbf24;
        border-radius: 12px;
        background: linear-gradient(180deg, #1f1408, #2b1a0a);
        overflow: hidden;
        color: #fef3c7;
        box-shadow: var(--card-shadow);
      }
      .warning-panel summary {
        list-style: none;
        cursor: default;
        padding: 12px 16px;
        display: flex;
        align-items: center;
        gap: 10px;
        font-weight: 700;
        color: #fef3c7;
      }
      .warning-panel summary::-webkit-details-marker {
        display: none;
      }
      .warning-panel .summary-title {
        display: inline-flex;
        align-items: center;
        gap: 10px;
      }
      .warning-panel .summary-title .icon-warning {
        font-size: 18px;
        line-height: 1;
        color: #fbbf24;
      }
      .warning-panel .warning-body {
        border-top: 1px solid rgba(251, 191, 36, 0.6);
        padding: 12px 16px 16px;
        display: grid;
        gap: 10px;
      }
      .warning-panel .warning-body p {
        margin: 0;
        color: #ffffff;
        line-height: 1.5;
      }
      .warning-panel .warning-body strong {
        color: #fde68a;
      }
      .range-filters {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        margin: 12px 0 18px;
      }
      .chip {
        padding: 8px 12px;
        border-radius: 999px;
        border: 1px solid rgba(203, 213, 245, 0.2);
        background: rgba(255, 255, 255, 0.03);
        color: var(--ink);
        cursor: pointer;
        font-weight: 700;
        font-size: 14px;
        transition: all 0.18s ease;
      }
      .chip:hover {
        border-color: var(--accent);
      }
      .chip.active {
        background: var(--accent);
        color: var(--bg);
        border-color: var(--accent);
      }
      .table-scroll {
        overflow-x: auto;
        border-radius: var(--card-radius);
        border: 1px solid var(--card-border);
      }
      table {
        width: 100%;
        border-collapse: collapse;
        background: var(--card);
      }
      th,
      td {
        padding: 12px;
        border-bottom: 1px solid var(--stroke);
        text-align: left;
      }
      th {
        text-transform: uppercase;
        font-size: 13px;
        letter-spacing: 0.6px;
        color: var(--ink);
        opacity: 0.9;
      }
      th[aria-sort] {
        white-space: nowrap;
      }
      .sort-button {
        background: transparent;
        border: none;
        color: inherit;
        font: inherit;
        text-transform: inherit;
        letter-spacing: inherit;
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 0;
        cursor: pointer;
      }
      .sort-button:hover {
        color: var(--accent);
      }
      .sort-indicator {
        font-size: 11px;
        opacity: 0.8;
      }
      tr:hover td {
        background: rgba(255, 255, 255, 0.05);
      }
      tr.hazard-row td {
        background: var(--hazard-bg, rgba(239, 68, 68, 0.08));
      }
      tr.hazard-row td:first-child {
        border-left: 4px solid var(--hazard-color, #ef4444);
      }
      tr.hazard-row:hover td {
        background: var(--hazard-bg-hover, rgba(239, 68, 68, 0.15));
      }
      .map-shell {
        background: var(--card-gradient);
        border: 1px solid var(--card-border);
        border-radius: var(--card-radius);
        padding: 16px;
        width: 100%;
        min-height: 400px;
      }
      .map-toggle-row {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 10px;
      }
      .map-toggle-group {
        display: inline-flex;
        border: 1px solid rgba(203, 213, 245, 0.2);
        border-radius: 999px;
        overflow: hidden;
        background: rgba(15, 23, 42, 0.5);
      }
      .map-toggle-group button {
        background: transparent;
        border: none;
        color: var(--ink);
        padding: 8px 14px;
        cursor: pointer;
        font-weight: 700;
        font-size: 0.9rem;
      }
      .map-toggle-group button.active {
        background: var(--accent);
        color: var(--bg);
      }
      .map-controls {
        display: inline-flex;
        gap: 8px;
      }
      .map-control-btn {
        background: rgba(15, 23, 42, 0.8);
        border: 1px solid rgba(203, 213, 245, 0.25);
        color: var(--ink);
        border-radius: 8px;
        padding: 6px 10px;
        font-weight: 600;
        cursor: pointer;
      }
      .map-control-btn:hover,
      .map-control-btn:focus-visible {
        border-color: rgba(34, 197, 94, 0.5);
        color: var(--accent);
      }
      #peakMap {
        width: 100%;
        height: 520px;
        background: rgba(10, 12, 20, 0.65);
        border-radius: 16px;
        border: 1px solid rgba(203, 213, 245, 0.18);
      }
      #peakMapLeaflet {
        width: 100%;
        height: 520px;
        border-radius: 16px;
        border: 1px solid rgba(203, 213, 245, 0.18);
        overflow: hidden;
        display: none;
      }
      .leaflet-container {
        background: #0b1220;
      }
      .map-legend {
        display: flex;
        gap: 12px;
        margin-top: 10px;
        flex-wrap: wrap;
        color: var(--muted);
        font-size: 14px;
      }
      .map-legend-items {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        align-items: center;
      }
      .map-legend-item {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        font-weight: 600;
        color: var(--ink);
      }
      .legend-dot {
        width: 12px;
        height: 12px;
        border-radius: 50%;
        display: inline-block;
        margin-right: 6px;
      }
      .range-list {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(210px, 1fr));
        gap: 10px;
        margin-top: 14px;
      }
      .range-card {
        background: rgba(15, 23, 42, 0.7);
        border: 1px solid rgba(148, 163, 184, 0.2);
        padding: 8px 12px;
        border-radius: 12px;
        display: grid;
        grid-template-columns: auto 1fr auto;
        align-items: center;
        gap: 10px;
        color: var(--ink);
        font-weight: 600;
        cursor: pointer;
        min-height: 44px;
        transition: transform 0.2s ease, border-color 0.2s ease, box-shadow 0.2s ease;
      }
      .range-card.active {
        border-color: rgba(34, 197, 94, 0.6);
        box-shadow: 0 10px 22px rgba(34, 197, 94, 0.2);
        transform: translateY(-1px);
      }
      .range-card__name {
        font-size: 0.92rem;
        letter-spacing: 0.2px;
        line-height: 1.15;
        word-break: keep-all;
      }
      .range-card__dot {
        width: 10px;
        height: 10px;
        border-radius: 50%;
        display: inline-block;
        flex-shrink: 0;
      }
      .range-card__chip {
        background: rgba(15, 23, 42, 0.6);
        border: 1px solid rgba(148, 163, 184, 0.35);
        border-radius: 999px;
        padding: 2px 8px;
        font-size: 0.72rem;
        font-weight: 700;
        color: var(--muted);
        white-space: nowrap;
      }
      .table-actions {
        display: inline-flex;
        gap: 8px;
        flex-wrap: wrap;
      }
      .table-action {
        background: rgba(15, 23, 42, 0.6);
        border: 1px solid rgba(148, 163, 184, 0.35);
        color: var(--ink);
        border-radius: 999px;
        padding: 4px 10px;
        font-weight: 600;
        font-size: 0.8rem;
        cursor: pointer;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 6px;
      }
      .table-action:hover,
      .table-action:focus-visible {
        border-color: rgba(34, 197, 94, 0.5);
        color: var(--accent);
      }
      .sr-only {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        border: 0;
      }
      .toggle-group {
        display: inline-flex;
        border: 1px solid rgba(203, 213, 245, 0.2);
        border-radius: 999px;
        overflow: hidden;
      }
      .toggle-group button {
        background: transparent;
        border: none;
        color: var(--ink);
        padding: 10px 14px;
        cursor: pointer;
        font-weight: 700;
      }
      .toggle-group button.active {
        background: var(--accent);
        color: var(--bg);
      }
      .official-layout {
        display: grid;
        grid-template-columns: 1fr;
        gap: 20px;
        align-items: start;
      }
      .season-table {
        margin-top: 14px;
      }
      .faq-item {
        margin-bottom: 12px;
      }
      .cta {
        display: inline-flex;
        align-items: center;
        gap: 10px;
        padding: 12px 16px;
        background: var(--accent);
        border: 1px solid var(--accent);
        color: var(--bg);
        border-radius: 10px;
        font-weight: 800;
        text-decoration: none;
        text-transform: uppercase;
        letter-spacing: 0.6px;
        box-shadow: 0 8px 20px rgba(34, 197, 94, 0.3);
      }
      .cta:hover {
        background: var(--accent-strong);
        border-color: var(--accent-strong);
      }

      .effort-details {
        display: grid;
        grid-template-columns: 1fr;
        gap: 20px;
      }
      .hero-effort {
        margin-top: 20px;
      }
      .effort-item {
        padding: 24px;
        background: rgba(255, 255, 255, 0.02);
        border: 1px solid rgba(203, 213, 245, 0.1);
        border-radius: 16px;
      }
      .effort-item h3 {
        color: var(--accent);
        font-size: 1.1rem;
        margin-bottom: 12px;
      }
      .effort-item p {
        margin: 0;
        font-size: 0.95rem;
      }

      /* Difficulty Guide Section */
      .difficulty-guide {
        padding: 32px 24px;
        background: rgba(10, 10, 10, 0.6);
        border-radius: 24px;
        margin: 0;
      }
      .difficulty-guide h2 {
        text-align: left;
        color: var(--ink);
        font-size: 1.5rem;
        margin-bottom: 12px;
        font-weight: 700;
      }
      .difficulty-guide > p {
        text-align: left;
        margin-bottom: 20px;
      }
      .difficulty-guide .tiers-container {
        display: grid;
        grid-template-columns: 1fr;
        gap: 14px;
      }
      .tier-badge {
        display: flex;
        flex-direction: column;
        align-items: flex-start;
        padding: 20px 28px;
        border-radius: 16px;
        font-weight: 600;
        transition: all 0.3s ease;
        min-width: 0;
        text-align: left;
        background: transparent;
        cursor: pointer;
        border: none;
        appearance: none;
      }
      .tier-badge:hover {
        transform: scale(1.05);
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.4);
      }
      .tier-badge .tier-count {
        font-size: 1.5rem;
        font-weight: 700;
        margin-bottom: 4px;
      }
      .tier-badge .tier-name {
        font-size: 0.9rem;
        text-transform: uppercase;
        letter-spacing: 0.04em;
        margin-bottom: 8px;
      }
      .tier-badge .tier-examples {
        font-size: 0.75rem;
        opacity: 0.8;
        font-weight: 400;
      }
      .tier-badge.tier-beginner {
        background: linear-gradient(135deg, rgba(34, 197, 94, 0.2) 0%, rgba(34, 197, 94, 0.1) 100%);
        border: 1px solid rgba(34, 197, 94, 0.4);
        color: #4ade80;
      }
      .tier-badge.tier-moderate {
        background: linear-gradient(135deg, rgba(251, 191, 36, 0.2) 0%, rgba(251, 191, 36, 0.1) 100%);
        border: 1px solid rgba(251, 191, 36, 0.4);
        color: #fbbf24;
      }
      .tier-badge.tier-challenging {
        background: linear-gradient(135deg, rgba(249, 115, 22, 0.2) 0%, rgba(249, 115, 22, 0.1) 100%);
        border: 1px solid rgba(249, 115, 22, 0.4);
        color: #fb923c;
      }
      .tier-badge.tier-severe {
        background: linear-gradient(135deg, rgba(239, 68, 68, 0.2) 0%, rgba(239, 68, 68, 0.1) 100%);
        border: 1px solid rgba(239, 68, 68, 0.4);
        color: #f87171;
      }
      tbody tr td {
        background: var(--card);
        color: #e2e8f0;
      }
      tbody tr td:first-child {
        border-left: 4px solid transparent;
        padding-left: 10px;
      }
      tbody tr.tier-beginner td:first-child {
        border-left-color: var(--accent);
      }
      tbody tr.tier-moderate td:first-child {
        border-left-color: #fbbf24;
      }
      tbody tr.tier-challenging td:first-child {
        border-left-color: #f97316;
      }
      tbody tr.tier-severe td:first-child {
        border-left-color: #ef4444;
      }
      .difficulty-badge {
        display: inline-flex;
        align-items: center;
        padding: 2px 8px;
        border-radius: 999px;
        font-size: 12px;
        font-weight: 700;
        color: var(--bg);
        line-height: 1.3;
      }
      .difficulty-badge.tier-beginner {
        background: var(--accent);
      }
      .difficulty-badge.tier-moderate {
        background: #fbbf24;
      }
      .difficulty-badge.tier-challenging {
        background: #f97316;
      }
      .difficulty-badge.tier-severe {
        background: #ef4444;
      }

      /* Trip Combos Section */
      .trip-combos {
        padding: 40px 0;
        margin: 32px 0;
      }
      .trip-combos h2 {
        color: var(--ink);
        font-size: 1.5rem;
        margin-bottom: 12px;
        font-weight: 700;
        text-align: center;
      }
      .trip-combos > p {
        text-align: center;
        margin-bottom: 24px;
      }
      .trip-combos .combos-grid {
        display: grid;
        grid-template-columns: 1fr;
        gap: 20px;
      }
      .combo-card {
        position: relative;
        padding: 24px;
        background: linear-gradient(145deg, rgba(255, 255, 255, 0.04) 0%, rgba(255, 255, 255, 0.01) 100%);
        border: 1px solid rgba(203, 213, 245, 0.1);
        border-radius: 20px;
        overflow: hidden;
        transition: all 0.3s ease;
        text-align: left;
      }
      .combo-card::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 3px;
        background: linear-gradient(90deg, var(--accent), var(--accent-strong));
        opacity: 0;
        transition: opacity 0.3s ease;
      }
      .combo-card:hover {
        border-color: rgba(34, 197, 94, 0.3);
        transform: translateY(-3px);
        box-shadow: 0 12px 32px rgba(0, 0, 0, 0.3);
      }
      .combo-card:hover::before {
        opacity: 1;
      }
      .combo-card .combo-name {
        display: block;
        font-size: 1.15rem;
        font-weight: 600;
        color: var(--ink);
        margin-bottom: 6px;
      }
      .combo-card .combo-peaks {
        display: block;
        font-size: 0.9rem;
        color: var(--accent);
        margin-bottom: 8px;
        font-weight: 500;
      }
      .combo-card .combo-stats {
        display: block;
        font-size: 0.85rem;
        color: var(--muted);
        margin-bottom: 12px;
        opacity: 0.8;
      }
      .combo-card .combo-description {
        margin: 0;
        font-size: 0.9rem;
        color: var(--muted);
        line-height: 1.5;
      }

      /* Risk Stats Section */
      .risk-stats {
        padding: 32px 0;
      }
      .risk-stats h2 {
        color: var(--ink);
        font-size: 1.5rem;
        margin-bottom: 12px;
        text-align: center;
      }
      .risk-stats > p {
        text-align: center;
        margin-bottom: 24px;
      }
      .risk-stats .risk-grid {
        display: grid;
        grid-template-columns: 1fr;
        gap: 20px;
      }
      .risk-stats .risk-box {
        padding: 24px;
        background: rgba(239, 68, 68, 0.08);
        border: 1px solid rgba(239, 68, 68, 0.25);
        border-radius: 16px;
        position: relative;
        overflow: hidden;
        text-align: left;
        display: block;
        width: 100%;
        appearance: none;
        font: inherit;
        color: inherit;
        cursor: pointer;
        transition: border-color 0.2s ease, box-shadow 0.2s ease, transform 0.2s ease;
      }
      .risk-stats .risk-box:hover {
        border-color: rgba(239, 68, 68, 0.5);
        box-shadow: 0 12px 28px rgba(239, 68, 68, 0.12);
        transform: translateY(-1px);
      }
      .risk-stats .risk-box:focus-visible {
        outline: 2px solid rgba(94, 234, 212, 0.6);
        outline-offset: 2px;
      }
      .risk-stats .risk-box.is-active {
        border-color: var(--risk-color, #ef4444);
        box-shadow: 0 0 0 2px var(--risk-color, #ef4444);
      }
      .risk-stats .risk-box.is-active .risk-title,
      .risk-stats .risk-box.is-active .risk-value {
        color: var(--risk-color, #f87171);
      }
      .risk-stats .risk-box.is-disabled {
        cursor: not-allowed;
        opacity: 0.6;
        transform: none;
        box-shadow: none;
      }
      .risk-stats .risk-box .risk-title {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 1rem;
        font-weight: 600;
        color: #f87171;
        margin-bottom: 8px;
      }
      .risk-stats .risk-box .risk-value {
        font-size: 1.75rem;
        font-weight: 700;
        color: #fca5a5;
        margin-bottom: 8px;
      }
      .risk-stats .risk-box .risk-description {
        font-size: 0.9rem;
        color: var(--muted);
        line-height: 1.5;
        margin: 0;
      }

      /* Strategy Tiles Section */
      .strategy-section {
        padding: 32px 0;
      }
      .strategy-section h2 {
        color: var(--ink);
        font-size: 1.5rem;
        margin-bottom: 12px;
        text-align: center;
      }
      .strategy-section > p {
        text-align: center;
        margin-bottom: 24px;
      }
      .strategy-tiles {
        display: grid;
        grid-template-columns: 1fr;
        gap: 20px;
      }
      .strategy-tile {
        display: block;
        color: inherit;
        text-decoration: none;
        padding: 28px 24px;
        background: linear-gradient(145deg, rgba(255, 255, 255, 0.04) 0%, rgba(255, 255, 255, 0.01) 100%);
        border: 1px solid rgba(203, 213, 245, 0.12);
        border-radius: 20px;
        text-align: center;
        transition: all 0.3s ease;
      }
      .strategy-tile:hover {
        border-color: rgba(34, 197, 94, 0.4);
        transform: translateY(-4px);
        box-shadow: 0 12px 32px rgba(34, 197, 94, 0.1);
      }
      .strategy-tile .strategy-icon {
        font-size: 3rem;
        margin-bottom: 16px;
        display: block;
      }
      .strategy-tile .strategy-name {
        display: block;
        font-size: 1.25rem;
        font-weight: 600;
        color: var(--ink);
        margin-bottom: 8px;
      }
      .strategy-tile .strategy-duration {
        display: block;
        font-size: 1rem;
        color: var(--accent);
        font-weight: 500;
        margin-bottom: 12px;
      }
      .strategy-tile .strategy-description {
        font-size: 0.9rem;
        color: var(--muted);
        line-height: 1.5;
        margin: 0;
      }

      /* Responsive adjustments for migrated sections */
      @media (max-width: 900px) {
        header.hero {
          grid-template-columns: 1fr;
        }
        .toc-layout {
          margin-top: 16px;
        }
        .official-layout {
          grid-template-columns: 1fr;
        }
        .tier-badge {
          padding: 16px 20px;
        }
      }

      @media (max-width: 700px) {
        th,
        td {
          padding: 10px;
        }
        .range-filters {
          gap: 6px;
        }
      }

      @media (max-width: 680px) {
        .tier-badge {
          padding: 14px 18px;
        }
        .tier-badge .tier-examples {
          display: none;
        }
        .trip-combos .combos-grid {
          grid-template-columns: 1fr;
        }
        .risk-stats .risk-grid {
          grid-template-columns: 1fr;
        }
        .strategy-tiles {
          grid-template-columns: 1fr;
        }
        #peakMap {
          height: 420px;
        }
      }

      @media (max-width: 480px) {
        .difficulty-guide {
          padding: 24px 16px;
        }
      }

      @media print {
        body {
          background: #ffffff;
          color: #000000;
        }
        a {
          color: #000000;
          text-decoration: underline;
        }
        header.hero,
        .panel,
        .hero-card,
        .map-shell {
          box-shadow: none;
          background: #ffffff;
          border-color: #e2e8f0;
        }
        .toggle-group {
          display: none;
        }
      }
    </style>
  </head>
  <body data-route="info" data-page="info">
    <div id="nav-placeholder"></div>
    <script>
      document.addEventListener('DOMContentLoaded', () => {
        const navPlaceholder = document.getElementById('nav-placeholder');
        const footerPlaceholder = document.getElementById('footer-placeholder');
        const activeRoute = document.body.dataset.route || document.body.dataset.page;

        if (navPlaceholder) {
          fetch('/pages/nav.html')
            .then((r) => r.text())
            .then((html) => {
              navPlaceholder.innerHTML = html;
              const links = navPlaceholder.querySelectorAll('.site-nav-links a');
              links.forEach((link) => {
                const routes = (link.dataset.routes || link.dataset.route || '')
                  .split(',')
                  .map((value) => value.trim())
                  .filter(Boolean);

                if (routes.includes(activeRoute)) {
                  link.classList.add('active');
                  link.setAttribute('aria-current', 'page');
                }
              });
              if (window.NH48_I18N && window.NH48_I18N.refreshLangPicker) {
                window.NH48_I18N.refreshLangPicker();
              }
            })
            .catch((err) => console.error('Navigation failed to load', err));
        }

        const hasQuickFooter = document.querySelector('.nh48-quick-footer');

        if (footerPlaceholder && !hasQuickFooter) {
          fetch('/pages/footer.html')
            .then((r) => r.text())
            .then((html) => {
              footerPlaceholder.innerHTML = html;
            })
            .catch((err) => console.error('Footer failed to load', err));
        }
      });
    </script>

    <main class="wrap">
      <header class="hero">
        <div>
          <p class="eyebrow">Community compiled â€¢ Unofficial overview</p>
          <h1>NH48 Information Hub</h1>
          <p>
            Community members gathered these notes on the AMC Four-Thousand-Footer peaksâ€”routes, ranges, seasonality patterns, and developer toolsâ€”to make browsing easier. Details are not fully verified; please cross-check against the Appalachian Mountain Clubâ€™s official resources before you go.
          </p>
          <p class="submit-edit-cta">
            <a href="/submit-edit" class="submit-edit-link">Submit Edit to Author</a>
          </p>
        </div>
        <aside class="hero-meta" aria-label="Official source reminder">
          <p><strong>Planning reminder:</strong> Route descriptions on this page are unofficial. Use AMC resources for the final trail, weather, and safety decisions.</p>
        </aside>
      </header>

      <section id="disclaimer">
        <details class="warning-panel" open>
          <summary>
            <span class="summary-title">
              <span class="icon-warning" aria-hidden="true">âš ï¸</span>
              Important Trail Warnings
            </span>
          </summary>
          <div class="warning-body">
            <p><strong>NH48.info is an unofficial, community-driven site.</strong> Use this page at your own risk; always verify trail status, rules, and safety information with official sources.</p>
            <p><a href="https://www.amc4000footer.org/" target="_blank" rel="noopener">Visit Official AMC 4000 Site for comprehensive details</a>.</p>
          </div>
        </details>
      </section>

      <section class="toc-layout" aria-label="Table of contents">
        <div class="toc-panel panel">
          <h2 class="snapshot-title">Table of Contents</h2>
          <nav class="toc" aria-label="Table of contents">
            <ol>
              <li><a href="#what-is-nh48" aria-label="What is the NH48 section">What is the NH48?</a></li>
              <li><a href="#range-map" aria-label="Range map section">Range Map</a></li>
              <li><a href="#official-peak-list" aria-label="Official peak list section">Official Peak List</a></li>
              <li><a href="#day-trip-groupings" aria-label="Day trip groupings section">Day Trip Groupings</a></li>
              <li><a href="#difficulty-strategy" aria-label="Peak strategy section">Peak Strategy</a></li>
              <li><a href="#peak-difficulty-guide" aria-label="Difficulty guide section">Difficulty Guide</a></li>
              <li><a href="#risk-preparedness" aria-label="Risk and preparedness section">Risk &amp; Preparedness</a></li>
              <li><a href="#seasonal-considerations" aria-label="Seasonal considerations section">Seasonal Considerations</a></li>
              <li><a href="#completion-strategies" aria-label="Finish strategies section">Finish Strategies</a></li>
              <li><a href="#history" aria-label="History section">History</a></li>
              <li><a href="#data-api" aria-label="Data and API section">Data &amp; API</a></li>
              <li><a href="#faq" aria-label="Frequently asked questions section">FAQ</a></li>
            </ol>
          </nav>
        </div>
      </section>

      <section class="section" id="what-is-nh48">
        <div class="section-banner light-text" style="background-image: url('https://photos.nh48.info/mount-pierce/mount-pierce__002.jpg'); background-size: cover; background-position: center 35%;">
          <h2><a href="#what-is-nh48">What is the NH48?</a></h2>
        </div>
        <p>
          The New Hampshire 48 refers to mountains that meet the AMC Four-Thousand-Footer Club standard of at least 4,000 feet above sea level and 200 feet of topographic prominence. NH48.info is not affiliated with the AMC; this overview summarizes information gathered from public references and hiker contributions.
        </p>
        <p>
          The idea dates to 1931 when Dartmouth librarian Nathaniel L. Goodrich outlined an early list. Refined USGS surveys and AMC guidelines eventually set the list at 48 peaksâ€”adding Bondcliff and Galehead while excluding shoulder summits like Mt. Guyot and Mt. Clay. Readers should confirm criteria and routes with the Appalachian Mountain Club before planning trips.
        </p>
      </section>

<section class="section" id="range-map" aria-label="Range map">
        <div class="section-banner light-text" style="background-image: url('https://photos.nh48.info/mount-lafayette/mount-lafayette__002.jpg'); background-size: cover; background-position: center 35%;">
          <h2><a href="#range-map">Range Map</a></h2>
        </div>
        <div class="panel hero-card map-shell">
          <p>Use range cards to focus the list and map together for faster planning.</p>
          <div class="map-toggle-row">
            <div class="map-toggle-group" role="tablist" aria-label="Map style">
              <button type="button" id="mapStyleOsm" class="active" role="tab" aria-selected="true">OSM Topo</button>
              <button type="button" id="mapStyleStylized" role="tab" aria-selected="false">Stylized</button>
            </div>
            <div class="map-controls" aria-label="Map controls">
              <button class="map-control-btn" type="button" id="mapZoomIn">Zoom in</button>
              <button class="map-control-btn" type="button" id="mapZoomOut">Zoom out</button>
              <button class="map-control-btn" type="button" id="mapReset">Reset view</button>
              <button class="map-control-btn" type="button" id="mapClearFilters">Clear filters</button>
            </div>
          </div>
          <svg id="peakMap" role="img" aria-label="Map of all 48 New Hampshire 4,000 foot peaks"></svg>
          <div id="peakMapLeaflet" role="img" aria-label="OpenStreetMap topographic view of NH48 peaks"></div>
          <div class="map-legend">
            <span><span class="legend-dot" id="mapLegendDot" style="background:#22c55e"></span><span id="mapLegendLabel">NH48 Summits (All ranges)</span></span>
            <div class="map-legend-items" id="mapLegendItems"></div>
          </div>
          <div class="range-list" id="rangeList" aria-label="Map range filters"></div>
        </div>
      </section>

<section class="section" id="official-peak-list">
        <div class="section-banner light-text" style="background-image: url('https://photos.nh48.info/mount-carrigain/mount-carrigain__002.jpg'); background-size: cover; background-position: center 40%;">
          <h2><a href="#official-peak-list">Current NH 4,000-Footer List</a></h2>
        </div>
        <p>
          Peaks shown here reflect the summits recognized by the AMC at the time of publication. Tap a range filter to see the peaks clustered by geography, or click a summit name to open its detailed page. Each row pulls live attributes from the NH48 manifest so the table stays synchronized with the photo-rich peak templates.
        </p>
        <p>
          <a href="https://www.amc4000footer.org/" target="_blank" rel="noopener">Visit Official AMC 4000 Site for comprehensive details</a>. Please confirm prominence, elevation, and trail guidance with the AMC before relying on this table.
        </p>
        <div class="official-layout">
          <div class="official-table">
            <div class="range-filters" id="rangeFilters" aria-label="Filter peaks by range"></div>
            <div class="table-scroll">
              <table>
                <thead>
                  <tr>
                    <th>Peak</th>
                    <th data-sort-key="elevation" aria-sort="none">
                      <button class="sort-button" type="button" data-sort="elevation" aria-label="Sort by elevation">
                        Elevation (ft)
                        <span class="sort-indicator" aria-hidden="true"></span>
                      </button>
                    </th>
                    <th data-sort-key="range" aria-sort="none">
                      <button class="sort-button" type="button" data-sort="range" aria-label="Sort by range">
                        Range
                        <span class="sort-indicator" aria-hidden="true"></span>
                      </button>
                    </th>
                    <th>Difficulty</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="peakTableBody"></tbody>
              </table>
            </div>
          </div>
        </div>
      </section>

<section class="section trip-combos" id="day-trip-groupings" aria-label="Popular Day Trip Groupings">
        <div class="section-banner light-text" style="background-image: url('https://photos.nh48.info/mount-adams/mount-adams__002.jpg'); background-size: cover; background-position: center 35%;">
          <h2><a href="#day-trip-groupings">Popular Day Trip Groupings</a></h2>
        </div>
        <p>Maximize your summit count with these classic multi-peak routes. Experienced hikers often complete multiple peaks per trip.</p>
        
        <div class="combos-grid">
          <div class="combo-card">
            <span class="combo-name">Presidential Traverse</span>
            <span class="combo-peaks">7 Peaks</span>
            <span class="combo-stats">~23 mi | ~9,000 ft gain</span>
            <p class="combo-description">Madison, Adams, Jefferson, Washington, Monroe, Eisenhower, Pierce - the ultimate White Mountains traverse.</p>
          </div>
          
          <div class="combo-card">
            <span class="combo-name">Franconia Ridge Loop</span>
            <span class="combo-peaks">4 Peaks</span>
            <span class="combo-stats">~9 mi | ~4,000 ft gain</span>
            <p class="combo-description">Flume, Liberty, Lincoln, Lafayette - one of the most scenic ridge walks in the Northeast.</p>
          </div>
          
          <div class="combo-card">
            <span class="combo-name">Bonds Traverse</span>
            <span class="combo-peaks">3 Peaks</span>
            <span class="combo-stats">~19 mi | ~5,500 ft gain</span>
            <p class="combo-description">Bondcliff, Bond and West Bondâ€”often done as a long day hike or overnight, usually requiring a car spot or out-and-back.</p>
          </div>

          <div class="combo-card">
            <span class="combo-name">Pemi Loop</span>
            <span class="combo-peaks">9â€“11 Peaks</span>
            <span class="combo-stats">~31 mi | ~9,100 ft gain</span>
            <p class="combo-description">A circuit around the Pemigewasset Wilderness linking Flume, Liberty, Lincoln, Lafayette, Garfield, Galehead, South Twin, West Bond, Bond and Bondcliff, with optional North Twin or Zealand.</p>
          </div>
          
          <div class="combo-card">
            <span class="combo-name">Twin Range</span>
            <span class="combo-peaks">3 Peaks</span>
            <span class="combo-stats">~15 mi | ~4,800 ft gain</span>
            <p class="combo-description">South Twin, North Twin, Galehead - accessible via multiple routes with AMC hut options.</p>
          </div>
          
          <div class="combo-card">
            <span class="combo-name">Hancocks Loop</span>
            <span class="combo-peaks">2 Peaks</span>
            <span class="combo-stats">~9 mi | ~3,500 ft gain</span>
            <p class="combo-description">North Hancock, South Hancock - connected by a scenic ridge trail with multiple brook crossings.</p>
          </div>
          
          <div class="combo-card">
            <span class="combo-name">Kinsmans</span>
            <span class="combo-peaks">2 Peaks</span>
            <span class="combo-stats">~10 mi | ~3,800 ft gain</span>
            <p class="combo-description">North Kinsman, South Kinsman - rugged terrain with beautiful Lonesome Lake along the way.</p>
          </div>
          
          <div class="combo-card">
            <span class="combo-name">Osceolas</span>
            <span class="combo-peaks">2 Peaks</span>
            <span class="combo-stats">~8 mi | ~3,200 ft gain</span>
            <p class="combo-description">Mount Osceola, East Osceola - beginner-friendly pairing with a fun chimney scramble.</p>
          </div>

          <div class="combo-card">
            <span class="combo-name">Willey Range</span>
            <span class="combo-peaks">3 Peaks</span>
            <span class="combo-stats">~9 mi | ~3,200 ft gain</span>
            <p class="combo-description">Mount Tom, Field and Willey via the Ethan Pond or Avalon approaches for a classic three-peak loop.</p>
          </div>

          <div class="combo-card">
            <span class="combo-name">Carter-Moriah Traverse</span>
            <span class="combo-peaks">4 Peaks</span>
            <span class="combo-stats">~15+ mi | ~5,000 ft gain</span>
            <p class="combo-description">Carter Dome, South Carter, Middle Carter, and Moriahâ€”a long ridge day often split into two hikes.</p>
          </div>
        </div>
      </section>

<section class="section" id="difficulty-strategy">
        <div class="section-banner light-text" style="background-image: url('https://photos.nh48.info/bondcliff/bondcliff__003.jpg'); background-size: cover; background-position: center 35%;">
          <h2><a href="#difficulty-strategy">Peak Strategy Highlights</a></h2>
        </div>
        <p>
          Difficulty is subjective and conditions change quickly. Use the table filters above for tier sorting, then apply these route-planning examples as conditions, weather, and experience allow.
        </p>
        <div class="content-grid stacked-grid">
          <div class="panel hero-card">
            <h3>Beginner-Friendly choices</h3>
            <ul>
              <li><strong>Mt. Tecumseh</strong> â€” many hikers find this short, direct trail to be the gentlest ascent on the list.</li>
              <li><strong>Mt. Waumbek</strong> â€” often chosen for its steady grade, sheltered forest, and forgiving footing.</li>
              <li><strong>Mt. Pierce</strong> â€” provides Crawford Path views with less exposure than some Presidential neighbors.</li>
            </ul>
          </div>
          <div class="panel hero-card">
            <h3>Advanced &amp; Strenuous</h3>
            <ul>
              <li><strong>The Bonds</strong> (Bond, West Bond, Bondcliff) â€” often tackled as a 19â€“23 mile day or an overnight traverse.</li>
              <li><strong>Owlâ€™s Head</strong> â€” known for a long approach with a loose slide and muddy valley miles.</li>
              <li><strong>The Wildcats</strong> â€” feature relentless grades that many describe as a backcountry stair climber.</li>
            </ul>
          </div>
        </div>
      </section>


      <!-- Risk & Preparedness Section - Migrated from homepage -->

<section class="section" id="peak-difficulty-guide" aria-label="Peak Difficulty Guide">
        <div class="section-banner light-text" style="background-image: url('https://photos.nh48.info/mount-jackson/mount-jackson__002.jpg'); background-size: cover; background-position: center 40%;">
          <h2><a href="#peak-difficulty-guide">Difficulty Guide</a></h2>
        </div>
        <div class="panel difficulty-guide">
          <p>Use these tier buttons to prioritize one difficulty level in the sortable table.</p>
          <div class="tiers-container">
            <button class="tier-badge tier-beginner" type="button" data-difficulty="beginner">
              <span class="tier-count">~10</span>
              <span class="tier-name">Beginner Friendly</span>
              <span class="tier-examples">Tecumseh, Pierce, Jackson, Osceola, Waumbek</span>
            </button>
            <button class="tier-badge tier-moderate" type="button" data-difficulty="moderate">
              <span class="tier-count">~15</span>
              <span class="tier-name">Moderate</span>
              <span class="tier-examples">Hancocks, Cabot, Galehead, Passaconaway</span>
            </button>
            <button class="tier-badge tier-challenging" type="button" data-difficulty="challenging">
              <span class="tier-count">~15</span>
              <span class="tier-name">Challenging</span>
              <span class="tier-examples">Lafayette, Lincoln, Carrigain, Wildcats</span>
            </button>
            <button class="tier-badge tier-severe" type="button" data-difficulty="severe">
              <span class="tier-count">~8</span>
              <span class="tier-name">Alpine / Exposed</span>
              <span class="tier-examples">Washington, Adams, Jefferson, Madison, Bonds</span>
            </button>
          </div>
        </div>
      </section>

      <!-- Day Trip Groupings Section - Migrated from homepage -->

<section class="section risk-stats" id="risk-preparedness" aria-label="Risk Factors and Preparedness">
        <div class="section-banner light-text" style="background-image: url('https://photos.nh48.info/mount-washington/mount-washington__002.jpg'); background-size: cover; background-position: center 35%;">
          <h2><a href="#risk-preparedness">Risk Factors &amp; Preparedness</a></h2>
        </div>
        <p>Weather changes quickly in the White Mountains; preparation is essential and rescue can take hours.</p>
        
        <div class="risk-grid stacked-grid">
          <button class="risk-box" type="button" data-risk="AboveTreelineExposure" aria-pressed="false">
            <span class="risk-title">??? Above Treeline Exposure</span>
            <span class="risk-value">15 Peaks</span>
            <p class="risk-description">Significant stretches above treeline with no shelter from weather. Lightning,
            high winds, and sudden whiteouts are real dangers.</p>
          </button>

          <button class="risk-box" type="button" data-risk="LongBailout" aria-pressed="false">
            <span class="risk-title">?? Long Bailout Distances</span>
            <span class="risk-value">Up to 9-10 Miles</span>
            <p class="risk-description">Remote peaks like Owl's Head, Bonds, and Isolation require long approaches.
            If something goes wrong, help is far away.</p>
          </button>

          <button class="risk-box" type="button" data-risk="LimitedWater" aria-pressed="false">
            <span class="risk-title">?? Limited Water Sources</span>
            <span class="risk-value">Many Routes Dry</span>
            <p class="risk-description">Unlike some mountain ranges, many NH trails have no reliable water sources.
            Carry all water you need - typically 2-4 liters per hike.</p>
          </button>

          <button class="risk-box" type="button" data-risk="ScrambleSteep" aria-pressed="false">
            <span class="risk-title">?? Scramble / Steep Terrain</span>
            <span class="risk-value">Hands-on Sections</span>
            <p class="risk-description">Steep ledges, ladders, or scrambling sections require careful footing and
            comfort with exposure.</p>
          </button>

          <button class="risk-box" type="button" data-risk="UnbridgedRiverCrossings" aria-pressed="false">
            <span class="risk-title">?? Unbridged Crossings</span>
            <span class="risk-value">Seasonal Risk</span>
            <p class="risk-description">High water can make crossings impassable. Plan alternative routes and start
            early during spring runoff.</p>
          </button>

          <button class="risk-box" type="button" data-risk="NoCellService" aria-pressed="false">
            <span class="risk-title">?? Especially Unreliable Cell Service</span>
            <span class="risk-value">Plan Offline</span>
            <p class="risk-description">Service can be spotty or nonexistent. Download maps and do not rely on your
            phone for navigation or emergency calls.</p>
          </button>
        </div>
      </section>

      <!-- Finish Strategies Section - Migrated from homepage -->

<section class="section" id="seasonal-considerations">
        <div class="section-banner dark-text" style="background-image: url('https://photos.nh48.info/mount-waumbek/mount-waumbek__003.jpg'); background-size: cover; background-position: center 35%;">
          <h2><a href="#seasonal-considerations">Seasonal Considerations</a></h2>
        </div>
        <p>
          Strategies shift every year as trailheads, roads, and weather patterns change. The AMC tracks winter finishers separately because road closures, avalanche zones, and snowpack reshape the effort. Use the toggle to switch between summer, fall, winter, and spring planning and verify access and forecasts with official sources.
        </p>
        <div class="toggle-group" role="tablist" aria-label="Toggle hiking season">
          <button id="summerBtn" class="active" type="button" role="tab" aria-pressed="true" aria-selected="true" aria-controls="seasonTable">Summer</button>
          <button id="fallBtn" type="button" role="tab" aria-pressed="false" aria-selected="false" aria-controls="seasonTable">Fall</button>
          <button id="winterBtn" type="button" role="tab" aria-pressed="false" aria-selected="false" aria-controls="seasonTable">Winter</button>
          <button id="springBtn" type="button" role="tab" aria-pressed="false" aria-selected="false" aria-controls="seasonTable">Spring</button>
        </div>
        <div class="table-scroll season-table">
          <table id="seasonTable">
            <thead>
              <tr>
                <th>Focus</th>
                <th id="seasonHeading">Summer Strategy</th>
              </tr>
            </thead>
            <tbody id="seasonRows"></tbody>
          </table>
        </div>
      </section>

<section class="section strategy-section" id="completion-strategies" aria-label="Finish Strategies">
        <div class="section-banner light-text" style="background-image: url('https://photos.nh48.info/mount-lafayette/mount-lafayette__003.jpg'); background-size: cover; background-position: center 35%;">
          <h2><a href="#completion-strategies">Choose Your Finish Strategy</a></h2>
        </div>
        <p>There's no single way to finish the list - pick the approach that matches your lifestyle and goals.</p>
        
        <div id="finishStrategyTiles" class="strategy-tiles stacked-grid">
          <div class="strategy-tile">
            <span class="strategy-icon">ðŸš€</span>
            <span class="strategy-name">Fast Finish</span>
            <span class="strategy-duration">~1 Year | 18-20 Day Hikes</span>
            <p class="strategy-description">Efficient multi-peak days, optimal groupings, and flexible scheduling. Best for experienced hikers with open calendars.</p>
          </div>
          
          <div class="strategy-tile">
            <span class="strategy-icon">ðŸ—“ï¸</span>
            <span class="strategy-name">Weekend Warrior</span>
            <span class="strategy-duration">2-4 Years | 30-40 Day Hikes</span>
            <p class="strategy-description">Steady progress with 2-3 peaks per trip on weekends. Balance between efficiency and enjoyment. Great for working professionals.</p>
          </div>
          
          <div class="strategy-tile">
            <span class="strategy-icon">ðŸŒ„</span>
            <span class="strategy-name">Scenic Journey</span>
            <span class="strategy-duration">4-6+ Years | 40+ Day Hikes</span>
            <p class="strategy-description">Savor each peak individually, explore different routes, and enjoy the journey. Photography and summit experiences take priority.</p>
          </div>
        </div>
      </section>

<section class="section" id="history">
        <div class="section-banner light-text" style="background-image: url('https://photos.nh48.info/mount-adams/mount-adams__003.jpg'); background-size: cover; background-position: center 35%;">
          <h2><a href="#history">History &amp; Rules Recap</a></h2>
        </div>
        <p>
          The AMC Four-Thousand-Footer Club launched officially in 1957 to encourage hikers into the deeper corners of the White Mountain National Forest. According to AMC guidelines, a peak must have 200 feet of prominence from any connecting col. Human-powered ascents are expectedâ€”using the Cog Railway or Cannonâ€™s tramway does not meet the guidelines.
        </p>
        <p>
          Thousands of finishers log their climbs by mailing the AMC application or joining online trackers. Please read the Appalachian Mountain Clubâ€™s introductory letter for the most accurate and current requirements, and verify any summary here with the official resource.
        </p>
        <p><a href="https://www.amc4000footer.org/" target="_blank" rel="noopener">Visit Official AMC 4000 Site for comprehensive details</a>.</p>
      </section>

<section class="section" id="data-api">
        <div class="section-banner light-text" style="background-image: url('https://photos.nh48.info/mount-tecumseh/mount-tecumseh__002.jpg'); background-size: cover; background-position: center 35%;">
          <h2><a href="#data-api">Data &amp; API Resources</a></h2>
        </div>
        <p>
          NH48.info exposes every peak as JSON so developers can build their own dashboards, weather overlays, or GPX generators. These community tools may contain inaccuracies and should be verified before use for navigation. The manifest powering this page includes elevations, coordinates, route notes, exposure ratings, and captioned photography with alt text. Grab the files directly or mirror them through a CDN.
        </p>
        <ul>
          <li><a href="https://nh48.info/data/nh48.json">NH48 JSON dataset</a> (all peaks and photo metadata)</li>
          <li><a href="https://nh48.info/manifest_out.json">Expanded manifest</a> (coordinates, routes, exposure, seasonality)</li>
          <li><a href="https://cdn.jsdelivr.net/gh/natesobol/nh48-api@main/data/nh48.json">jsDelivr CDN mirror</a> for cached pulls</li>
        </ul>
        <p>
          Developers: embed the table via fetch, use the map pins in GeoJSON, or remix the photos (with attribution) to power your own NH48 tracker. Please credit NH48.info for reused assets and confirm data against official sources when accuracy is critical.
        </p>
        <a class="cta" href="https://github.com/natesobol/nh48-api">Use the API</a>
      </section>

<section class="section" id="faq">
        <div class="section-banner light-text" style="background-image: url('https://photos.nh48.info/mount-liberty/mount-liberty__002.jpg'); background-size: cover; background-position: center 40%;">
          <h2><a href="#faq">Frequently Asked Questions</a></h2>
        </div>
        <p>
          These responses summarize common hiker opinions and may not reflect official AMC guidance. For definitive answers, <a href="https://www.amc4000footer.org/faq" target="_blank" rel="noopener">visit the official AMC FAQ</a>.
        </p>
        <div id="faqList"></div>
        <script>
          document.addEventListener('DOMContentLoaded', () => {
            const faqData = Array.from(document.querySelectorAll('script[type="application/ld+json"]'))
              .map((el) => {
                try {
                  return JSON.parse(el.textContent);
                } catch {
                  return null;
                }
              })
              .find((obj) => {
                if (!obj) return false;
                if (obj['@type'] === 'FAQPage') return true;
                if (Array.isArray(obj['@type'])) return obj['@type'].includes('FAQPage');
                return false;
              });

            const listContainer = document.getElementById('faqList');
            if (!faqData || !Array.isArray(faqData.mainEntity) || !listContainer) return;

            listContainer.innerHTML = '';
            faqData.mainEntity.forEach((entry) => {
              const wrapper = document.createElement('div');
              wrapper.className = 'faq-item';

              const question = document.createElement('strong');
              question.textContent = entry?.name || '';
              wrapper.appendChild(question);

              const answer = document.createElement('p');
              answer.textContent = entry?.acceptedAnswer?.text || '';
              wrapper.appendChild(answer);

              listContainer.appendChild(wrapper);
            });
          });
        </script>
      </section>

    </main>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
      let canonicalRanges = [];

      const peakSlugOverrides = {
        'South Twin': 'south-twin-mountain',
        'North Twin': 'north-twin-mountain',
        'Middle Carter': 'middle-carter-mountain',
        'South Carter': 'south-carter-mountain',
        'Wildcat A': 'wildcat-mountain-a',
        'Wildcat D': 'wildcat-mountain-d',
        'East Osceola': 'mount-osceola-east',
        'North Hancock': 'mount-hancock',
        'South Hancock': 'mount-hancock-south',
        'North Kinsman': 'north-kinsman-mountain',
        'South Kinsman': 'south-kinsman-mountain'
      };

      let rangeOrder = ['All'];
      let rangeDescriptions = {};
      let rangeLookup = {};
      let rangeColors = {};
      const selectedRanges = new Set();
      let selectedPeakSlug = null;

      const RISK_PALETTE = {
        AboveTreelineExposure: '#f97316',
        LongBailout: '#f59e0b',
        LimitedWater: '#facc15',
        ScrambleSteep: '#fb7185',
        UnbridgedRiverCrossings: '#38bdf8',
        NoCellService: '#94a3b8'
      };

      const RISK_PRIORITY = [
        'AboveTreelineExposure',
        'LongBailout',
        'LimitedWater',
        'ScrambleSteep',
        'UnbridgedRiverCrossings',
        'NoCellService'
      ];

      const RISK_LABELS = {
        AboveTreelineExposure: 'Above-treeline exposure',
        LongBailout: 'Long bailout',
        LimitedWater: 'Limited water',
        ScrambleSteep: 'Scramble / steep',
        UnbridgedRiverCrossings: 'Unbridged crossings',
        NoCellService: 'Especially Unreliable Cell Service'
      };
      const ALLOWED_RISKS = new Set(RISK_PRIORITY);

      const activeRiskFilters = new Set();
      let riskFiltersEnabled = false;
      let riskButtons = [];

      const buildRangeLookup = (data) => {
        const nameToSlug = {};
        Object.values(data).forEach((entry) => {
          const slug = entry.slug || entry.peakName?.toLowerCase().replace(/[^a-z0-9]+/g, '-');
          if (entry.peakName) nameToSlug[entry.peakName] = slug;
          if (entry['Peak Name']) nameToSlug[entry['Peak Name']] = slug;
        });

        const lookup = {};
        canonicalRanges.forEach((range) => {
          range.peaks.forEach((peakName) => {
            const slug = peakSlugOverrides[peakName] || nameToSlug[peakName];
            if (slug) {
              lookup[slug] = range.name;
            }
          });
        });
        return lookup;
      };

      function setRangeData(ranges) {
        canonicalRanges = ranges;
        rangeOrder = ['All', ...canonicalRanges.map((range) => range.name)];
        rangeDescriptions = canonicalRanges.reduce((acc, range) => {
          acc[range.name] = range.description;
          return acc;
        }, {});
        rangeColors = canonicalRanges.reduce((acc, range) => {
          acc[range.name] = range.color || '#22c55e';
          return acc;
        }, {});
      }

      function loadRanges() {
        return fetch('/data/wmnf-ranges.json', { headers: { 'Accept': 'application/json' } })
          .then((response) => (response.ok ? response.json() : Promise.reject(response)))
          .then((ranges) => {
            const resolved = Object.values(ranges).map((range) => ({
              name: range.rangeName,
              peaks: range.peakList,
              description: range.description,
              color: range.color
            }));
            setRangeData(resolved);
          })
          .catch((err) => {
            console.error('Failed to load range data', err);
            setRangeData([]);
          });
      }

      const difficultyMap = {
        'mount-tecumseh': 'beginner',
        'mount-waumbek': 'beginner',
        'mount-pierce': 'beginner',
        'mount-jackson': 'beginner',
        'mount-osceola': 'beginner',
        'mount-hale': 'beginner',
        'mount-carrigain': 'challenging',
        'owls-head': 'challenging',
        'mount-isolation': 'challenging',
        'mount-whiteface': 'challenging',
        'mount-passaconaway': 'challenging',
        'wildcat-mountain-a': 'challenging',
        'wildcat-mountain-d': 'challenging',
        'mount-washington': 'severe',
        'mount-adams': 'severe',
        'mount-jefferson': 'severe',
        'mount-madison': 'severe',
        'mount-lafayette': 'severe',
        'mount-lincoln': 'severe',
        'bondcliff': 'severe',
        'mount-monroe': 'severe'
      };

      const difficultyOrder = ['beginner', 'moderate', 'challenging', 'severe'];

      let peaks = [];
      let currentRange = 'All';
      let sortState = {
        key: 'name',
        direction: 'asc',
        difficultyPriority: null
      };
      let itemListSchemaEl;

      const seasonRows = {
        summer: [
          ['Trail access', 'Many trailheads open after mud season, but check WMNF alerts and AMC updates for closures or construction detours.'],
          ['Gear', 'Light layers, sun protection, bug netting in early summer, and traction for lingering monorail snow.'],
          ['Strategy', 'Long days allow big mileage, but plan early starts for exposed ridges and carry a headlamp for storm delays.'],
          ['Road notes', 'Tripoli Road (Tecumseh/Osceola) and Zealand Road often open after mud season; confirm status with official updates.'],
          ['Navigation', 'Above-treeline routes on Washington, Jefferson, and Adams require careful rock hopping, bailout awareness, and staying on trail to protect fragile alpine terrain.'],
          ['Additional hazards', 'Thunderstorms, heat exhaustion, and biting insects are common; check the Mt. Washington Observatory forecast before committing to exposed routes.']
        ],
        fall: [
          ['Trail access', 'Roads and trailheads remain mostly open through mid-October, but gate closures begin after Columbus Day; leaf-peeper traffic can crowd parking. Expect first snows above 3,500 ft by November and occasional maintenance closures.'],
          ['Gear', 'Dress for variable conditions with warm layers, hats, and gloves; pack rain gear and waterproof boots for wet leaves and early snow. Carry microspikes by late fall and wear blaze orange during hunting season (mid-Oct to Dec).'],
          ['Strategy', 'Shorter days demand early starts and a headlamp; plan to be off exposed ridges by mid-afternoon and avoid steep leaf-covered descents in the dark.'],
          ['Road notes', 'Seasonal roads like Tripoli Road and Zealand Road often close in mid-October; the Kancamagus Highway remains open year-round. Check NH DOT or WMNF for closure dates.'],
          ['Navigation', 'Fallen leaves hide rocks, roots, and wet ledges, and above-treeline trails can ice early; carry traction, map, and GPS and verify junctions.'],
          ['Additional hazards', 'Hunting season and early freezes raise hypothermia risk after sunset; keep dogs visible and confirm conditions with the AMC, WMNF, and Mt. Washington Observatory.']
        ],
        winter: [
          ['Trail access', 'Gated roads (Zealand, Tripoli, Sawyer River) often add miles to Osceola, Zealand, and Carrigain; verify current access with WMNF and AMC updates.'],
          ['Gear', 'Snowshoes (when depth >8"), microspikes, goggles, four-season shells, and hot backups for electronics.'],
          ['Strategy', 'Short daylight usually demands pre-dawn starts and a headlamp; sheltered routes (Pierce, Waumbek, Tecumseh) are popular in high winds.'],
          ['Road notes', 'Cog Railway and Cannon tram do not count toward AMC credit; plan self-propelled ascents from winter lots.'],
          ['Navigation', 'Whiteouts on the Presidential Range make cairn-to-cairn travel hazardous; carry map, compass, and GPX and stay on trail to protect alpine terrain.'],
          ['Additional hazards', 'Frostbite, avalanches, and ice dams are real risks; review avalanche bulletins and the Mt. Washington Observatory forecast before committing.']
        ],
        spring: [
          ['Trail access', 'Mud season limits access: many USFS roads (Tripoli, Zealand, Sawyer River) remain gated until late May, adding miles to peaks like Osceola, Carrigain, and Zealand. Some trails close temporarily to protect them from erosion. Snowpack persists on north-facing slopes into June and water crossings may be high.'],
          ['Gear', 'Prepare for shoulder-season conditions: winter traction remains necessary (snowshoes early, microspikes later). Waterproof boots, gaiters, and dry socks are essential; pack insect repellent for black flies and mosquitoes in May and June and do tick checks after hikes.'],
          ['Strategy', 'Plan for slow travel on rotten snow and mud, start early to cross swollen streams before afternoon melt, and favor south-facing routes for less snow. Carry a headlamp as days lengthen but weather remains volatile.'],
          ['Road notes', 'Gated roads add 2-4 miles to Osceola, Zealand, Carrigain, and Hale approaches. The Mount Washington Auto Road and Cannon Tramway may be closed for spring maintenance; mechanical ascents do not count toward AMC credit anyway.'],
          ['Navigation', 'Snow bridges can collapse as thaw progresses; have backup routes for impassable crossings. Deep snow hides trail corridors, so use GPS tracks and a compass and watch for avalanche danger in steep gullies like Tuckerman\'s Ravine.'],
          ['Additional hazards', 'Deep mud causes erosion, so hike through the center of muddy sections. Black flies peak in late May and June and ticks can carry Lyme disease; treat clothing with permethrin and confirm conditions with WMNF alerts.']
        ]
      };

      function parseCoords(coordString) {
        if (!coordString || typeof coordString !== 'string' || !coordString.includes(',')) return null;
        const [lat, lon] = coordString.split(',').map((v) => parseFloat(v.trim()));
        if (Number.isFinite(lat) && Number.isFinite(lon)) return { lat, lon };
        return null;
      }

      function buildFallbackCoords(data) {
        if (!data) return {};
        const lookup = {};
        Object.values(data).forEach((entry) => {
          const slug = entry.slug || entry.peakName?.toLowerCase().replace(/[^a-z0-9]+/g, '-');
          const coords = parseCoords(entry.Coordinates);
          if (slug && coords) {
            lookup[slug] = coords;
          }
        });
        return lookup;
      }

      function loadFallbackCoords() {
        return fetch('/data/nh48.json', { headers: { 'Accept': 'application/json' } })
          .then((response) => (response.ok ? response.json() : null))
          .then((data) => (data ? buildFallbackCoords(data) : null))
          .catch(() => null);
      }

      function hexToRgba(hex, alpha) {
        if (!hex || typeof hex !== 'string') return `rgba(239, 68, 68, ${alpha})`;
        let value = hex.replace('#', '').trim();
        if (value.length === 3) {
          value = value.split('').map((c) => c + c).join('');
        }
        if (value.length !== 6) return `rgba(239, 68, 68, ${alpha})`;
        const r = parseInt(value.slice(0, 2), 16);
        const g = parseInt(value.slice(2, 4), 16);
        const b = parseInt(value.slice(4, 6), 16);
        if ([r, g, b].some((v) => Number.isNaN(v))) return `rgba(239, 68, 68, ${alpha})`;
        return `rgba(${r}, ${g}, ${b}, ${alpha})`;
      }

      function peakMatchesRisk(peak) {
        if (!activeRiskFilters.size) return true;
        const factors = Array.isArray(peak.riskFactors) ? peak.riskFactors : [];
        return Array.from(activeRiskFilters).every((risk) => factors.includes(risk));
      }

      function filterPeaksByRisk(list) {
        if (!activeRiskFilters.size) return list;
        return list.filter(peakMatchesRisk);
      }

      function getRiskColorForPeak(peak) {
        if (!activeRiskFilters.size) return null;
        const factors = Array.isArray(peak.riskFactors) ? peak.riskFactors : [];
        for (const risk of RISK_PRIORITY) {
          if (activeRiskFilters.has(risk) && factors.includes(risk)) {
            return RISK_PALETTE[risk] || '#ef4444';
          }
        }
        return null;
      }

      function getPeakColor(peak) {
        const riskColor = getRiskColorForPeak(peak);
        return riskColor || rangeColors[peak.range] || '#22c55e';
      }

      function updateRiskButtonStates() {
        if (!riskButtons.length) return;
        riskButtons.forEach((btn) => {
          const risk = btn.dataset.risk;
          if (risk && RISK_PALETTE[risk]) {
            btn.style.setProperty('--risk-color', RISK_PALETTE[risk]);
          }
          const isActive = activeRiskFilters.has(risk);
          btn.classList.toggle('is-active', isActive);
          btn.setAttribute('aria-pressed', isActive ? 'true' : 'false');
        });
      }

      function setRiskFiltersEnabled(enabled) {
        riskFiltersEnabled = enabled;
        if (!riskButtons.length) return;
        riskButtons.forEach((btn) => {
          btn.classList.toggle('is-disabled', !enabled);
          btn.setAttribute('aria-disabled', !enabled ? 'true' : 'false');
          if (!enabled) {
            btn.classList.remove('is-active');
            btn.setAttribute('aria-pressed', 'false');
          }
        });
      }

      function updateRiskCounts() {
        if (!riskButtons.length) return;
        riskButtons.forEach((btn) => {
          const risk = btn.dataset.risk;
          const valueEl = btn.querySelector('.risk-value');
          if (!valueEl) return;
          const count = peaks.filter((peak) => Array.isArray(peak.riskFactors) && peak.riskFactors.includes(risk)).length;
          valueEl.textContent = `${count} Peaks`;
        });
      }

      function setupRiskFilters() {
        riskButtons = Array.from(document.querySelectorAll('.risk-box[data-risk]'));
        if (!riskButtons.length) return;
        riskButtons.forEach((btn) => {
          const risk = btn.dataset.risk;
          if (risk && RISK_PALETTE[risk]) {
            btn.style.setProperty('--risk-color', RISK_PALETTE[risk]);
          }
          btn.addEventListener('click', () => {
            if (!riskFiltersEnabled) return;
            if (activeRiskFilters.has(risk)) {
              activeRiskFilters.delete(risk);
            } else {
              activeRiskFilters.add(risk);
            }
            selectedPeakSlug = null;
            updateRiskButtonStates();
            renderPeakTable();
            scheduleMapRender();
          });
        });
        setRiskFiltersEnabled(false);
        updateRiskButtonStates();
      }

      function getRange(entry, slug) {
        if (rangeLookup[slug]) return rangeLookup[slug];
        const range = entry['Range / Subrange'];
        if (range && typeof range === 'string') {
          const normalized = range.toLowerCase();
          if (normalized.includes('presidential')) return 'Presidential Range';
          if (normalized.includes('franconia')) return 'Franconia Range';
          if (normalized.includes('kinsman') || normalized.includes('moosilauke') || normalized.includes('cannon')) return 'Kinsman Range';
          if (normalized.includes('carter') || normalized.includes('moriah') || normalized.includes('wildcat')) return 'Carter-Moriah Range';
          if (normalized.includes('twin') || normalized.includes('bond')) return 'Twin Range';
          if (normalized.includes('willey') || normalized.includes('field') || normalized.includes('tom')) return 'Willey Range';
          if (normalized.includes('pilot') || normalized.includes('pliny') || normalized.includes('kilkenny') || normalized.includes('cabot') || normalized.includes('waumbek')) {
            return 'Pilotâ€“Pliny Range';
          }
          if (normalized.includes('sandwich') || normalized.includes('waterville') || normalized.includes('osceola') || normalized.includes('tripyramid') || normalized.includes('tecumseh') || normalized.includes('passaconaway') || normalized.includes('whiteface')) {
            return 'Sandwich / Waterville Range';
          }
          if (normalized.includes('pemigewasset') || normalized.includes('pemi') || normalized.includes('wilderness')) return 'Pemigewasset Wilderness';
        }
        return 'Pemigewasset Wilderness';
      }

      function renderRangeFilters() {
        const container = document.getElementById('rangeFilters');
        container.innerHTML = '';
        rangeOrder.forEach((label) => {
          const btn = document.createElement('button');
          btn.className = `chip ${currentRange === label ? 'active' : ''}`;
          btn.type = 'button';
          btn.textContent = label;
          btn.dataset.range = label;
          btn.setAttribute('aria-pressed', currentRange === label ? 'true' : 'false');
          btn.setAttribute('aria-controls', 'peakTableBody');
          btn.addEventListener('click', () => {
            currentRange = label;
            selectedRanges.clear();
            selectedPeakSlug = null;
            renderRangeFilters();
            renderRangeList();
            renderPeakTable();
            scheduleMapRender();
          });
          container.appendChild(btn);
        });
      }

      function renderRangeList() {
        const list = document.getElementById('rangeList');
        list.innerHTML = '';
        rangeOrder.filter((r) => r !== 'All').forEach((range) => {
          const card = document.createElement('button');
          card.className = 'range-card';
          card.type = 'button';
          const isActive = selectedRanges.has(range);
          card.classList.toggle('active', isActive);
          card.setAttribute('aria-pressed', isActive ? 'true' : 'false');
          const desc = rangeDescriptions[range] || '';
          card.setAttribute('aria-label', desc ? `${range}. ${desc}` : range);
          if (desc) card.setAttribute('title', desc);

          const nameWrap = document.createElement('span');
          nameWrap.style.display = 'inline-flex';
          nameWrap.style.alignItems = 'center';
          nameWrap.style.gap = '8px';

          const dot = document.createElement('span');
          dot.className = 'range-card__dot';
          dot.style.background = rangeColors[range] || '#22c55e';

          const label = document.createElement('span');
          label.className = 'range-card__name';
          label.textContent = range;

          const hiddenDesc = document.createElement('span');
          hiddenDesc.className = 'sr-only';
          hiddenDesc.textContent = desc;

          const status = document.createElement('span');
          status.className = 'range-card__chip';
          status.textContent = isActive ? 'Selected' : 'Select';

          nameWrap.appendChild(dot);
          nameWrap.appendChild(label);
          nameWrap.appendChild(hiddenDesc);
          card.appendChild(nameWrap);
          card.appendChild(status);
          card.addEventListener('click', () => {
            if (selectedRanges.has(range)) {
              selectedRanges.delete(range);
            } else {
              selectedRanges.add(range);
            }
            selectedPeakSlug = null;
            renderRangeList();
            scheduleMapRender();
          });
          list.appendChild(card);
        });
      }

      function focusMapOnPeak(peak) {
        if (!peak) return;
        selectedPeakSlug = peak.slug;
        selectedRanges.clear();
        currentRange = 'All';
        renderRangeFilters();
        renderRangeList();
        scheduleMapRender();
        const mapSection = document.getElementById('range-map');
        if (mapSection) {
          mapSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
      }

      function renderPeakTable() {
        const tbody = document.getElementById('peakTableBody');
        tbody.innerHTML = '';
        let filtered = currentRange === 'All' ? peaks : peaks.filter((p) => p.range === currentRange);
        filtered = filterPeaksByRisk(filtered);
        const sorted = [...filtered].sort((a, b) => {
          if (sortState.key === 'elevation') {
            const aVal = a.elevation ?? (sortState.direction === 'asc' ? Number.POSITIVE_INFINITY : Number.NEGATIVE_INFINITY);
            const bVal = b.elevation ?? (sortState.direction === 'asc' ? Number.POSITIVE_INFINITY : Number.NEGATIVE_INFINITY);
            return sortState.direction === 'asc' ? aVal - bVal : bVal - aVal;
          }
          if (sortState.key === 'range') {
            const rangeCompare = a.range.localeCompare(b.range);
            return sortState.direction === 'asc' ? rangeCompare || a.name.localeCompare(b.name) : (rangeCompare || a.name.localeCompare(b.name)) * -1;
          }
          if (sortState.key === 'difficulty') {
            const baseRank = (value) => {
              const idx = difficultyOrder.indexOf(value);
              return idx === -1 ? difficultyOrder.length : idx;
            };
            const aRank = baseRank(a.difficulty) + (sortState.difficultyPriority === a.difficulty ? -1 : 0);
            const bRank = baseRank(b.difficulty) + (sortState.difficultyPriority === b.difficulty ? -1 : 0);
            if (aRank !== bRank) return aRank - bRank;
            return a.name.localeCompare(b.name);
          }
          return a.name.localeCompare(b.name);
        });
        if (!sorted.length) {
          tbody.innerHTML = '<tr><td colspan="5">No peaks match the current filters.</td></tr>';
          updateSortIndicators();
          return;
        }

        sorted.forEach((peak) => {
          const tr = document.createElement('tr');
          tr.classList.add(`tier-${peak.difficulty}`);
          const riskColor = getRiskColorForPeak(peak);
          if (riskColor) {
            tr.classList.add('hazard-row');
            tr.style.setProperty('--hazard-color', riskColor);
            tr.style.setProperty('--hazard-bg', hexToRgba(riskColor, 0.08));
            tr.style.setProperty('--hazard-bg-hover', hexToRgba(riskColor, 0.16));
          }
          const peakCell = document.createElement('td');
          const link = document.createElement('a');
          link.href = `/peak/${peak.slug}/`;
          link.textContent = peak.name;
          peakCell.appendChild(link);

          const elevCell = document.createElement('td');
          elevCell.textContent = peak.elevation ? peak.elevation.toLocaleString() : 'â€”';

          const rangeCell = document.createElement('td');
          rangeCell.textContent = peak.range;

          const diffCell = document.createElement('td');
          const difficultyBadge = document.createElement('span');
          difficultyBadge.className = `difficulty-badge tier-${peak.difficulty}`;
          difficultyBadge.textContent = `${peak.difficulty.charAt(0).toUpperCase()}${peak.difficulty.slice(1)}`;
          diffCell.appendChild(difficultyBadge);

          const actionCell = document.createElement('td');
          const actionWrap = document.createElement('div');
          actionWrap.className = 'table-actions';
          const viewLink = document.createElement('a');
          viewLink.className = 'table-action';
          viewLink.href = `/peak/${peak.slug}/`;
          viewLink.textContent = 'Details';
          viewLink.setAttribute('aria-label', `Open ${peak.name} detail page`);
          const mapBtn = document.createElement('button');
          mapBtn.className = 'table-action';
          mapBtn.type = 'button';
          mapBtn.textContent = 'Map';
          mapBtn.setAttribute('aria-label', `Show ${peak.name} on the map`);
          mapBtn.addEventListener('click', () => focusMapOnPeak(peak));
          actionWrap.appendChild(viewLink);
          actionWrap.appendChild(mapBtn);
          actionCell.appendChild(actionWrap);

          tr.appendChild(peakCell);
          tr.appendChild(elevCell);
          tr.appendChild(rangeCell);
          tr.appendChild(diffCell);
          tr.appendChild(actionCell);
          tbody.appendChild(tr);
        });
        updateSortIndicators();
      }
      let mapRenderQueued = false;
      let mapResizeObserver = null;
      let leafletMap = null;
      let leafletLayer = null;
      let leafletMarkers = null;
      let leafletBounds = null;
      let activeMapStyle = 'osm';

      function scheduleMapRender() {
        if (mapRenderQueued) return;
        mapRenderQueued = true;
        requestAnimationFrame(() => {
          mapRenderQueued = false;
          renderMap();
        });
      }

      function getActiveMapRanges() {
        if (selectedPeakSlug) return [];
        if (selectedRanges.size > 0) return Array.from(selectedRanges);
        if (currentRange && currentRange !== 'All') return [currentRange];
        return [];
      }

      function updateMapLegend(activeRanges, peakFocus) {
        const legendLabel = document.getElementById('mapLegendLabel');
        const legendItems = document.getElementById('mapLegendItems');
        const legendDot = document.getElementById('mapLegendDot');
        if (legendItems) legendItems.innerHTML = '';
        const activeRisks = RISK_PRIORITY.filter((risk) => activeRiskFilters.has(risk));
        if (peakFocus) {
          if (legendLabel) legendLabel.textContent = `NH48 Summit: ${peakFocus.name}`;
          if (legendDot) legendDot.style.background = getPeakColor(peakFocus);
          return;
        }
        if (activeRisks.length) {
          const labels = activeRisks.map((risk) => RISK_LABELS[risk] || risk);
          if (legendLabel) legendLabel.textContent = `Risk Filters: ${labels.join(', ')}`;
          if (legendDot) {
            legendDot.style.background = activeRisks.length === 1 ? (RISK_PALETTE[activeRisks[0]] || '#ef4444') : '#94a3b8';
          }
          if (!legendItems) return;
          activeRisks.forEach((risk) => {
            const item = document.createElement('span');
            item.className = 'map-legend-item';
            const dot = document.createElement('span');
            dot.className = 'legend-dot';
            dot.style.background = RISK_PALETTE[risk] || '#ef4444';
            const label = document.createElement('span');
            label.textContent = RISK_LABELS[risk] || risk;
            item.appendChild(dot);
            item.appendChild(label);
            legendItems.appendChild(item);
          });
          return;
        }
        if (!activeRanges.length) {
          if (legendLabel) legendLabel.textContent = 'NH48 Summits (All ranges)';
          if (legendDot) legendDot.style.background = '#22c55e';
          return;
        }
        if (legendLabel) legendLabel.textContent = 'NH48 Summits (Selected ranges)';
        if (legendDot) legendDot.style.background = '#94a3b8';
        if (!legendItems) return;
        activeRanges.forEach((range) => {
          const item = document.createElement('span');
          item.className = 'map-legend-item';
          const dot = document.createElement('span');
          dot.className = 'legend-dot';
          dot.style.background = rangeColors[range] || '#22c55e';
          const label = document.createElement('span');
          label.textContent = range;
          item.appendChild(dot);
          item.appendChild(label);
          legendItems.appendChild(item);
        });
      }

      function getFilteredMapPeaks() {
        const coords = peaks.filter((p) => p.coords);
        const activeRanges = getActiveMapRanges();
        const peakFocus = selectedPeakSlug ? peaks.find((p) => p.slug === selectedPeakSlug) : null;
        let filtered = coords;
        if (peakFocus) {
          filtered = coords.filter((p) => p.slug === selectedPeakSlug);
        } else {
          filtered = filterPeaksByRisk(coords);
          if (activeRanges.length) {
            filtered = filtered.filter((p) => activeRanges.includes(p.range));
          }
        }
        return { coords, filtered, activeRanges, peakFocus };
      }

      function renderMap() {
        const map = document.getElementById('peakMap');
        map.innerHTML = '';
        const { coords, filtered, activeRanges, peakFocus } = getFilteredMapPeaks();
        updateMapLegend(activeRanges, peakFocus);
        if (!filtered.length) {
          map.innerHTML = coords.length ? '<text x="10" y="30" fill="#cbd5e1">No peaks match the current filters.</text>' : '<text x="10" y="30" fill="#cbd5e1">No coordinate data available.</text>';
          renderLeafletMap(filtered);
          return;
        }
        const boundsSource = filtered.length ? filtered : coords;
        const lats = boundsSource.map((c) => c.coords.lat);
        const lons = boundsSource.map((c) => c.coords.lon);
        const minLat = Math.min(...lats);
        const maxLat = Math.max(...lats);
        const minLon = Math.min(...lons);
        const maxLon = Math.max(...lons);
        const padding = 20;
        const mapBounds = map.getBoundingClientRect();
        const width = Math.max(map.clientWidth || 0, mapBounds.width || 0, 800);
        const height = Math.max(map.clientHeight || 0, mapBounds.height || 0, 360);
        map.setAttribute('width', width);
        map.setAttribute('height', height);
        map.setAttribute('viewBox', `0 0 ${width} ${height}`);
        map.setAttribute('preserveAspectRatio', 'xMidYMid meet');
        const latSpan = maxLat - minLat || 1;
        const lonSpan = maxLon - minLon || 1;

        function project(lat, lon) {
          const x = ((lon - minLon) / lonSpan) * (width - padding * 2) + padding;
          const y = ((maxLat - lat) / latSpan) * (height - padding * 2) + padding;
          return { x, y };
        }

        const ns = 'http://www.w3.org/2000/svg';
        const defs = document.createElementNS(ns, 'defs');
        const gradient = document.createElementNS(ns, 'linearGradient');
        gradient.setAttribute('id', 'topoGradient');
        gradient.setAttribute('x1', '0%');
        gradient.setAttribute('y1', '0%');
        gradient.setAttribute('x2', '0%');
        gradient.setAttribute('y2', '100%');
        const stopA = document.createElementNS(ns, 'stop');
        stopA.setAttribute('offset', '0%');
        stopA.setAttribute('stop-color', '#0f172a');
        const stopB = document.createElementNS(ns, 'stop');
        stopB.setAttribute('offset', '100%');
        stopB.setAttribute('stop-color', '#111827');
        gradient.appendChild(stopA);
        gradient.appendChild(stopB);
        defs.appendChild(gradient);
        map.appendChild(defs);

        const backdrop = document.createElementNS(ns, 'rect');
        backdrop.setAttribute('x', '0');
        backdrop.setAttribute('y', '0');
        backdrop.setAttribute('width', width);
        backdrop.setAttribute('height', height);
        backdrop.setAttribute('fill', 'url(#topoGradient)');
        map.appendChild(backdrop);

        const contourGroup = document.createElementNS(ns, 'g');
        contourGroup.setAttribute('opacity', '0.4');
        for (let i = 0; i < 10; i += 1) {
          const baseY = (height / 11) * (i + 1);
          const amplitude = 6 + (i % 3) * 4;
          const frequency = (Math.PI * 2) / width;
          let d = `M 0 ${baseY.toFixed(2)}`;
          for (let x = 0; x <= width; x += 40) {
            const y = baseY + Math.sin(x * frequency + i) * amplitude;
            d += ` L ${x.toFixed(2)} ${y.toFixed(2)}`;
          }
          const path = document.createElementNS(ns, 'path');
          path.setAttribute('d', d);
          path.setAttribute('fill', 'none');
          path.setAttribute('stroke', 'rgba(148, 163, 184, 0.35)');
          path.setAttribute('stroke-width', '1');
          contourGroup.appendChild(path);
        }
        map.appendChild(contourGroup);

        filtered.forEach((peak) => {
          const { x, y } = project(peak.coords.lat, peak.coords.lon);
          const circle = document.createElementNS(ns, 'circle');
          const color = getPeakColor(peak);
          circle.setAttribute('cx', x);
          circle.setAttribute('cy', y);
          circle.setAttribute('r', peakFocus ? 7 : 5);
          circle.setAttribute('fill', color);
          circle.setAttribute('stroke', 'var(--bg)');
          circle.setAttribute('stroke-width', peakFocus ? '2' : '1');
          circle.setAttribute('aria-label', peak.name);
          circle.addEventListener('mouseenter', () => {
            circle.setAttribute('fill', '#4ade80');
          });
          circle.addEventListener('mouseleave', () => {
            circle.setAttribute('fill', color);
          });
          circle.addEventListener('click', () => {
            window.open(`/peak/${peak.slug}/`, '_blank');
          });
          map.appendChild(circle);
        });

        renderLeafletMap(filtered);
      }

      function renderSeasonTable(season) {
        const tbody = document.getElementById('seasonRows');
        const heading = document.getElementById('seasonHeading');
        const seasonLabels = {
          summer: 'Summer',
          fall: 'Fall',
          winter: 'Winter',
          spring: 'Spring'
        };
        heading.textContent = `${seasonLabels[season] || 'Summer'} Strategy`;
        tbody.innerHTML = '';
        seasonRows[season].forEach(([topic, detail]) => {
          const tr = document.createElement('tr');
          const t1 = document.createElement('td');
          t1.textContent = topic;
          const t2 = document.createElement('td');
          t2.textContent = detail;
          tr.appendChild(t1);
          tr.appendChild(t2);
          tbody.appendChild(tr);
        });
      }

      function updateSeasonToggle(season) {
        const seasonButtons = {
          summer: document.getElementById('summerBtn'),
          fall: document.getElementById('fallBtn'),
          winter: document.getElementById('winterBtn'),
          spring: document.getElementById('springBtn')
        };
        Object.entries(seasonButtons).forEach(([key, button]) => {
          if (!button) return;
          const isActive = season === key;
          button.classList.toggle('active', isActive);
          button.setAttribute('aria-pressed', isActive ? 'true' : 'false');
          button.setAttribute('aria-selected', isActive ? 'true' : 'false');
        });
      }

      function renderDataLoadError(message) {
        setRiskFiltersEnabled(false);
        document.getElementById('peakTableBody').innerHTML = `<tr><td colspan="5">${message}</td></tr>`;
        const map = document.getElementById('peakMap');
        map.innerHTML = '<text x="10" y="30" fill="#cbd5e1">Map data unavailable.</text>';
        renderLeafletMap([]);
      }

      function observeMapResize() {
        if (mapResizeObserver) return;
        const map = document.getElementById('peakMap');
        if (!map || typeof ResizeObserver === 'undefined') return;
        mapResizeObserver = new ResizeObserver(() => {
          scheduleMapRender();
        });
        mapResizeObserver.observe(map);
      }

      function initLeafletMap() {
        if (leafletMap || typeof L === 'undefined') return;
        const container = document.getElementById('peakMapLeaflet');
        if (!container) return;
        leafletMap = L.map(container, {
          zoomControl: false,
          scrollWheelZoom: false,
          dragging: true,
          doubleClickZoom: false,
          boxZoom: false,
          keyboard: false,
          tap: false
        });
        leafletLayer = L.tileLayer('https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png', {
          maxZoom: 17,
          attribution: 'Map data Â© OpenStreetMap contributors, SRTM | Tiles Â© OpenTopoMap'
        }).addTo(leafletMap);
        leafletMarkers = L.layerGroup().addTo(leafletMap);
      }

      function renderLeafletMap(points) {
        if (activeMapStyle !== 'osm') return;
        initLeafletMap();
        if (!leafletMap || !leafletMarkers) return;
        leafletMarkers.clearLayers();
        if (!points || !points.length) return;
        const isPeakFocus = points.length === 1 && selectedPeakSlug && points[0]?.slug === selectedPeakSlug;
        const latLngs = points.map((peak) => {
          const color = getPeakColor(peak);
          const latLng = [peak.coords.lat, peak.coords.lon];
          const marker = L.circleMarker(latLng, {
            radius: isPeakFocus ? 7 : 5,
            color: '#0b1220',
            weight: 1,
            fillColor: color,
            fillOpacity: 0.95
          });
          marker.bindTooltip(peak.name, { direction: 'top', offset: [0, -6], opacity: 0.9 });
          marker.on('click', () => {
            window.open(`/peak/${peak.slug}/`, '_blank');
          });
          marker.addTo(leafletMarkers);
          return latLng;
        });
        leafletBounds = L.latLngBounds(latLngs);
        leafletMap.fitBounds(leafletBounds.pad(0.2), { animate: false });
      }

      function setMapStyle(style) {
        activeMapStyle = style;
        const stylizedBtn = document.getElementById('mapStyleStylized');
        const osmBtn = document.getElementById('mapStyleOsm');
        const svgMap = document.getElementById('peakMap');
        const leafletEl = document.getElementById('peakMapLeaflet');
        if (stylizedBtn && osmBtn) {
          stylizedBtn.classList.toggle('active', style === 'stylized');
          osmBtn.classList.toggle('active', style === 'osm');
          stylizedBtn.setAttribute('aria-selected', style === 'stylized' ? 'true' : 'false');
          osmBtn.setAttribute('aria-selected', style === 'osm' ? 'true' : 'false');
        }
        if (svgMap && leafletEl) {
          svgMap.style.display = style === 'stylized' ? 'block' : 'none';
          leafletEl.style.display = style === 'osm' ? 'block' : 'none';
        }
        if (style === 'osm') {
          initLeafletMap();
          setTimeout(() => {
            if (leafletMap) {
              leafletMap.invalidateSize();
              if (leafletBounds) {
                leafletMap.fitBounds(leafletBounds.pad(0.2), { animate: false });
              }
            }
          }, 60);
          const { filtered } = getFilteredMapPeaks();
          renderLeafletMap(filtered);
        }
      }

      function renderItemListSchema() {
        if (itemListSchemaEl) itemListSchemaEl.remove();
        const script = document.createElement('script');
        script.type = 'application/ld+json';
        const itemList = {
          '@context': 'https://schema.org',
          '@type': 'ItemList',
          name: 'NH48 Peaks',
          description: 'Community directory of the New Hampshire 4,000-footers with links to every peak detail page; confirm details with the AMC.',
          numberOfItems: peaks.length,
          itemListOrder: 'Ascending',
          itemListElement: peaks.map((peak, index) => ({
            '@type': 'ListItem',
            position: index + 1,
            name: peak.name,
            url: `https://nh48.info/peak/${peak.slug}/`,
            description: `${peak.range} peak`
          }))
        };
        script.textContent = JSON.stringify(itemList, null, 2);
        document.body.appendChild(script);
        itemListSchemaEl = script;
      }

      function setupTocObserver() {
        const links = Array.from(document.querySelectorAll('.toc a[href^="#"]'));
        const sections = links
          .map((link) => document.querySelector(link.getAttribute('href')))
          .filter(Boolean);
        if (!links.length || !sections.length) return;

        const setActive = (id) => {
          links.forEach((link) => {
            const isActive = link.getAttribute('href') === `#${id}`;
            link.classList.toggle('active', isActive);
            if (isActive) {
              link.setAttribute('aria-current', 'true');
            } else {
              link.removeAttribute('aria-current');
            }
          });
        };

        const observer = new IntersectionObserver(
          (entries) => {
            const visible = entries
              .filter((entry) => entry.isIntersecting)
              .sort((a, b) => b.intersectionRatio - a.intersectionRatio)[0];
            if (visible?.target?.id) setActive(visible.target.id);
          },
          { rootMargin: '-25% 0px -60% 0px', threshold: [0.1, 0.4, 0.7] }
        );

        sections.forEach((section) => observer.observe(section));
      }

      function updateSortIndicators() {
        document.querySelectorAll('th[data-sort-key]').forEach((th) => {
          const key = th.dataset.sortKey;
          const isActive = sortState.key === key;
          th.setAttribute('aria-sort', isActive ? (sortState.direction === 'asc' ? 'ascending' : 'descending') : 'none');
          const indicator = th.querySelector('.sort-indicator');
          if (indicator) {
            indicator.textContent = isActive ? (sortState.direction === 'asc' ? 'â–²' : 'â–¼') : '';
          }
        });
      }

      function hydratePeaks(data, overlay, fallbackCoords) {
        rangeLookup = buildRangeLookup(data);
        peaks = Object.values(data).map((entry) => {
          const slug = entry.slug || entry.peakName?.toLowerCase().replace(/[^a-z0-9]+/g, '-');
          const overlayEntry = overlay && overlay[slug] ? overlay[slug] : null;
          const overlayLat = overlayEntry && Number.isFinite(overlayEntry.latitude) ? overlayEntry.latitude : null;
          const overlayLon = overlayEntry && Number.isFinite(overlayEntry.longitude) ? overlayEntry.longitude : null;
          const fallback = fallbackCoords && fallbackCoords[slug] ? fallbackCoords[slug] : null;
          const coords = overlayLat !== null && overlayLon !== null
            ? { lat: overlayLat, lon: overlayLon }
            : (fallback || parseCoords(entry.Coordinates));
            const rawRiskFactors = Array.isArray(overlayEntry?.risk_factors) ? overlayEntry.risk_factors : [];
            const filteredRiskFactors = rawRiskFactors.filter((risk) => ALLOWED_RISKS.has(risk));
            return {
            slug,
            name: entry.peakName || entry['Peak Name'],
            elevation: parseInt(entry['Elevation (ft)'], 10) || null,
            prominence: parseInt(entry['Prominence (ft)'], 10) || null,
            range: getRange(entry, slug),
            difficulty: difficultyMap[slug] || 'moderate',
            coords,
            latitude: overlayLat ?? coords?.lat ?? null,
            longitude: overlayLon ?? coords?.lon ?? null,
            rangeGroup: overlayEntry?.range_group || null,
            rangeRaw: overlayEntry?.range_raw || entry['Range / Subrange'] || null,
            primaryRoute: overlayEntry?.primary_route || null,
            primaryDistanceMi: overlayEntry?.primary_distance_mi ?? null,
            primaryGainFt: overlayEntry?.primary_gain_ft ?? null,
            trailTypePrimary: overlayEntry?.trail_type_primary ?? null,
            difficultyTextPrimary: overlayEntry?.difficulty_text_primary ?? null,
            estimatedTimeHours: overlayEntry?.estimated_time_hours ?? null,
            riskFactors: filteredRiskFactors,
            prepNotes: overlayEntry?.prep_notes || null,
            bailoutDistanceMi: overlayEntry?.bailout_distance_mi ?? null,
            riskEvidence: Array.isArray(overlayEntry?.risk_evidence) ? overlayEntry.risk_evidence : [],
            riskReview: overlayEntry?.risk_review || null,
            commonGroupings: Array.isArray(overlayEntry?.common_groupings) ? overlayEntry.common_groupings : [],
            finishStrategySuggestions: Array.isArray(overlayEntry?.finish_strategy_suggestions) ? overlayEntry.finish_strategy_suggestions : [],
            trailheadCoordinates: overlayEntry?.trailhead_coordinates || null
          };
        });
      }

      function loadFinishStrategies() {
        const container = document.getElementById('finishStrategyTiles');
        if (!container) return;
        fetch('/data/nh48-planner-templates.json')
          .then((response) => {
            if (!response.ok) throw new Error('Template file unavailable');
            return response.json();
          })
          .then((payload) => {
            const strategies = Array.isArray(payload?.finishStrategies) ? payload.finishStrategies : [];
            if (!strategies.length) return;
            container.innerHTML = '';
            strategies.forEach((strategy) => {
              const tile = document.createElement('a');
              tile.className = 'strategy-tile';
              tile.href = `/nh48-planner.html?strategy=${encodeURIComponent(strategy.id)}`;
              tile.setAttribute('aria-label', `${strategy.name} strategy`);

              const icon = document.createElement('span');
              icon.className = 'strategy-icon';
              icon.textContent = strategy.icon || '';

              const name = document.createElement('span');
              name.className = 'strategy-name';
              name.textContent = strategy.name || 'Strategy';

              const duration = document.createElement('span');
              duration.className = 'strategy-duration';
              const durationParts = [strategy.duration, strategy.tripRange].filter(Boolean);
              duration.textContent = durationParts.join(' | ');

              const summary = document.createElement('p');
              summary.className = 'strategy-description';
              summary.textContent = strategy.summary || '';

              tile.append(icon, name, duration, summary);
              container.appendChild(tile);
            });
          })
          .catch((err) => {
            console.warn('Finish strategy templates unavailable, using fallback cards.', err);
          });
      }

      function init() {
        loadFinishStrategies();
        renderRangeFilters();
        renderRangeList();
        setupRiskFilters();
        renderSeasonTable('summer');
        updateSeasonToggle('summer');
        const seasonButtons = {
          summer: document.getElementById('summerBtn'),
          fall: document.getElementById('fallBtn'),
          winter: document.getElementById('winterBtn'),
          spring: document.getElementById('springBtn')
        };
        Object.entries(seasonButtons).forEach(([key, button]) => {
          if (!button) return;
          button.addEventListener('click', () => {
            updateSeasonToggle(key);
            renderSeasonTable(key);
          });
        });

        document.querySelectorAll('[data-sort]').forEach((button) => {
          button.addEventListener('click', () => {
            const key = button.dataset.sort;
            if (sortState.key === key) {
              sortState.direction = sortState.direction === 'asc' ? 'desc' : 'asc';
            } else {
              sortState.key = key;
              sortState.direction = 'asc';
            }
            sortState.difficultyPriority = null;
            renderPeakTable();
          });
        });

        document.querySelectorAll('.tier-badge').forEach((badge) => {
          badge.addEventListener('click', () => {
            const level = badge.dataset.difficulty;
            if (!level) return;
            sortState = {
              key: 'difficulty',
              direction: 'asc',
              difficultyPriority: level
            };
            currentRange = 'All';
            renderRangeFilters();
            renderRangeList();
            renderPeakTable();
            scheduleMapRender();
            const list = document.getElementById('official-peak-list');
            if (list) {
              list.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
          });
        });

        Promise.all([
          fetch('/manifest_out.json').then((r) => r.json()),
          fetch('/data/nh48_enriched_overlay.json')
            .then((r) => (r.ok ? r.json() : null))
            .catch(() => null)
        ])
          .then(async ([data, overlay]) => {
            if (!overlay) {
              console.warn('Overlay data unavailable; risk filters disabled.');
              setRiskFiltersEnabled(false);
            } else {
              setRiskFiltersEnabled(true);
            }

            let fallbackCoords = null;
            if (!overlay) {
              fallbackCoords = await loadFallbackCoords();
            }

            hydratePeaks(data, overlay, fallbackCoords);

            if (!fallbackCoords) {
              const missingCoords = peaks.some((peak) => !peak.coords);
              if (missingCoords) {
                fallbackCoords = await loadFallbackCoords();
                if (fallbackCoords) {
                  hydratePeaks(data, overlay, fallbackCoords);
                }
              }
            }

            renderPeakTable();
            renderItemListSchema();
            scheduleMapRender();
            if (overlay) {
              updateRiskCounts();
              updateRiskButtonStates();
            }
          })
          .catch((err) => {
            console.error('Failed to load peak data', err);
            renderDataLoadError('Unable to load peaks right now.');
          });
      }

      document.addEventListener('DOMContentLoaded', () => {
        setupTocObserver();
        const mapSection = document.getElementById('range-map');
        observeMapResize();
        const stylizedBtn = document.getElementById('mapStyleStylized');
        const osmBtn = document.getElementById('mapStyleOsm');
        if (stylizedBtn && osmBtn) {
          stylizedBtn.addEventListener('click', () => setMapStyle('stylized'));
          osmBtn.addEventListener('click', () => setMapStyle('osm'));
        }
        const zoomInBtn = document.getElementById('mapZoomIn');
        const zoomOutBtn = document.getElementById('mapZoomOut');
        const resetBtn = document.getElementById('mapReset');
        if (zoomInBtn) {
          zoomInBtn.addEventListener('click', () => {
            if (activeMapStyle === 'osm' && leafletMap) {
              leafletMap.zoomIn();
            }
          });
        }
        if (zoomOutBtn) {
          zoomOutBtn.addEventListener('click', () => {
            if (activeMapStyle === 'osm' && leafletMap) {
              leafletMap.zoomOut();
            }
          });
        }
        if (resetBtn) {
          resetBtn.addEventListener('click', () => {
            if (activeMapStyle === 'osm' && leafletMap) {
              if (leafletBounds) {
                leafletMap.fitBounds(leafletBounds.pad(0.2), { animate: false });
              }
            }
          });
        }
        const clearBtn = document.getElementById('mapClearFilters');
        if (clearBtn) {
          clearBtn.addEventListener('click', () => {
            activeRiskFilters.clear();
            selectedRanges.clear();
            selectedPeakSlug = null;
            currentRange = 'All';
            updateRiskButtonStates();
            renderRangeFilters();
            renderRangeList();
            renderPeakTable();
            scheduleMapRender();
          });
        }
        if (mapSection) {
          const mapObserver = new IntersectionObserver((entries, observer) => {
            if (entries.some((entry) => entry.isIntersecting)) {
              scheduleMapRender();
              observer.disconnect();
            }
          }, { threshold: 0.2 });
          mapObserver.observe(mapSection);
        }
        loadRanges().finally(() => {
          init();
          setMapStyle('osm');
        });
      });
  </script>
  <div id="footer-placeholder"></div>
</body>
</html>

