<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<!-- Favicons - ICO format preferred for Google compatibility -->
<link rel="icon" href="/favicons/favicon.ico" sizes="48x48" />
<link rel="icon" type="image/x-icon" href="/favicons/favicon.ico" />
<link rel="shortcut icon" href="/favicons/favicon.ico" />
<link rel="icon" type="image/x-icon" sizes="16x16" href="/favicons/favicon-16x16.ico" />
<link rel="icon" type="image/x-icon" sizes="32x32" href="/favicons/favicon-32x32.ico" />
<link rel="icon" type="image/x-icon" sizes="48x48" href="/favicons/favicon-48x48.ico" />
<link rel="icon" type="image/x-icon" sizes="96x96" href="/favicons/favicon-96x96.ico" />
<!-- PNG fallbacks for browsers that prefer PNG -->
<link rel="icon" type="image/png" sizes="16x16" href="/favicons/favicon-16.png" />
<link rel="icon" type="image/png" sizes="32x32" href="/favicons/favicon-32.png" />
<link rel="icon" type="image/png" sizes="48x48" href="/favicons/favicon-48.png" />
<link rel="icon" type="image/png" sizes="96x96" href="/favicons/favicon-96.png" />
<link rel="apple-touch-icon" sizes="180x180" href="/favicons/apple-touch-icon.png" />
<link rel="manifest" href="/manifest.json" />
<title>Howker Ridge Trail ‚Äì Map & Data | NH48.info</title>
<meta name="description" content="Interactive map, downloads, trail metadata, and current conditions for the Howker Ridge Trail on Mount Madison." />
<meta name="keywords" content="Howker Ridge Trail, trail map, Mount Madison, New Hampshire, White Mountains, GPX downloads, trail data, hiking maps, trail points of interest" />
<link rel="canonical" href="https://nh48.info/howker-ridge" />
<meta property="og:type" content="website" />
<meta property="og:title" content="Howker Ridge Trail ‚Äì Map & Data" />
<meta property="og:description" content="Interactive map, downloads, trail metadata, and live weather details for the Howker Ridge Trail." />
<meta property="og:url" content="https://nh48.info/howker-ridge" />
<meta property="og:image" content="https://photos.nh48.info/cdn-cgi/image/format=jpg,quality=85,width=1200/mount-madison/mount-madison__003.jpg" />
<meta property="og:image:alt" content="Mount Madison ridge view with alpine terrain and distant peaks" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:title" content="Howker Ridge Trail ‚Äì Map & Data" />
<meta name="twitter:description" content="Interactive trail map, downloads, trail metadata, and weather updates for the Howker Ridge Trail." />
<meta name="twitter:image" content="https://photos.nh48.info/cdn-cgi/image/format=jpg,quality=85,width=1200/mount-madison/mount-madison__003.jpg" />
<meta name="twitter:image:alt" content="Mount Madison ridge view with alpine terrain and distant peaks" />
<script>
  (() => {
    if (window.NH48_BUILD_DATE) return;
    try {
      const xhr = new XMLHttpRequest();
      xhr.open('GET', '/build-meta.json', false);
      xhr.send(null);
      if (xhr.status >= 200 && xhr.status < 300) {
        const meta = JSON.parse(xhr.responseText);
        if (meta && meta.buildDate) {
          window.NH48_BUILD_DATE = meta.buildDate;
        }
      }
    } catch (err) {
      // No-op: build date is optional in static builds.
    }
  })();
</script>
<script type="module" src="/js/i18n.js"></script>
<link rel="stylesheet" href="/css/ui-tooltips.css" />
<script src="/js/ui-tooltips.js" defer></script>
<script src="/js/unified-footer.js" defer></script>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha384-sHL9NAb7lN7rfvG5lfHpm643Xkcjzp4jFvuavGOndn6pjVqS6ny56CAt3nsEVT4H" crossorigin="" />
<style>
:root{
  --bg:#0a0a0a;
  --panel:#12121a;
  --card:#171a22;
  --ink:#ffffff;
  --muted:#ffffff;
  --stroke:#2b3345;
  --accent:#4ade80;
  --accent-2:#38bdf8;
  --hero-overlay:rgba(4,8,16,0.7);
  --gap:16px;
}
body.light{
  --bg:#f8fafc;
  --panel:#ffffff;
  --card:#f7f9fc;
  --ink:#ffffff;
  --muted:#ffffff;
  --stroke:#00000022;
  --accent:#16a34a;
  --accent-2:#0ea5e9;
  --hero-overlay:rgba(255,255,255,0.6);
}
*{ box-sizing:border-box; }
html{ min-width:320px; scroll-behavior:smooth; }
@media (prefers-reduced-motion: reduce){
  html{ scroll-behavior:auto; }
}
body{
  margin:0;
  background:var(--bg);
  color:var(--ink);
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
  -webkit-font-smoothing:antialiased;
  text-rendering:optimizeLegibility;
}
.hero{
  background:
    linear-gradient(120deg,var(--hero-overlay),rgba(4,8,16,0.4)),
    url('https://photos.nh48.info/cdn-cgi/image/format=jpg,quality=85,width=1400/mount-madison/mount-madison__003.jpg') center/cover no-repeat;
  border-radius:16px;
  padding:36px;
  box-shadow:0 20px 40px #0005;
}
.hero h1{
  margin:0 0 10px;
  font-size:clamp(28px,4vw,40px);
  color:var(--accent);
}
.hero p{
  margin:0;
  max-width:680px;
  color:var(--muted);
  font-size:1rem;
  line-height:1.6;
}
.wrap{
  max-width:1200px;
  margin:0 auto;
  padding:12px;
}
.panel{
  background:var(--panel);
  border:none;
  border-radius:10px;
  margin-top:1.5rem;
  padding:20px;
  box-shadow:0 10px 30px #0004;
}
.page-breadcrumbs{
  margin:10px 0 18px;
  font-size:13px;
  color:var(--muted);
}
.page-breadcrumbs ol{
  list-style:none;
  padding:0;
  margin:0;
  display:flex;
  flex-wrap:wrap;
  gap:6px;
}
.page-breadcrumbs li::after{
  content:"/";
  margin-left:6px;
  color:var(--muted);
}
.page-breadcrumbs li:last-child::after{
  content:"";
}
.page-breadcrumbs a{
  color:inherit;
  text-decoration:none;
}
.page-breadcrumbs a:hover{
  color:var(--accent);
}
.text-guide{
  font-size:0.9rem;
  margin:0 0 1rem;
}
.text-green{ color:#388e3c; }
.text-yellow{ color:#fbc02d; }
.text-red{ color:#d32f2f; }
.section{
  margin-top:28px;
}
.section h2{
  margin:0 0 10px;
  font-size:clamp(18px,2vw,24px);
  color:var(--accent);
}
.section h3{
  margin:16px 0 8px;
  font-size:clamp(16px,1.6vw,20px);
  color:var(--accent);
}
.section p{
  margin:0 0 12px;
  color:var(--ink);
  line-height:1.6;
}
.section ul{
  margin:0;
  padding-left:20px;
  color:var(--ink);
  line-height:1.6;
}
.main-grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(280px,1fr));
  grid-auto-rows:auto;
  gap:var(--gap);
  margin-top:24px;
}
#map-section,
#map-links{
  grid-column:1 / -1;
}
.span-2{
  grid-column:span 2;
}
.stacked-panel{
  grid-column:1 / -1;
}
.grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(260px,1fr));
  grid-auto-rows:auto;
  gap:var(--gap);
}
.card{
  background:var(--card);
  border:1px solid var(--stroke);
  border-radius:12px;
  padding:16px;
}
.card p,
.card li,
.card td{
  color:var(--ink);
}
#map{
  height:560px;
  width:100%;
  border-radius:10px;
  overflow:hidden;
  border:1px solid var(--stroke);
}
.map-legend{
  background:var(--panel);
  color:var(--ink);
  border-radius:10px;
  border:1px solid var(--stroke);
  padding:10px 12px;
  box-shadow:0 12px 30px #0003;
  font-size:12px;
}
.map-legend h4{
  margin:0 0 6px;
  font-size:13px;
}
.map-legend div{
  display:flex;
  align-items:center;
  gap:6px;
  margin-bottom:4px;
}
.map-legend img{
  width:18px;
  height:18px;
}
.table-wrap{
  overflow-x:auto;
}
table{
  width:100%;
  border-collapse:collapse;
  font-size:14px;
}
.trail-meta{
  width:100%;
  border-collapse:collapse;
  font-size:14px;
}
.trail-meta th{
  width:38%;
  text-align:left;
  font-weight:600;
  padding-right:12px;
  white-space:nowrap;
}
.trail-meta td{
  padding:10px 12px;
}
.trail-meta-panels{
  display:flex;
  flex-wrap:wrap;
  gap:var(--gap);
  align-items:stretch;
}
.trail-meta-panel{
  flex:1 1 320px;
  min-width:260px;
}
.feature-list{
  margin:8px 0 0;
  padding-left:18px;
  list-style:disc;
}
.meta-links{
  display:flex;
  flex-wrap:wrap;
  gap:10px;
  margin-top:16px;
  align-items:stretch;
}
.btn-small{
  display:inline-flex;
  align-items:center;
  justify-content:center;
  padding:8px 12px;
  border-radius:999px;
  background:var(--accent-2);
  color:#0b1220;
  font-size:13px;
  font-weight:600;
  text-decoration:none;
  border:1px solid transparent;
}
.meta-links .btn-small{
  flex:1 1 160px;
}
.meta-links .btn-small:focus-visible{
  outline:2px solid var(--accent);
  outline-offset:2px;
}
.btn-small:hover{
  border-color:var(--accent);
  color:#0b1220;
}
th, td{
  padding:10px 12px;
  border-bottom:1px solid var(--stroke);
  text-align:left;
}
th{
  color:var(--ink);
  font-weight:600;
}
.poi-controls{
  display:flex;
  flex-wrap:wrap;
  gap:12px;
  margin-bottom:12px;
}
.poi-controls input[type="search"]{
  flex:1;
  min-width:220px;
  padding:10px 12px;
  border-radius:10px;
  border:1px solid var(--stroke);
  background:var(--card);
  color:var(--ink);
}
#poiTable thead button{
  background:none;
  border:none;
  color:inherit;
  font-weight:600;
  cursor:pointer;
  padding:0;
  display:inline-flex;
  align-items:center;
  gap:6px;
}
#poiTable thead button::after{
  content:"‚áÖ";
  font-size:0.8em;
  opacity:0.6;
}
#poiTable thead button[data-active="true"]::after{
  content:attr(data-direction);
  font-size:0.8em;
  opacity:0.9;
}
.small{
  font-size:13px;
  color:var(--muted);
}
.badges{
  display:flex;
  flex-wrap:wrap;
  gap:8px;
}
.badge{
  padding:6px 12px;
  border:1px solid var(--stroke);
  border-radius:999px;
  font-size:12px;
  text-transform:uppercase;
  letter-spacing:0.5px;
  background:var(--card);
}
.map-links-menu{
  display:grid;
  gap:18px;
}
.map-links-row{
  display:flex;
  flex-wrap:wrap;
  gap:12px;
}
.toc-links{
  display:flex;
  flex-direction:column;
  gap:12px;
  width:100%;
}
.toc-link{
  color:var(--ink);
  text-decoration:none;
  display:inline-flex;
  align-items:center;
  justify-content:flex-start;
  gap:8px;
  padding:0 0 6px;
  border-radius:0;
  border:none;
  border-bottom:2px solid transparent;
  background:transparent;
  font-size:15px;
  font-weight:700;
  text-align:left;
  white-space:nowrap;
}
.toc-link:hover{
  border-color:var(--accent);
  color:var(--accent);
}
.map-link{
  color:var(--ink);
  text-decoration:none;
  display:inline-flex;
  align-items:center;
  gap:8px;
  padding:10px 14px;
  border-radius:12px;
  border:1px solid var(--stroke);
  background:transparent;
  font-size:0.95rem;
}
.map-link:hover{
  border-color:var(--accent);
  color:var(--accent);
}
.forecast-box{
  display:grid;
  gap:12px;
}
.alerts{
  border-left:3px solid var(--accent-2);
  padding-left:12px;
}
.two-col{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
  gap:var(--gap);
}
.split-panels{
  grid-column:1 / -1;
  display:grid;
  grid-template-columns:repeat(2, minmax(0, 1fr));
  gap:var(--gap);
}
.split-panels > .section{
  margin-top:0;
}
.split-panels #jump-to,
.split-panels #map-links{
  grid-column:auto;
}
.flora-grid{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(220px,1fr));
  grid-auto-rows:auto;
  gap:var(--gap);
  margin-top:16px;
}
.flora-card{
  background:var(--card);
  border:1px solid var(--stroke);
  border-radius:12px;
  overflow:hidden;
  display:flex;
  flex-direction:column;
  min-height:100%;
}
.flora-card img{
  width:100%;
  height:150px;
  object-fit:cover;
}
.flora-card h3{
  margin:10px 12px 4px;
  font-size:1rem;
}
.flora-card .badge{
  margin:0 12px 6px;
  padding:2px 8px;
  font-size:0.72rem;
  border-radius:6px;
  color:#fff;
  background:#475569;
  align-self:flex-start;
}
.flora-card p{
  margin:0 12px 12px;
  color:var(--ink);
  flex:1;
}
.flora-card .learn-more{
  margin:0 12px 14px;
  font-size:0.85rem;
  color:var(--accent);
  text-decoration:none;
}
.badge-moss{ background:#2e7d32; }
.badge-lichen{ background:#6d4c41; }
.badge-fungus{ background:#d84315; }
.badge-wildflower{ background:#8e24aa; }
.badge-fern{ background:#388e3c; }
.badge-grass{ background:#2e8b57; }
.badge-vine{ background:#5d4037; }
.badge-bryophyte{ background:#4e7f2f; }
.badge-sedge{ background:#1b5e20; }
.warning-callout{
  border:2px solid #fbbf24;
  background:linear-gradient(180deg, #1f1408, #2b1a0a);
  border-radius:12px;
  padding:14px 16px;
  margin:12px 0 16px;
  color:#fef3c7;
}
.warning-callout h3{
  margin:0 0 8px;
  font-size:clamp(16px,1.6vw,20px);
  display:flex;
  align-items:center;
  gap:8px;
  color:#fef3c7;
}
.warning-callout p{
  margin:0 0 8px;
  color:#ffffff;
}
.warning-callout p:last-child{
  margin-bottom:0;
}
@media (max-width: 900px){
  .split-panels{
    grid-template-columns:1fr;
  }
}
@media (max-width: 700px){
  .panel{ padding:16px; }
  #map{ height:360px; }
  .hero{ padding:24px; }
  .span-2{ grid-column:span 1; }
  .toc-links{
    flex-wrap:wrap;
  }
  .toc-link{
    white-space:normal;
  }
  .meta-links{
    flex-direction:column;
  }
}

/* Added styles to ensure readability and brand colours:
   - Force all anchor links to use the green accent colour by default.
   - Underline links on hover for better accessibility. */
a {
  color: var(--ink);
  text-decoration: none;
}
a:hover {
  color: var(--ink);
  text-decoration: underline;
}
.poi-thumb {
  width: 32px;
  height: 32px;
  aspect-ratio: 1 / 1;
  border-radius: 50%;
  border: 1px solid var(--stroke);
  object-fit: cover;
  position: relative;
  transition: transform 0.2s ease;
  transform-origin: var(--zoom-x, 50%) var(--zoom-y, 50%);
}
.poi-thumb:hover {
  transform: scale(8);
  z-index: 20;
  box-shadow: 0 16px 30px rgba(0, 0, 0, 0.45);
}
.poi-avatar{
  display:inline-flex;
  align-items:center;
  gap:8px;
  position:relative;
  overflow:visible;
}
.poi-fallback-label{
  display:none;
  align-items:center;
  gap:6px;
  padding:4px 10px;
  border-radius:8px;
  border:1px solid var(--stroke);
  background:rgba(15,23,42,0.4);
  font-size:12px;
  white-space:nowrap;
}
.poi-avatar.is-fallback .poi-fallback-label{
  display:inline-flex;
}
.poi-marker{
  width:54px;
  height:54px;
  display:flex;
  align-items:center;
  justify-content:center;
  overflow:visible;
}
.poi-marker.is-fallback{
  width:auto;
  height:auto;
}
.poi-marker img{
  width:52px;
  height:52px;
  aspect-ratio:1 / 1;
  border-radius:50%;
  border:2px solid #d4a017;
  box-shadow:0 0 4px rgba(0, 0, 0, 0.3);
  object-fit:cover;
  transition:transform 0.2s ease;
}
.poi-marker img:hover{
  transform:scale(1.2);
}
.table-wrap{
  overflow-x:auto;
  overflow-y:visible;
}
#poiTable{
  overflow:visible;
}
#poiTable td{
  overflow:visible;
}
#jump-to{
  grid-column:1 / -1;
}
.poi-marker .poi-fallback-label{
  display:none;
}
.poi-marker.is-fallback .poi-fallback-label{
  display:inline-flex;
}
table a{
  color:var(--accent);
  text-decoration:underline;
  font-weight:600;
}
table a:hover{
  color:var(--accent);
  text-decoration:underline;
}
.poi-detail-link{
  color:var(--accent);
  text-decoration:underline;
  font-weight:600;
}
.poi-detail-link:hover{
  color:var(--accent);
  text-decoration:underline;
}
</style>
<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@graph": [
      {
        "@type": "WebPage",
        "name": "Howker Ridge Trail ‚Äì Map & Data",
        "description": "Interactive map, downloads, trail metadata, and current conditions for the Howker Ridge Trail on Mount Madison.",
        "url": "https://nh48.info/howker-ridge",
        "breadcrumb": {
          "@id": "https://nh48.info/howker-ridge#breadcrumb"
        },
        "about": {
          "@id": "https://nh48.info/howker-ridge#place"
        }
      },
      {
        "@type": "BreadcrumbList",
        "@id": "https://nh48.info/howker-ridge#breadcrumb",
        "itemListElement": [
          {
            "@type": "ListItem",
            "position": 1,
            "name": "Home",
            "item": "https://nh48.info/"
          },
          {
            "@type": "ListItem",
            "position": 2,
            "name": "Projects",
            "item": "https://nh48.info/projects"
          },
          {
            "@type": "ListItem",
            "position": 3,
            "name": "Howker Ridge Trail ‚Äì Map & Data",
            "item": "https://nh48.info/howker-ridge"
          }
        ]
      },
      {
        "@type": "Place",
        "@id": "https://nh48.info/howker-ridge#place",
        "name": "Howker Ridge Trail",
        "description": "Steep ridge trail on Mount Madison in the White Mountains of New Hampshire.",
        "address": {
          "@type": "PostalAddress",
          "addressLocality": "Randolph",
          "addressRegion": "NH",
          "addressCountry": "US"
        },
        "geo": {
          "@type": "GeoCoordinates",
          "latitude": 44.334951,
          "longitude": -71.266614
        }
      }
    ]
  }
</script>
</head>
<body data-route="howker-ridge" data-page="howker-ridge">
  <div id="nav-placeholder"></div>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const navPlaceholder = document.getElementById('nav-placeholder');
      const activeRoute = document.body.dataset.route || document.body.dataset.page;
      if (window.NH48Tooltips && typeof window.NH48Tooltips.init === 'function') {
        const pageName = window.NH48_I18N && window.NH48_I18N.t
          ? window.NH48_I18N.t('trails.title')
          : 'Howker Ridge Trail Map and Guide';
        window.NH48Tooltips.init({ pageName });
        window.NH48Tooltips.refresh(document.body);
      }

      if (navPlaceholder) {
        fetch('/pages/nav.html')
          .then(response => response.text())
          .then(html => {
            navPlaceholder.innerHTML = html;
            const links = navPlaceholder.querySelectorAll('.site-nav-links a');
            links.forEach(link => {
              const routes = (link.dataset.routes || link.dataset.route || '')
                .split(',')
                .map(value => value.trim())
                .filter(Boolean);

              if (routes.includes(activeRoute)) {
                link.classList.add('active');
                link.setAttribute('aria-current', 'page');
              }
            });
            if (window.NH48_I18N && window.NH48_I18N.refreshLangPicker) {
              window.NH48_I18N.refreshLangPicker();
            }
            if (window.NH48Tooltips && typeof window.NH48Tooltips.refresh === 'function') {
              window.NH48Tooltips.refresh(document.body);
            }
          })
          .catch(err => console.error('Failed to load navigation:', err));
      }
    });
  </script>

  <div class="wrap">
    <header class="hero">
      <h1>Howker Ridge Trail Map &amp; Guide</h1>
      <p>Plan a steep ridge climb with interactive mapping, curated downloads, and real-time conditions for Mount Madison‚Äôs Howker Ridge Trail.</p>
    </header>

    <nav class="page-breadcrumbs" aria-label="Breadcrumb">
      <ol>
        <li><a href="/">Home</a></li>
        <li><a href="/plant-catalog">Projects</a></li>
        <li>Howker Ridge Trail</li>
      </ol>
    </nav>

    <!-- Overview removed per design feedback. Trail statistics are covered in the metadata table. -->

    <div class="main-grid">
      <section class="section card span-2" id="map-section">
        <h2>Interactive Trail Map</h2>
        <div id="map" aria-label="Howker Ridge Trail map"></div>
        <p class="small">Trail line and waypoint markers are loaded from the NH48 GeoJSON dataset. Tap markers for details and use the layer controls to explore ridge features.</p>
      </section>

      <div class="split-panels">
        <section class="section card" id="jump-to">
          <h2>Jump to sections</h2>
          <p class="small">Quick links to each panel on this page.</p>
          <div class="toc-links">
            <a class="toc-link" href="#map-links">Trail maps &amp; downloads</a>
            <a class="toc-link" href="#poi">Points of interest</a>
            <a class="toc-link" href="#metadata">Trail overview &amp; conditions</a>
            <a class="toc-link" href="#flora">Flora along the trail</a>
            <a class="toc-link" href="#conditions">Current conditions &amp; safety</a>
          </div>
        </section>

        <section class="section card" id="map-links">
          <h2>Trail Maps &amp; Downloads</h2>
          <div class="map-links-menu">
            <div class="map-links-group">
              <h3>External Trail Maps</h3>
              <div class="map-links-row">
                <a class="map-link" href="https://www.onxmaps.com/offroad/map?lat=44.334&lon=-71.266&zoom=12" target="_blank" rel="noopener">OnX Maps <span aria-hidden="true">‚Üó</span></a>
                <a class="map-link" href="https://www.alltrails.com/explore?lat=44.334&lng=-71.266&zoom=12" target="_blank" rel="noopener">AllTrails <span aria-hidden="true">‚Üó</span></a>
                <a class="map-link" href="https://www.gaiagps.com/map/?lat=44.334&lon=-71.266&zoom=12" target="_blank" rel="noopener">Gaia GPS <span aria-hidden="true">‚Üó</span></a>
                <a class="map-link" href="https://caltopo.com/map.html#ll=44.334,-71.266&z=12" target="_blank" rel="noopener">CalTopo <span aria-hidden="true">‚Üó</span></a>
              </div>
            </div>
            <div class="map-links-group">
              <h3>GPS &amp; Navigation Downloads</h3>
              <div class="map-links-row">
                <a class="map-link" href="/downloads/howker-ridge-trail.gpx" download>Download GPX (trail + POIs)</a>
                <a class="map-link" href="/downloads/howker-ridge-trail.kml" download>Download KML</a>
              </div>
              <p class="small">Files are formatted for GPS apps and GIS tools. Always carry a paper map and backup navigation.</p>
            </div>
          </div>
        </section>
      </div>

      <section class="section card span-2 stacked-panel" id="poi">
        <h2>Points of Interest</h2>
        <div class="poi-controls">
          <input type="search" id="poiSearch" placeholder="Search points‚Ä¶" aria-label="Search points of interest" />
        </div>
        <div class="table-wrap">
          <table id="poiTable" aria-label="Points of interest">
            <thead>
              <tr>
                <th scope="col">Photo</th>
                <th scope="col"><button type="button" data-sort="name" aria-label="Sort by name">Name</button></th>
                <th scope="col"><button type="button" data-sort="elevation" aria-label="Sort by elevation">Elevation (ft)</button></th>
                <th scope="col"><button type="button" data-sort="lat" aria-label="Sort by latitude">Latitude</button></th>
                <th scope="col"><button type="button" data-sort="lng" aria-label="Sort by longitude">Longitude</button></th>
              </tr>
            </thead>
            <tbody id="poiTableBody"></tbody>
          </table>
        </div>
        <p class="small">Coordinates are approximate. Confirm with official maps before travel.</p>
      </section>

      <section class="section card span-2 stacked-panel" id="metadata">
        <h2>Trail Overview &amp; Conditions</h2>
        <div class="trail-meta-panels">
          <div class="trail-meta-panel">
            <h3>Trail Metadata</h3>
            <table class="trail-meta">
              <tr><th>Length</th>
                <td>‚âà 4.5 mi = 4.2 mi + .3 mi (Osgood Ridge) one-way</td>
              </tr>
              <tr><th>Elevation Gain</th>
                <td>‚âà 4,750 ft = 4,450 ft (ascent) + 300 ft (descent)</td>
              </tr>
              <tr><th>Typical Time</th>
                <td>6‚Äì10 hours round-trip</td>
              </tr>
              <tr><th>Difficulty</th><td>Strenuous / hard</td></tr>
              <tr><th>Terrain</th><td>Steep ridgeline, rocky scrambles, alpine exposure above treeline</td></tr>
              <tr><th>Water</th><td>Bumpus Brook early on; spring near Pine Link junction (seasonal)</td></tr>
              <tr><th>Trailhead</th><td>Randolph East (Dolly Copp / Pinkham B), winter access via US-2</td></tr>
              <tr><th>Land Manager</th><td>White Mountain National Forest / Randolph Mountain Club</td></tr>
              <tr><th>Bailout Routes</th>
                <td>
                  Watson Path (Diretessima)<br>
                  Airline (Easiest Grade)<br>
                  Valley Way (Exposure Safety)<br>
                  Pine Link (Dolly Copp Rd. Alternative)
                </td>
              </tr>
            </table>
          </div>
          <div class="trail-meta-panel">
            <h3>Mount Madison Snapshot</h3>
            <!-- Elevation, location, and features from 4000footers.com -->
            <!-- Naming, Osgood Trail, and summit hazards from Wikipedia -->
            <!-- Exposure hazards and northernmost peak note from MyOutdoorBasecamp -->
            <table class="trail-meta">
              <tbody>
                <tr><th>Elevation</th><td>5,367 ft (1,636 m)</td></tr>
                <tr><th>Prominence</th><td>466 ft (142 m)</td></tr>
                <tr><th>Location</th><td>Thompson &amp; Meserve‚Äôs Purchase, Co√∂s County, NH</td></tr>
                <tr><th>Range</th><td>Presidential Range (White Mountains)</td></tr>
                <tr><th>Coordinates</th><td>44¬∞19‚Ä≤44‚Ä≥ N, 71¬∞16‚Ä≤36‚Ä≥ W</td></tr>
                <tr><th>Named after</th><td>James Madison (4th U.S. President)</td></tr>
                <tr><th>Nearby peaks</th><td>Mt. Adams 1.4 mi SW; Mt. Jefferson 3.3 mi S</td></tr>
                <tr>
                  <th>Features</th>
                  <td>
                    <ul class="feature-list">
                      <li>Alpine zone &amp; rock-covered summit cone with cairns</li>
                      <li>360¬∞ views of the White Mountains</li>
                      <li>Rock scrambles and boulder fields</li>
                      <li>Mossy Falls &amp; Ice Caves on the Short Line Trail</li>
                      <li>Star Lake and Madison Spring Hut (0.4 mi below summit)</li>
                      <li>Appalachian Trail crosses near summit (Osgood Trail)</li>
                      <li>Northernmost peak of the Presidentials; high winds &amp; hypothermia risk even in summer</li>
                    </ul>
                  </td>
                </tr>
              </tbody>
            </table>
            <div class="forecast-box">
              <div id="forecast"><em>Loading forecast‚Ä¶</em></div>
              <div id="alerts" class="alerts"><em>Loading alerts‚Ä¶</em></div>
            </div>
          </div>
        </div>
        <div class="meta-links">
          <a href="#map" class="btn-small">View map</a>
          <a href="https://forecast.weather.gov/MapClick.php?lat=44.3288&amp;lon=-71.278" target="_blank" rel="noopener" class="btn-small">Forecast</a>
          <a href="https://forecast.weather.gov/alerts/wwa.php?lat=44.3288&amp;lon=-71.278" target="_blank" rel="noopener" class="btn-small">NWS Alerts</a>
        </div>
      </section>

      <!-- Added flora and virtual hike information -->
      <section class="section card span-2" id="flora">
        <h2>Flora along the trail</h2>
        <p>Howker Ridge hosts a variety of alpine and subalpine species. Explore a rotating selection of non-tree flora below.</p>
        <div class="flora-grid" id="floraGrid" aria-live="polite"></div>
        <p class="small">For a comprehensive list of species and ecological notes, visit the <a href="/dataset/howker-plants">Howker Ridge plant catalog</a>.</p>
      </section>

      <section class="section card span-2" id="conditions">
        <h2>Current conditions &amp; safety guidance</h2>
        <div class="warning-callout" role="note" aria-label="Important trail warning">
          <h3>Important trail warning</h3>
          <p>Expect to break trail for long stretches from October through May. Howker Ridge is rarely traveled in winter and conditions can change quickly.</p>
          <p>Review exposure signage and trailhead notices before entering alpine zones, and treat weather as a primary decision factor.</p>
        </div>
        <div class="two-col">
          <div>
            <h3>Current conditions</h3>
            <p>Brushing coverage updates are being refreshed for the new nh48.info page. Check the Randolph Mountain Club and trail adopter updates for the latest maintenance status.</p>
            <ul>
              <li><a href="https://www.randolphmountainclub.org/trails" target="_blank" rel="noopener">Randolph Mountain Club trail updates</a></li>
              <li><a href="https://www.outdoors.org/trip-planning/trail-conditions/" target="_blank" rel="noopener">AMC trail conditions</a></li>
            </ul>
          </div>
          <div>
            <h3>Info</h3>
            <ul>
              <li>Plan for rapid weather changes and alpine exposure above treeline.</li>
              <li>Carry layers, food, water, and the 10 essentials.</li>
              <li>Check recent trail conditions and be prepared to turn around.</li>
              <li>Practice Leave No Trace and respect trail closures or reroutes.</li>
            </ul>
            <h3>Helpful Links</h3>
            <ul>
              <li><a href="https://www.mountwashington.org/experience-the-weather/higher-summit-forecast.aspx" target="_blank" rel="noopener">Mount Washington Observatory Forecast</a></li>
              <li><a href="https://mountwashingtonavalanchecenter.org/" target="_blank" rel="noopener">Mount Washington Avalanche Center</a></li>
              <li><a href="https://mesowest.utah.edu" target="_blank" rel="noopener">MesoWest Observations</a></li>
              <li><a href="https://waterdata.usgs.gov" target="_blank" rel="noopener">USGS River Gauges</a></li>
              <li><a href="https://www.randolphmountainclub.org" target="_blank" rel="noopener">Randolph Mountain Club</a></li>
            </ul>
          </div>
        </div>
      </section>
    </div>
  </div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha384-cxOPjt7s7Iz04uaHJceBmS+qpjv2JkIHNVcuOrM+YHwZOmJGBXI00mdUXEq65HTH" crossorigin=""></script>
  <script>
    const trackAnalytics = (name, params = {}) => {
      if (window.NH48Analytics?.track) {
        window.NH48Analytics.track(name, params);
        return;
      }
      if (window.NH48_INFO_ANALYTICS?.logEvent) {
        window.NH48_INFO_ANALYTICS.logEvent(name, params);
      }
    };

    const throttle = (fn, waitMs) => {
      let lastRun = 0;
      return (...args) => {
        const now = Date.now();
        if (now - lastRun < waitMs) return;
        lastRun = now;
        fn(...args);
      };
    };

    const detectMapNetwork = (text) => {
      const normalized = (text || '').toLowerCase();
      if (normalized.includes('onx')) return 'onx';
      if (normalized.includes('alltrails')) return 'alltrails';
      if (normalized.includes('gaia')) return 'gaia';
      if (normalized.includes('caltopo')) return 'caltopo';
      return 'other';
    };

    const standardLayer = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; OpenStreetMap contributors'
    });
    const topoLayer = L.tileLayer('https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; OpenTopoMap contributors'
    });

    const map = L.map('map', { layers: [topoLayer] }).setView([44.336, -71.266], 13);
    const emitMapMove = throttle(() => {
      trackAnalytics('howker_map_move', {
        zoom: map.getZoom()
      });
    }, 7000);
    const emitMapZoom = throttle(() => {
      trackAnalytics('howker_map_zoom', {
        zoom: map.getZoom()
      });
    }, 7000);
    map.on('moveend', emitMapMove);
    map.on('zoomend', emitMapZoom);

    L.control.layers({ 'Topographic': topoLayer, 'Standard': standardLayer }, null, { position: 'topleft' }).addTo(map);
    L.control.scale({ position: 'bottomleft' }).addTo(map);
    window.addEventListener('scroll', () => {
      map.closePopup();
    });

    const poiTableBody = document.getElementById('poiTableBody');
    const poiSearch = document.getElementById('poiSearch');
    const poiHeaders = document.querySelectorAll('#poiTable thead button');
    const mapLinks = document.getElementById('map-links');
    const poiData = [];
    let sortKey = null;
    let sortAsc = true;
    let searchQuery = '';
    let poiSearchDebounce = null;
    let photoCatalogBySlug = new Map();

    function slugify(name) {
      return name.toLowerCase().replace(/[^a-z0-9]+/g, '-').replace(/^-|-$/g, '');
    }

    function formatDMS(value, isLat) {
      const absVal = Math.abs(value);
      const deg = Math.floor(absVal);
      const minFloat = (absVal - deg) * 60;
      const min = Math.floor(minFloat);
      const sec = Math.round((minFloat - min) * 60);
      const hemi = isLat ? (value >= 0 ? 'N' : 'S') : (value >= 0 ? 'E' : 'W');
      return `${deg}¬∞${min}'${sec}" ${hemi}`;
    }

    function normalizeImageUrls(value) {
      if (!value) return [];
      if (Array.isArray(value)) {
        return value.map(item => (typeof item === 'string' ? item.trim() : '')).filter(Boolean);
      }
      if (typeof value === 'string') {
        const trimmed = value.trim();
        return trimmed ? [trimmed] : [];
      }
      return [];
    }

    function slugFromFilename(filename) {
      if (!filename || typeof filename !== 'string') return '';
      return filename.replace(/\.[^/.]+$/, '').replace(/-\d+$/, '');
    }

    function buildPhotoCatalog(data) {
      const catalog = new Map();
      const filenames = Object.keys(data || {}).sort();
      filenames.forEach(filename => {
        const slug = slugFromFilename(filename);
        if (!slug) return;
        const url = `https://howker.nh48.info/cdn-cgi/image/format=webp,width=1400/${slug}/${filename}`;
        if (!catalog.has(slug)) catalog.set(slug, []);
        catalog.get(slug).push(url);
      });
      return catalog;
    }

    function getCatalogImageUrls(slug) {
      if (!slug || !photoCatalogBySlug) return [];
      return photoCatalogBySlug.get(slug) || [];
    }

    function getImageUrlsFromProps(props = {}) {
      return normalizeImageUrls(
        props.image_urls
        || props.imageUrls
        || props.image_url
        || props.imageUrl
      );
    }

    function mergeImageUrls(primary, fallback) {
      const combined = [];
      const seen = new Set();
      [primary, fallback].forEach(list => {
        (Array.isArray(list) ? list : []).forEach(url => {
          if (!url || seen.has(url)) return;
          seen.add(url);
          combined.push(url);
        });
      });
      return combined;
    }

    function getPoiImageUrls(props = {}, slug = '') {
      const primary = getImageUrlsFromProps(props);
      const fallback = getCatalogImageUrls(slug);
      return mergeImageUrls(primary, fallback);
    }

    function getPrimaryImageUrl(imageUrls) {
      if (!Array.isArray(imageUrls)) return '';
      return imageUrls.find(url => typeof url === 'string' && url.trim().length) || '';
    }

    function getFallbackImageUrl(slug, width) {
      return `https://howker.nh48.info/cdn-cgi/image/format=webp,width=${width}/${slug}/${slug}-001.jpg`;
    }

    function comparePoi(a, b, key) {
      const valA = a[key];
      const valB = b[key];
      if (typeof valA === 'number' && typeof valB === 'number') {
        return sortAsc ? valA - valB : valB - valA;
      }
      const strA = (valA ?? '').toString();
      const strB = (valB ?? '').toString();
      return sortAsc ? strA.localeCompare(strB) : strB.localeCompare(strA);
    }

    function createPhotoMarker(latlng, name, imageUrls, slugOverride) {
      const safeName = name || 'POI';
      const slug = slugOverride || slugify(safeName);
      const thumbUrl = getPrimaryImageUrl(imageUrls) || getFallbackImageUrl(slug, 60);
      return L.marker(latlng, {
        icon: L.divIcon({
          className: 'poi-marker',
          html: `
            <img src="${thumbUrl}" alt="${safeName}" loading="lazy"
              onerror="this.closest('.poi-marker').classList.add('is-fallback');this.remove();" />
            <span class="poi-fallback-label">üìç ${safeName}</span>
          `,
          iconSize: [54, 54],
          iconAnchor: [27, 54],
          popupAnchor: [0, -45]
        })
      });
    }

    function updateSortIndicators(activeKey) {
      poiHeaders.forEach(button => {
        const isActive = button.dataset.sort === activeKey;
        button.dataset.active = isActive ? 'true' : 'false';
        button.dataset.direction = isActive ? (sortAsc ? '‚Üë' : '‚Üì') : '';
        const th = button.closest('th');
        if (th) {
          th.setAttribute('aria-sort', isActive ? (sortAsc ? 'ascending' : 'descending') : 'none');
        }
      });
    }

    function refreshTooltips(root) {
      if (window.NH48Tooltips && typeof window.NH48Tooltips.refresh === 'function') {
        window.NH48Tooltips.refresh(root || document.body);
      }
    }

    function renderPoiTable(data) {
      poiTableBody.innerHTML = '';
      if (!data.length) {
        const row = document.createElement('tr');
        row.innerHTML = '<td colspan="5">No points match your search.</td>';
        poiTableBody.appendChild(row);
        refreshTooltips(poiTableBody);
        return;
      }
      data.forEach(item => {
        const slug = item.slug || slugify(item.name);
        const thumbUrl = getPrimaryImageUrl(item.imageUrls) || getFallbackImageUrl(slug, 48);
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>
            <div class="poi-avatar">
              <img class="poi-thumb" src="${thumbUrl}" alt="${item.name} thumbnail" loading="lazy"
                onerror="this.closest('.poi-avatar').classList.add('is-fallback');this.remove();" />
              <span class="poi-fallback-label">üìç ${item.name}</span>
            </div>
          </td>
          <td><a href="/howker-ridge/poi?poi=${slug}">${item.name}</a></td>
          <td>${item.elevation ?? ''}</td>
          <td>${formatDMS(item.lat, true)}</td>
          <td>${formatDMS(item.lng, false)}</td>
        `;
        poiTableBody.appendChild(row);
      });
      refreshTooltips(poiTableBody);
    }

    function updatePoiTable() {
      const filtered = poiData.filter(item => {
        const q = searchQuery.toLowerCase();
        return (
          item.name.toLowerCase().includes(q) ||
          item.category.toLowerCase().includes(q) ||
          item.description.toLowerCase().includes(q)
        );
      });
      const sorted = sortKey ? [...filtered].sort((a, b) => comparePoi(a, b, sortKey)) : filtered;
      renderPoiTable(sorted);
    }

    Promise.all([
      fetch('/data/howker-ridge.geojson').then(resp => resp.json()),
      fetch('/data/howker-ridge-pois.geojson').then(resp => (resp.ok ? resp.json() : { features: [] })),
      fetch('/data/howker-photos.json')
        .then(resp => (resp.ok ? resp.json() : {}))
        .catch(() => ({}))
    ])
      .then(([data, poiEdits, photoCatalog]) => {
        photoCatalogBySlug = buildPhotoCatalog(photoCatalog);
        const basePoiNames = new Set();
        (data.features || []).forEach(feature => {
          if (feature.geometry?.type === 'Point') {
            const name = feature.properties?.name;
            if (name) basePoiNames.add(name);
          }
        });

        const poiEditsByName = {};
        const newPoiEdits = [];
        (poiEdits.features || []).forEach(feature => {
          const name = feature.properties?.name;
          if (!name) return;
          if (basePoiNames.has(name)) {
            poiEditsByName[name] = feature;
          } else {
            newPoiEdits.push(feature);
          }
        });

        function getPoiMergedData(feature) {
          const props = feature.properties || {};
          const edit = poiEditsByName[props.name];
          const editProps = edit?.properties || {};
          const mergedProps = { ...props, ...editProps };
          const coords = edit?.geometry?.coordinates || feature.geometry.coordinates;
          const finalLatLng = L.latLng(coords[1], coords[0]);
          const elevationValue = mergedProps.elevation_ft ?? mergedProps.elevation;
          const elevation = elevationValue === null || elevationValue === undefined || Number.isNaN(Number(elevationValue))
            ? null
            : Number(elevationValue);
          const name = mergedProps.name || props.name || 'Unknown';
          const slug = mergedProps.slug || slugify(name);
          const imageUrls = getPoiImageUrls(mergedProps, slug);
          return { name, slug, imageUrls, elevation, finalLatLng, mergedProps };
        }

        const trailLayer = L.geoJSON(data, {
          style: feature => {
            if (feature.geometry.type === 'LineString') {
              return { color: '#66c2a5', weight: 4, opacity: 0.9 };
            }
            return {};
          },
          pointToLayer: (feature, latlng) => {
            if (feature.geometry.type === 'Point') {
              const { name, slug, imageUrls, elevation, finalLatLng, mergedProps } = getPoiMergedData(feature);
              poiData.push({
                name,
                slug,
                imageUrls,
                elevation,
                lat: finalLatLng.lat,
                lng: finalLatLng.lng,
                category: mergedProps.category || '',
                description: mergedProps.description || ''
              });
              return createPhotoMarker(finalLatLng, name, imageUrls, slug);
            }
            return L.circleMarker(latlng, {
              radius: 6,
              color: '#4ade80',
              weight: 2,
              fillColor: '#4ade80',
              fillOpacity: 0.8
            });
          },
          onEachFeature: (feature, layer) => {
            if (feature.geometry.type === 'Point') {
              const { name, slug, imageUrls, elevation, mergedProps } = getPoiMergedData(feature);
              const photoUrl = getPrimaryImageUrl(imageUrls) || getFallbackImageUrl(slug, 300);
              const popupPhoto = `<img src="${photoUrl}" alt="${name}" style="width:100%;border-radius:8px; margin-bottom:6px;">`;
              const detailLink = slug ? `<a class="poi-detail-link" href="/howker-ridge/poi?poi=${slug}">View POI details</a>` : '';
              const details = [
                popupPhoto,
                `<strong>${name || 'Waypoint'}</strong>`,
                mergedProps.category ? `<span>${mergedProps.category}</span>` : '',
                elevation ? `<span>${elevation} ft</span>` : '',
                mergedProps.description ? `<em>${mergedProps.description}</em>` : '',
                detailLink
              ].filter(Boolean).join('<br />');
              layer.bindPopup(details);
            }
          }
        }).addTo(map);

        newPoiEdits.forEach(feature => {
          const props = feature.properties || {};
          const coords = feature.geometry?.coordinates || [];
          if (coords.length < 2) return;
          const latlng = L.latLng(coords[1], coords[0]);
          const name = props.name || 'Unknown';
          const slug = props.slug || slugify(name);
          const imageUrls = getPoiImageUrls(props, slug);
          const elevationValue = props.elevation_ft ?? props.elevation;
          const elevation = elevationValue === null || elevationValue === undefined || Number.isNaN(Number(elevationValue))
            ? null
            : Number(elevationValue);
          poiData.push({
            name,
            slug,
            imageUrls,
            elevation,
            lat: latlng.lat,
            lng: latlng.lng,
            category: props.category || '',
            description: props.description || ''
          });
          const marker = createPhotoMarker(latlng, name, imageUrls, slug);
          const photoUrl = getPrimaryImageUrl(imageUrls) || getFallbackImageUrl(slug, 300);
          const detailLink = slug ? `<a class="poi-detail-link" href="/howker-ridge/poi?poi=${slug}">View POI details</a>` : '';
          const popupDetails = [
            `<img src="${photoUrl}" alt="${name}" style="width:100%;border-radius:8px; margin-bottom:6px;">`,
            `<strong>${name || 'Waypoint'}</strong>`,
            props.category ? `<span>${props.category}</span>` : '',
            elevation ? `<span>${elevation} ft</span>` : '',
            props.description ? `<em>${props.description}</em>` : '',
            detailLink
          ].filter(Boolean).join('<br />');
          marker.bindPopup(popupDetails).addTo(map);
        });

        map.fitBounds(trailLayer.getBounds(), { padding: [30, 30] });
        updatePoiTable();
      })
      .catch(err => {
        console.error('Failed to load trail data', err);
        const row = document.createElement('tr');
        row.innerHTML = '<td colspan="5">Trail data unavailable.</td>';
        poiTableBody.appendChild(row);
      });

    poiSearch.addEventListener('input', () => {
      searchQuery = poiSearch.value.trim();
      updatePoiTable();
      if (poiSearchDebounce) clearTimeout(poiSearchDebounce);
      const searchLength = searchQuery.length;
      poiSearchDebounce = setTimeout(() => {
        trackAnalytics('poi_search', { search_length: searchLength });
      }, 350);
    });

    poiHeaders.forEach(button => {
      button.addEventListener('click', () => {
        const key = button.dataset.sort;
        if (sortKey === key) {
          sortAsc = !sortAsc;
        } else {
          sortKey = key;
          sortAsc = true;
        }
        updateSortIndicators(sortKey);
        updatePoiTable();
        trackAnalytics('poi_sort', {
          sort_key: sortKey || '',
          direction: sortAsc ? 'asc' : 'desc'
        });
      });
    });
    updateSortIndicators(sortKey);

    poiTableBody.addEventListener('mousemove', (event) => {
      const thumb = event.target.closest('.poi-thumb');
      if (!thumb) return;
      const rect = thumb.getBoundingClientRect();
      const x = Math.max(0, Math.min(100, ((event.clientX - rect.left) / rect.width) * 100));
      const y = Math.max(0, Math.min(100, ((event.clientY - rect.top) / rect.height) * 100));
      thumb.style.setProperty('--zoom-x', `${x}%`);
      thumb.style.setProperty('--zoom-y', `${y}%`);
    });

    if (mapLinks) {
      mapLinks.addEventListener('click', (event) => {
        const link = event.target.closest('a.map-link');
        if (!link) return;
        const href = link.getAttribute('href') || '';
        if (link.hasAttribute('download') || /\.(gpx|kml)(\?|$)/i.test(href)) {
          const match = href.match(/\.([a-z0-9]+)(?:\?|$)/i);
          trackAnalytics('howker_gps_download', {
            file_ext: match ? match[1].toLowerCase() : ''
          });
          return;
        }
        if (/^https?:\/\//i.test(href)) {
          trackAnalytics('howker_external_map_click', {
            network: detectMapNetwork(link.textContent || '')
          });
        }
      });
    }

    document.addEventListener('click', (event) => {
      const detailLink = event.target.closest('a[href*="/howker-ridge/poi?poi="]');
      if (!detailLink) return;
      const slug = new URL(detailLink.href, window.location.origin).searchParams.get('poi') || '';
      trackAnalytics('poi_detail_open', { poi_slug: slug });
    });

    function normalizeType(type) {
      return type.toLowerCase().replace(/[^a-z0-9]+/g, '-');
    }

    function renderFlora(plants) {
      const grid = document.getElementById('floraGrid');
      grid.innerHTML = '';
      plants.forEach(plant => {
        const card = document.createElement('div');
        card.className = 'flora-card';
        const imgSrc = Array.isArray(plant.imgs) && plant.imgs.length ? plant.imgs[0] : plant.img;
        const teaser = plant.teaser
          ? plant.teaser.slice(0, 120) + (plant.teaser.length > 120 ? '‚Ä¶' : '')
          : '';
        const typeClass = `badge-${normalizeType(plant.type || 'flora')}`;
        const imgAlt = plant.common ? `Close-up of ${plant.common}` : 'Plant photograph';
        card.innerHTML = `
          <img src="${imgSrc || ''}" alt="${imgAlt}" loading="lazy" />
          <h3>${plant.common || 'Unknown plant'}</h3>
          <span class="badge ${typeClass}">${plant.type || 'Unknown type'}</span>
          <p>${teaser}</p>
          <a href="/plant/${plant.id}" class="learn-more">Learn more</a>
        `;
        grid.appendChild(card);
      });
      refreshTooltips(grid);
    }

    fetch('/data/howker-plants')
      .then(resp => resp.ok ? resp.json() : Promise.reject(resp))
      .then(data => {
        const nonTrees = data.filter(plant => !/tree|conifer/i.test(plant.type || ''));
        nonTrees.sort((a, b) => (a.type || '').localeCompare(b.type || '') || (a.common || '').localeCompare(b.common || ''));
        const selected = nonTrees.slice(0, 18);
        renderFlora(selected);
      })
      .catch(() => {
        const grid = document.getElementById('floraGrid');
        grid.innerHTML = '<p class="small">Plant catalog unavailable at the moment.</p>';
      });

    const forecastContainer = document.getElementById('forecast');
    const alertsContainer = document.getElementById('alerts');

    fetch('https://api.weather.gov/points/44.328,-71.279/forecast')
      .then(resp => resp.ok ? resp.json() : Promise.reject(resp))
      .then(data => {
        const period = data.properties.periods[0];
        forecastContainer.innerHTML = `<strong>${period.name}:</strong> ${period.detailedForecast}`;
      })
      .catch(() => {
        forecastContainer.textContent = 'Forecast not available at the moment.';
      });

    fetch('https://api.weather.gov/alerts/active?point=44.328,-71.279')
      .then(resp => resp.ok ? resp.json() : Promise.reject(resp))
      .then(data => {
        const alerts = data.features || [];
        if (!alerts.length) {
          alertsContainer.textContent = 'No active NWS alerts for this area.';
          return;
        }
        const list = document.createElement('ul');
        alerts.forEach(alert => {
          const item = document.createElement('li');
          const props = alert.properties || {};
          item.textContent = props.headline || props.event || 'Active alert';
          list.appendChild(item);
        });
        alertsContainer.innerHTML = '';
        alertsContainer.appendChild(list);
      })
      .catch(() => {
        alertsContainer.textContent = 'Alerts unavailable at the moment.';
      });
  </script>
</body>
</html>
