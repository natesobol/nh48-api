<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<!-- Favicons - ICO format preferred for Google compatibility -->
<link rel="icon" href="/favicons/favicon.ico" sizes="48x48" />
<link rel="icon" type="image/x-icon" href="/favicons/favicon.ico" />
<link rel="shortcut icon" href="/favicons/favicon.ico" />
<link rel="icon" type="image/x-icon" sizes="16x16" href="/favicons/favicon-16x16.ico" />
<link rel="icon" type="image/x-icon" sizes="32x32" href="/favicons/favicon-32x32.ico" />
<link rel="icon" type="image/x-icon" sizes="48x48" href="/favicons/favicon-48x48.ico" />
<link rel="icon" type="image/x-icon" sizes="96x96" href="/favicons/favicon-96x96.ico" />
<!-- PNG fallbacks for browsers that prefer PNG -->
<link rel="icon" type="image/png" sizes="16x16" href="/favicons/favicon-16.png" />
<link rel="icon" type="image/png" sizes="32x32" href="/favicons/favicon-32.png" />
<link rel="icon" type="image/png" sizes="48x48" href="/favicons/favicon-48.png" />
<link rel="icon" type="image/png" sizes="96x96" href="/favicons/favicon-96.png" />
<link rel="apple-touch-icon" sizes="180x180" href="/favicons/apple-touch-icon.png" />
<link rel="manifest" href="/manifest.json" />
<title>Howker Ridge POI | NH48.info</title>
<meta name="description" content="Point of interest details for the Howker Ridge Trail on Mount Madison." />
<meta name="keywords" content="Howker Ridge Trail, point of interest, trail map, Mount Madison, New Hampshire" />
<link rel="canonical" href="https://nh48.info/howker-ridge/poi" />
<meta property="og:type" content="website" />
<meta property="og:title" content="Howker Ridge POI" />
<meta property="og:description" content="Point of interest details for the Howker Ridge Trail." />
<meta property="og:url" content="https://nh48.info/howker-ridge/poi" />
<meta property="og:image" content="https://photos.nh48.info/cdn-cgi/image/format=jpg,quality=85,width=1200/mount-madison/mount-madison__003.jpg" />
<meta property="og:image:alt" content="Mount Madison ridge view with alpine terrain and distant peaks" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:title" content="Howker Ridge POI" />
<meta name="twitter:description" content="Point of interest details for the Howker Ridge Trail." />
<meta name="twitter:image" content="https://photos.nh48.info/cdn-cgi/image/format=jpg,quality=85,width=1200/mount-madison/mount-madison__003.jpg" />
<meta name="twitter:image:alt" content="Mount Madison ridge view with alpine terrain and distant peaks" />
<script>
  (() => {
    if (window.NH48_BUILD_DATE) return;
    try {
      const xhr = new XMLHttpRequest();
      xhr.open('GET', '/build-meta.json', false);
      xhr.send(null);
      if (xhr.status >= 200 && xhr.status < 300) {
        const meta = JSON.parse(xhr.responseText);
        if (meta && meta.buildDate) {
          window.NH48_BUILD_DATE = meta.buildDate;
        }
      }
    } catch (err) {
      // No-op: build date is optional in static builds.
    }
  })();
</script>
<script src="/js/unified-footer.js" defer></script>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha384-sHL9NAb7lN7rfvG5lfHpm643Xkcjzp4jFvuavGOndn6pjVqS6ny56CAt3nsEVT4H" crossorigin="" />
<style>
:root{
  --bg:#0a0a0a;
  --panel:#12121a;
  --card:#171a22;
  --ink:#ffffff;
  --muted:#ffffff;
  --stroke:#2b3345;
  --accent:#4ade80;
  --accent-2:#38bdf8;
  --hero-overlay:rgba(4,8,16,0.7);
  --gap:16px;
}
body.light{
  --bg:#f8fafc;
  --panel:#ffffff;
  --card:#f7f9fc;
  --ink:#ffffff;
  --muted:#ffffff;
  --stroke:#00000022;
  --accent:#16a34a;
  --accent-2:#0ea5e9;
  --hero-overlay:rgba(255,255,255,0.6);
}
*{ box-sizing:border-box; }
html{ min-width:320px; scroll-behavior:smooth; }
@media (prefers-reduced-motion: reduce){
  html{ scroll-behavior:auto; }
}
body{
  margin:0;
  background:var(--bg);
  color:var(--ink);
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
  -webkit-font-smoothing:antialiased;
  text-rendering:optimizeLegibility;
}
.wrap{
  max-width:1200px;
  margin:0 auto;
  padding:12px;
}
.hero{
  background:
    linear-gradient(120deg,var(--hero-overlay),rgba(4,8,16,0.4)),
    url('https://photos.nh48.info/cdn-cgi/image/format=jpg,quality=85,width=1400/mount-madison/mount-madison__003.jpg') center/cover no-repeat;
  border-radius:16px;
  padding:36px;
  box-shadow:0 20px 40px #0005;
}
.hero h1{
  margin:0 0 10px;
  font-size:clamp(28px,4vw,40px);
}
.hero p{
  margin:0;
  max-width:680px;
  color:var(--muted);
  font-size:1rem;
  line-height:1.6;
}
.page-breadcrumbs{
  margin:10px 0 18px;
  font-size:13px;
  color:var(--muted);
}
.page-breadcrumbs ol{
  list-style:none;
  padding:0;
  margin:0;
  display:flex;
  flex-wrap:wrap;
  gap:6px;
}
.page-breadcrumbs li::after{
  content:"/";
  margin-left:6px;
  color:var(--muted);
}
.page-breadcrumbs li:last-child::after{
  content:"";
}
.page-breadcrumbs a{
  color:inherit;
  text-decoration:none;
}
.page-breadcrumbs a:hover{
  color:var(--accent);
}
.section{
  margin-top:28px;
}
.section h2{
  margin:0 0 10px;
  font-size:clamp(18px,2vw,24px);
}
.section p{
  margin:0 0 12px;
  color:var(--ink);
  line-height:1.6;
}
.card{
  background:var(--card);
  border:1px solid var(--stroke);
  border-radius:12px;
  padding:16px;
}
.grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(260px,1fr));
  gap:var(--gap);
}
.poi-photo{
  display:grid;
  gap:12px;
  grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
  align-items:stretch;
  background:var(--panel);
  border-radius:12px;
  border:1px solid var(--stroke);
  overflow:hidden;
  min-height:240px;
  padding:12px;
}
.poi-photo img{
  width:100%;
  height:220px;
  object-fit:cover;
  border-radius:10px;
}
.poi-photo.is-empty{
  color:var(--muted);
  font-size:0.95rem;
  text-align:center;
  padding:24px;
}
.meta-table{
  width:100%;
  border-collapse:collapse;
  font-size:0.95rem;
}
.meta-table th,
.meta-table td{
  text-align:left;
  padding:8px 6px;
  border-bottom:1px solid var(--stroke);
  color:var(--ink);
}
.meta-table th{
  width:40%;
  font-weight:600;
  color:var(--muted);
}
#poi-map{
  height:380px;
  width:100%;
  border-radius:10px;
  overflow:hidden;
  border:1px solid var(--stroke);
}
.back-link{
  display:inline-flex;
  align-items:center;
  gap:8px;
  margin-top:8px;
  color:var(--accent-2);
  text-decoration:none;
}
.back-link:hover{
  color:var(--accent);
}
.is-hidden{
  display:none;
}
</style>
</head>
<body data-route="howker-ridge" data-page="howker-ridge-poi">
  <div id="nav-placeholder"></div>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const navPlaceholder = document.getElementById('nav-placeholder');
      const activeRoute = document.body.dataset.route || document.body.dataset.page;

      if (navPlaceholder) {
        fetch('/pages/nav.html')
          .then(response => response.text())
          .then(html => {
            navPlaceholder.innerHTML = html;
            const links = navPlaceholder.querySelectorAll('.site-nav-links a');
            links.forEach(link => {
              const routes = (link.dataset.routes || link.dataset.route || '')
                .split(',')
                .map(value => value.trim())
                .filter(Boolean);

              if (routes.includes(activeRoute)) {
                link.classList.add('active');
                link.setAttribute('aria-current', 'page');
              }
            });
            if (window.NH48_I18N && window.NH48_I18N.refreshLangPicker) {
              window.NH48_I18N.refreshLangPicker();
            }
          })
          .catch(err => console.error('Failed to load navigation:', err));
      }
    });
  </script>

  <div class="wrap">
    <header class="hero" id="poiHero">
      <h1 id="poiName">Loading POI...</h1>
      <p id="poiSubtitle">Fetching details from the Howker Ridge dataset.</p>
    </header>

    <nav class="page-breadcrumbs" aria-label="Breadcrumb">
      <ol>
        <li><a href="/">Home</a></li>
        <li><a href="/howker-ridge">Howker Ridge</a></li>
        <li id="poiBreadcrumb">POI Detail</li>
      </ol>
    </nav>

    <section class="section card" data-poi-content>
      <div class="grid">
        <div class="poi-photo" id="poiPhotoWrap"></div>
        <div class="card">
          <h2>Point of interest details</h2>
          <table class="meta-table" aria-label="POI metadata">
            <tbody>
              <tr id="rowCategory">
                <th scope="row">Category</th>
                <td id="poiCategory">—</td>
              </tr>
              <tr id="rowElevation">
                <th scope="row">Elevation</th>
                <td id="poiElevation">—</td>
              </tr>
              <tr id="rowCoords">
                <th scope="row">Coordinates</th>
                <td id="poiCoordinates">—</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </section>

    <section class="section card" data-poi-content>
      <h2>Map</h2>
      <div id="poi-map" aria-label="Map of this point of interest"></div>
    </section>

    <section class="section card" data-poi-content>
      <h2>Description</h2>
      <p id="poiDescription">—</p>
    </section>

    <section class="section card is-hidden" id="poiNotFound">
      <h2>POI not found</h2>
      <p>We couldn’t locate that point of interest in the Howker Ridge dataset.</p>
      <a class="back-link" href="/howker-ridge">← Back to Howker Ridge trail map</a>
    </section>
  </div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha384-cxOPjt7s7Iz04uaHJceBmS+qpjv2JkIHNVcuOrM+YHwZOmJGBXI00mdUXEq65HTH" crossorigin=""></script>
  <script>
    const standardLayer = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; OpenStreetMap contributors'
    });
    const topoLayer = L.tileLayer('https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; OpenTopoMap contributors'
    });

    const poiSlug = new URLSearchParams(window.location.search).get('poi');
    const poiName = document.getElementById('poiName');
    const poiSubtitle = document.getElementById('poiSubtitle');
    const poiBreadcrumb = document.getElementById('poiBreadcrumb');
    const poiHero = document.getElementById('poiHero');
    const poiPhotoWrap = document.getElementById('poiPhotoWrap');
    const poiCategory = document.getElementById('poiCategory');
    const poiElevation = document.getElementById('poiElevation');
    const poiCoordinates = document.getElementById('poiCoordinates');
    const poiDescription = document.getElementById('poiDescription');
    const rowCategory = document.getElementById('rowCategory');
    const rowElevation = document.getElementById('rowElevation');
    const rowCoords = document.getElementById('rowCoords');
    const notFound = document.getElementById('poiNotFound');
    const contentSections = document.querySelectorAll('[data-poi-content]');
    let photoCatalogBySlug = new Map();

    function slugify(name) {
      return name.toLowerCase().replace(/[^a-z0-9]+/g, '-').replace(/^-|-$/g, '');
    }

    function formatDMS(value, isLat) {
      const absVal = Math.abs(value);
      const deg = Math.floor(absVal);
      const minFloat = (absVal - deg) * 60;
      const min = Math.floor(minFloat);
      const sec = Math.round((minFloat - min) * 60);
      const hemi = isLat ? (value >= 0 ? 'N' : 'S') : (value >= 0 ? 'E' : 'W');
      return `${deg}°${min}'${sec}" ${hemi}`;
    }

    function hideRow(row) {
      if (row) {
        row.classList.add('is-hidden');
      }
    }

    function showNotFound() {
      notFound.classList.remove('is-hidden');
      contentSections.forEach(section => section.classList.add('is-hidden'));
      poiName.textContent = 'POI not found';
      poiSubtitle.textContent = 'Return to the Howker Ridge map to choose another location.';
      poiBreadcrumb.textContent = 'Not found';
    }

    function normalizeImageUrls(value) {
      if (!value) return [];
      if (Array.isArray(value)) {
        return value.map(item => (typeof item === 'string' ? item.trim() : '')).filter(Boolean);
      }
      if (typeof value === 'string') {
        const trimmed = value.trim();
        return trimmed ? [trimmed] : [];
      }
      return [];
    }

    function slugFromFilename(filename) {
      if (!filename || typeof filename !== 'string') return '';
      return filename.replace(/\.[^/.]+$/, '').replace(/-\d+$/, '');
    }

    function buildPhotoCatalog(data) {
      const catalog = new Map();
      const filenames = Object.keys(data || {}).sort();
      filenames.forEach(filename => {
        const slug = slugFromFilename(filename);
        if (!slug) return;
        const url = `https://howker.nh48.info/cdn-cgi/image/format=webp,width=1400/${slug}/${filename}`;
        if (!catalog.has(slug)) catalog.set(slug, []);
        catalog.get(slug).push(url);
      });
      return catalog;
    }

    function getCatalogImageUrls(slug) {
      if (!slug || !photoCatalogBySlug) return [];
      return photoCatalogBySlug.get(slug) || [];
    }

    function getImageUrlsFromProps(props = {}) {
      return normalizeImageUrls(
        props.image_urls
        || props.imageUrls
        || props.image_url
        || props.imageUrl
      );
    }

    function mergeImageUrls(primary, fallback) {
      const combined = [];
      const seen = new Set();
      [primary, fallback].forEach(list => {
        (Array.isArray(list) ? list : []).forEach(url => {
          if (!url || seen.has(url)) return;
          seen.add(url);
          combined.push(url);
        });
      });
      return combined;
    }

    function getPoiImageUrls(props = {}, slug = '') {
      const primary = getImageUrlsFromProps(props);
      const fallback = getCatalogImageUrls(slug);
      return mergeImageUrls(primary, fallback);
    }

    function getPrimaryImageUrl(imageUrls) {
      if (!Array.isArray(imageUrls)) return '';
      return imageUrls.find(url => typeof url === 'string' && url.trim().length) || '';
    }

    if (!poiSlug) {
      showNotFound();
    } else {
      Promise.all([
        fetch('/data/howker-ridge.geojson').then(resp => resp.json()),
        fetch('/data/howker-ridge-pois.geojson').then(resp => (resp.ok ? resp.json() : { features: [] })),
        fetch('/data/howker-photos.json')
          .then(resp => (resp.ok ? resp.json() : {}))
          .catch(() => ({}))
      ])
        .then(([baseData, edits, photoCatalog]) => {
          photoCatalogBySlug = buildPhotoCatalog(photoCatalog);
          const editsByName = new Map();
          const editsBySlug = new Map();
          (edits.features || []).forEach(feature => {
            const props = feature.properties || {};
            const name = props.name || '';
            if (name) {
              editsByName.set(name, feature);
            }
            const slug = props.slug || (name ? slugify(name) : '');
            if (slug) {
              editsBySlug.set(slug, feature);
            }
          });

          const baseFeature = (baseData.features || []).find(item => {
            if (item.geometry?.type !== 'Point') return false;
            const name = item.properties?.name || '';
            return slugify(name) === poiSlug;
          });
          const editFeature = editsBySlug.get(poiSlug);

          let props = null;
          let coords = null;
          if (baseFeature) {
            const baseProps = baseFeature.properties || {};
            const editForBase = editsByName.get(baseProps.name) || editFeature;
            const editProps = editForBase?.properties || {};
            props = { ...baseProps, ...editProps };
            coords = editForBase?.geometry?.coordinates || baseFeature.geometry.coordinates;
          } else if (editFeature) {
            props = editFeature.properties || {};
            coords = editFeature.geometry?.coordinates || null;
          }

          if (!props || !coords) {
            showNotFound();
            return;
          }

          const name = props.name || 'Howker Ridge POI';
          const lat = coords[1];
          const lng = coords[0];
          const category = props.category || '';
          const elevationValue = props.elevation_ft ?? props.elevation;
          const elevation = elevationValue === null || elevationValue === undefined || Number.isNaN(Number(elevationValue))
            ? null
            : Math.round(Number(elevationValue));
          const description = props.description || 'No description is available yet for this point of interest.';
          const slug = props.slug || slugify(name);
          const imageUrls = getPoiImageUrls(props, slug);

          poiName.textContent = name;
          poiBreadcrumb.textContent = name;
          poiSubtitle.textContent = category ? `${category}${elevation ? ` • ${elevation.toLocaleString()} ft` : ''}` : 'Howker Ridge point of interest';
          poiDescription.textContent = description;

          if (category) {
            poiCategory.textContent = category;
          } else {
            hideRow(rowCategory);
          }

          if (elevation) {
            poiElevation.textContent = `${elevation.toLocaleString()} ft`;
          } else {
            hideRow(rowElevation);
          }

          if (typeof lat === 'number' && typeof lng === 'number') {
            poiCoordinates.textContent = `${lat.toFixed(6)}, ${lng.toFixed(6)} (${formatDMS(lat, true)}, ${formatDMS(lng, false)})`;
          } else {
            hideRow(rowCoords);
          }

          const heroUrl = getPrimaryImageUrl(imageUrls)
            || `https://howker.nh48.info/cdn-cgi/image/format=webp,width=1400/${slug}/${slug}-001.jpg`;
          poiHero.style.backgroundImage = `linear-gradient(120deg,var(--hero-overlay),rgba(4,8,16,0.4)),url('${heroUrl}')`;

          const fallbackPhotoUrl = `https://howker.nh48.info/cdn-cgi/image/format=webp,width=900/${slug}/${slug}-001.jpg`;
          const photoUrls = imageUrls.length ? imageUrls : [fallbackPhotoUrl];
          poiPhotoWrap.innerHTML = '';
          poiPhotoWrap.classList.remove('is-empty');
          photoUrls.forEach((url, index) => {
            const img = document.createElement('img');
            img.src = url;
            img.alt = `${name} photo ${index + 1}`;
            img.loading = 'lazy';
            img.onerror = () => {
              img.remove();
              if (!poiPhotoWrap.querySelector('img')) {
                poiPhotoWrap.classList.add('is-empty');
                poiPhotoWrap.textContent = 'Photo coming soon.';
              }
            };
            poiPhotoWrap.appendChild(img);
          });

          document.title = `${name} – Howker Ridge POI | NH48.info`;

          const map = L.map('poi-map', { layers: [topoLayer], scrollWheelZoom: false }).setView([lat, lng], 17);
          L.control.layers({ 'Topographic': topoLayer, 'Standard': standardLayer }, null, { position: 'topleft' }).addTo(map);
          L.control.scale({ position: 'bottomleft' }).addTo(map);
          L.marker([lat, lng]).addTo(map).bindPopup(name).openPopup();
        })
        .catch(() => {
          showNotFound();
        });
    }
  </script>
</body>
</html>
