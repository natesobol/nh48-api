<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<!-- Favicons - ICO format preferred for Google compatibility -->
<link rel="icon" href="/favicons/favicon.ico" sizes="48x48" />
<link rel="icon" type="image/x-icon" href="/favicons/favicon.ico" />
<link rel="shortcut icon" href="/favicons/favicon.ico" />
<link rel="icon" type="image/x-icon" sizes="16x16" href="/favicons/favicon-16x16.ico" />
<link rel="icon" type="image/x-icon" sizes="32x32" href="/favicons/favicon-32x32.ico" />
<link rel="icon" type="image/x-icon" sizes="48x48" href="/favicons/favicon-48x48.ico" />
<link rel="icon" type="image/x-icon" sizes="96x96" href="/favicons/favicon-96x96.ico" />
<!-- PNG fallbacks for browsers that prefer PNG -->
<link rel="icon" type="image/png" sizes="16x16" href="/favicons/favicon-16.png" />
<link rel="icon" type="image/png" sizes="32x32" href="/favicons/favicon-32.png" />
<link rel="icon" type="image/png" sizes="48x48" href="/favicons/favicon-48x48.png" />
<link rel="icon" type="image/png" sizes="96x96" href="/favicons/favicon-96x96.png" />
<link rel="apple-touch-icon" sizes="180x180" href="/favicons/apple-touch-icon.png" />
<link rel="manifest" href="/manifest.json" />
<title>Howker Ridge • Plant</title>
<meta id="meta-description" name="description" content="Detailed view for an alpine/subalpine plant observed along Howker Ridge Trail. Explore photos, facts, and notes for the selected species." />
<link rel="canonical" href="https://nh48.info/pages/plant.html" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://nh48.info/pages/plant.html" />
<meta id="og-image" property="og:image" content="" />
<meta id="og-image-alt" property="og:image:alt" content="" />
<meta name="twitter:card" content="summary_large_image" />
<meta id="twitter-image" name="twitter:image" content="" />
<meta id="twitter-image-alt" name="twitter:image:alt" content="" />
<meta id="og-title" property="og:title" content="Howker Ridge • Plant" />
<meta id="og-description" property="og:description" content="Detailed species view for alpine and subalpine plants observed along the Howker Ridge Trail." />
<meta id="twitter-title" name="twitter:title" content="Howker Ridge • Plant" />
<meta id="twitter-description" name="twitter:description" content="Explore species facts, field notes, and photo credits for alpine plants along Howker Ridge." />
<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebPage",
    "name": "Howker Ridge Plant",
    "description": "Detailed species view for alpine and subalpine plants observed along the Howker Ridge Trail.",
    "url": "https://nh48.info/pages/plant.html",
    "isPartOf": {
      "@type": "WebSite",
      "name": "NH48 API",
      "url": "https://nh48.info/"
    },
    "breadcrumb": {
      "@type": "BreadcrumbList",
      "itemListElement": [
        {
          "@type": "ListItem",
          "position": 1,
          "name": "Home",
          "item": "https://nh48.info/"
        },
        {
          "@type": "ListItem",
          "position": 2,
          "name": "Projects",
          "item": "https://nh48.info/plant-catalog"
        },
        {
          "@type": "ListItem",
          "position": 3,
          "name": "Howker Ridge Plant Catalog",
          "item": "https://nh48.info/plant-catalog"
        },
        {
          "@type": "ListItem",
          "position": 4,
          "name": "Plant",
          "item": "https://nh48.info/pages/plant.html"
        }
      ]
    }
  }
</script>
<script id="plant-images-jsonld" type="application/ld+json"></script>
<script>
  (() => {
    if (window.NH48_BUILD_DATE) return;
    try {
      const xhr = new XMLHttpRequest();
      xhr.open('GET', '/build-meta.json', false);
      xhr.send(null);
      if (xhr.status >= 200 && xhr.status < 300) {
        const meta = JSON.parse(xhr.responseText);
        if (meta && meta.buildDate) {
          window.NH48_BUILD_DATE = meta.buildDate;
        }
      }
    } catch (err) {
      // No-op: build date is optional in static builds.
    }
  })();
</script>
<script src="/js/unified-footer.js" defer></script>

<style>
/*
  The majority of this stylesheet mirrors the catalog page.  It defines a dark/light
  theme palette, layout containers, typography, responsive grids, and pagination UI.
  Even though the details page does not use cards or pagination, these styles are
  retained to preserve overall length and consistency across both pages.
*/
/****************************
 * THEME VARIABLES
 ****************************/
:root{
  --bg:#0a0a0a;
  --panel:#12121a;
  --card:#171a22;
  --ink:#ffffff;
  --muted:#a5b4c3;
  --stroke:#ffffff;
  --accent:#22c55e;
  --gap:10px;
}
body.light{
  --bg:#f8fafc;
  --panel:#ffffff;
  --card:#f7f9fc;
  --ink:#1f2937;
  --muted:#6b7280;
  --stroke:#00000022;
  --accent:#22c55e;
}

/****************************
 * GLOBAL RESETS & BASICS
 ****************************/
*{ box-sizing:border-box; }
html{
  min-width:320px;
  scroll-behavior:smooth;
}
@media (prefers-reduced-motion: reduce){
  html{ scroll-behavior:auto; }
}
body{
  margin:0;
  background:var(--bg);
  color:var(--ink);
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
  -webkit-font-smoothing:antialiased;
  text-rendering:optimizeLegibility;
  overflow:auto;
}

/****************************
 * LAYOUT CONTAINERS
 ****************************/
.wrap{
  max-width:1100px;
  margin:24px auto;
  padding:16px;
}
.panel{
  background:var(--panel);
  border:none;
  border-radius:14px;
  padding:20px 20px 24px;
  box-shadow:0 10px 30px #0004;
  overflow:hidden;
}

/****************************
 * TYPOGRAPHY
 ****************************/
header h1{
  margin:0 0 8px;
  font-size:clamp(20px,3.2vw,28px);
  letter-spacing:.2px;
  line-height:1.2;
}
header p{
  margin:0;
  color:var(--muted);
}
header.plant-hero{
  position:relative;
  padding:36px 24px;
  border-radius:14px;
  background-image:url('https://howker.nh48.info/blueberry-ledge/blueberry-ledge-001.jpg');
  background-size:cover;
  background-position:center 68%;
  color:#f6f7fb;
  overflow:hidden;
}
header.plant-hero::before{
  content:"";
  position:absolute;
  inset:0;
  background:linear-gradient(120deg, rgba(6,9,16,0.7), rgba(6,9,16,0.35));
}
header.plant-hero blockquote{
  position:relative;
  margin:0;
  z-index:1;
}
header.plant-hero h1{
  color:inherit;
  text-shadow:0 8px 24px rgba(0,0,0,0.55);
}
header.plant-hero.sticky{
  background-image:none;
  background-color:var(--panel);
  color:var(--ink);
}
header.plant-hero.sticky::before{
  content:none;
}
header.plant-hero.sticky h1{
  text-shadow:none;
}

.page-breadcrumbs{
  margin:6px 0 16px;
  font-size:13px;
  color:var(--muted);
}
.page-breadcrumbs ol{
  list-style:none;
  padding:0;
  margin:0;
  display:flex;
  flex-wrap:wrap;
  gap:6px;
}
.page-breadcrumbs li::after{
  content:"/";
  margin-left:6px;
  color:var(--muted);
}
.page-breadcrumbs li:last-child::after{
  content:"";
}
.page-breadcrumbs a{
  color:inherit;
  text-decoration:none;
}
.page-breadcrumbs a:hover{
  color:var(--accent);
}
.text-guide{
  font-size:0.9rem;
  margin:0 0 1rem;
}

/****************************
 * DETAILS PAGE ELEMENTS
 ****************************/
/* The details view uses a carousel similar to the catalog drawer. */
.media{
  background:var(--card);
  border:1px solid var(--stroke);
  border-radius:12px;
  overflow:hidden;
  margin:16px 8px 20px;
  position:relative;
  aspect-ratio:4/3;
  min-height:clamp(240px, 60vw, 520px);
  max-height:min(65vh, 640px);
  box-sizing:border-box;
  box-shadow:0 18px 46px rgba(0,0,0,0.35);
}
.carousel{
  position:relative;
  width:100%;
  height:100%;
  overflow:hidden;
}
.slide{
  position:absolute;
  inset:0;
  opacity:0;
  transition:opacity .35s ease;
}
.slide.active{
  opacity:1;
}
.slide figure{
  margin:0;
  display:flex;
  align-items:center;
  justify-content:center;
  padding:6px;
  box-sizing:border-box;
  height:100%;
}
.slide figure img{
  max-height:100%;
  width:100%;
  height:100%;
  object-fit:contain;
  object-position:center;
  display:block;
  border-radius:8px;
}
.dots{
  position:absolute;
  bottom:12px;
  left:12px;
  right:12px;
  display:flex;
  gap:10px;
  padding:10px;
  background:rgba(10,10,10,0.55);
  border:1px solid rgba(255,255,255,0.18);
  border-radius:12px;
  overflow-x:auto;
  z-index:2;
}
.dot{
  width:70px;
  height:46px;
  border-radius:10px;
  border:1px solid rgba(255,255,255,0.35);
  background-size:cover;
  background-position:center;
  background-repeat:no-repeat;
  background-color:#0f1118;
  cursor:pointer;
  opacity:0.8;
  transition:transform 0.2s ease, opacity 0.2s ease, border-color 0.2s ease;
  flex:0 0 auto;
  padding:0;
  appearance:none;
}
.dot:focus-visible{
  outline:2px solid var(--accent);
  outline-offset:2px;
}
.dot:hover{ opacity:1; transform:translateY(-2px); }
.dot.active{
  opacity:1;
  border-color:var(--accent);
  box-shadow:0 10px 24px rgba(0,0,0,0.35);
}
.ctrls{
  position:absolute;
  inset:0;
  display:flex;
  justify-content:space-between;
  align-items:center;
  pointer-events:none;
}
.ctrls button{
  pointer-events:auto;
  background:rgba(10,10,10,0.5);
  border:1px solid rgba(255,255,255,0.45);
  color:#ffffff;
  border-radius:50%;
  width:42px;
  height:42px;
  padding:0;
  margin:0 10px;
  cursor:pointer;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:1.25rem;
  box-shadow:0 12px 28px rgba(0,0,0,0.35);
  transition:transform 0.2s ease, background 0.2s ease, border-color 0.2s ease;
}
.ctrls button:hover{ background:rgba(10,10,10,0.7); border-color:var(--accent); transform:translateY(-1px); }
.ctrls button:focus-visible{ outline:2px solid var(--accent); outline-offset:2px; }

/* Countdown timer styles ---------------------------------------------- */
.timer{
  position:absolute;
  top:8px;
  right:8px;
  display:flex;
  align-items:center;
  gap:8px;
  padding:6px 8px;
  background:rgba(0,0,0,0.35);
  border-radius:12px;
  z-index:3;
}
.timer-visual{
  position:relative;
  width:56px;
  height:56px;
  display:flex;
  align-items:center;
  justify-content:center;
}
.timer svg{
  width:100%;
  height:100%;
  transform:rotate(-90deg);
}
.timer-ring{
  fill:none;
  stroke:var(--accent);
  stroke-width:4;
  stroke-linecap:round;
  transition:stroke-dashoffset 0.1s linear;
}
.timer-text{
  position:absolute;
  color:var(--accent);
  font-size:0.8rem;
  font-weight:600;
  pointer-events:none;
}
.timer-pause{
  background:rgba(255,255,255,0.15);
  color:var(--accent);
  border:1px solid rgba(255,255,255,0.25);
  border-radius:50%;
  width:32px;
  height:32px;
  display:flex;
  align-items:center;
  justify-content:center;
  font-weight:700;
  cursor:pointer;
  transition:background 0.2s ease, transform 0.2s ease;
}
.timer-pause:focus-visible{
  outline:2px solid var(--accent);
  outline-offset:2px;
}
.timer-pause:hover{
  background:rgba(255,255,255,0.25);
  transform:scale(1.02);
}
.content{
  padding:14px;
  overflow-wrap:break-word;
  hyphens:auto;
}
.facts{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:10px;
}
@media(max-width:560px){
  .facts{ grid-template-columns:1fr; }
}
.fact{
  background:var(--card);
  border:1px solid var(--stroke);
  border-radius:10px;
  padding:10px;
}
.fact h4{
  margin:0 0 6px;
  padding-bottom:6px;
  border-bottom:1px dotted var(--stroke);
  font-size:12px;
  color:var(--muted);
  letter-spacing:.2px;
  text-transform:uppercase;
}
.fact p{
  margin:0;
  font-size:14px;
}
.section{
  margin-top:12px;
}
.section h3{
  margin:0 0 6px;
  font-size:14px;
}
.section[hidden]{
  display:none;
}

/* Chips / tag row under the title */
.chiprow{
  display:flex;
  flex-wrap:wrap;
  gap:6px;
  margin:8px 0 4px;
}
.chip{
  display:inline-block;
  border:none;
  border-radius:0;
  padding:0;
  font-size:11px;
  color:var(--muted);
  white-space:nowrap;
}

/* Back link styling */
.back-link{
  display:inline-block;
  margin-bottom:16px;
  color:var(--accent);
  font-size:14px;
  text-decoration:none;
}
.back-link:hover{
  text-decoration:underline;
}

/* Hide unused grid/pagination in details page by default.  These definitions
   remain for length consistency but won't be used in this file. */
.grid{ display:none; }
.pager-wrap{ display:none; }
.controls{ display:none; }

/****************************
 * RESPONSIVE BREAKPOINTS
 ****************************/
@media (max-width:480px){
  :root{
    --edge:max(10px, env(safe-area-inset-left), env(safe-area-inset-right));
  }
  .wrap{
    padding:0;
    margin:16px auto;
  }
  .panel{
    width:calc(100% - (2 * var(--edge)));
    margin-inline:var(--edge);
    max-width:none;
    border-radius:12px;
    padding:16px 12px 20px;
  }
  header h1{
    font-size:20px;
  }
  .media{
    margin:12px 0 16px;
    padding:6px;
  }
}
@media (max-width:320px){
  :root{
    --edge:max(8px, env(safe-area-inset-left), env(safe-area-inset-right));
  }
  .panel{
    width:calc(100% - (2 * var(--edge)));
    margin-inline:var(--edge);
    border-radius:10px;
  }
  header h1{
    font-size:18px;
  }
}
</style>

</head>
<body data-route="plant-catalog" data-page="plant-detail">
  <div id="nav-placeholder"></div>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const navPlaceholder = document.getElementById('nav-placeholder');
      const activeRoute = document.body.dataset.route || document.body.dataset.page;

      if (navPlaceholder) {
        fetch('/pages/nav.html')
          .then(response => response.text())
          .then(html => {
            navPlaceholder.innerHTML = html;
            const links = navPlaceholder.querySelectorAll('.site-nav-links a');
            links.forEach(link => {
              const routes = (link.dataset.routes || link.dataset.route || '')
                .split(',')
                .map(value => value.trim())
                .filter(Boolean);

              if (routes.includes(activeRoute)) {
                link.classList.add('active');
                link.setAttribute('aria-current', 'page');
              }
            });
            if (window.NH48_I18N && window.NH48_I18N.refreshLangPicker) {
              window.NH48_I18N.refreshLangPicker();
            }
          })
          .catch(err => console.error('Failed to load navigation:', err));
      }
    });
  </script>

<div class="wrap panel" id="plant-detail">
  <header class="plant-hero">
    <blockquote>
      <h1 id="detail-title">Howker Ridge • Plant</h1>
    </blockquote>
  </header>
  <nav class="page-breadcrumbs" aria-label="Breadcrumb">
    <ol>
      <li><a href="/">Home</a></li>
      <li><a href="/plant-catalog">Projects</a></li>
      <li><a href="/plant-catalog">Howker Ridge Plant Catalog</a></li>
      <li><span id="detail-breadcrumb">Plant</span></li>
    </ol>
  </nav>
  <p class="text-guide">Detailed information for an alpine or subalpine species recorded along Howker Ridge Trail. Use the back link to return to the catalog.</p>

  <!-- Details content -->
  <a href="/plant-catalog" class="back-link">← Back to Catalog</a>
  <header>
    <h2 id="d-title"></h2>
    <div class="latin" id="d-latin"></div>
    <div class="chiprow" id="d-tags"></div>
  </header>
  <div class="media">
    <div id="carousel" class="carousel" aria-roledescription="carousel" aria-label="Photos" tabindex="0"></div>
    <div id="dots" class="dots" aria-hidden="true"></div>
    <div class="ctrls">
      <button type="button" id="prevBtn" aria-label="Previous image">‹</button>
      <button type="button" id="nextBtn" aria-label="Next image">›</button>
    </div>
    <div class="timer" id="carouselTimer" hidden>
      <div class="timer-visual">
        <svg viewBox="0 0 40 40">
          <circle id="timerRing" class="timer-ring" cx="20" cy="20" r="18"></circle>
        </svg>
        <span id="timerText" class="timer-text"></span>
      </div>
      <button id="carouselPauseBtn" type="button" class="timer-pause" aria-label="Pause carousel" aria-pressed="false" title="Pause carousel">❚❚</button>
    </div>
  </div>
  <div class="content" id="drawerContent">
    <div class="facts">
      <div class="fact"><h4>TYPE</h4><p id="f-type">—</p></div>
      <div class="fact"><h4>ELEVATION</h4><p id="f-elev">—</p></div>
      <div class="fact"><h4>HABITAT</h4><p id="f-habitat">—</p></div>
      <div class="fact"><h4>BLOOM / SEASON</h4><p id="f-bloom">—</p></div>
      <div class="fact"><h4>LEAF &amp; STEM</h4><p id="f-morph">—</p></div>
      <div class="fact"><h4>SIMILAR SPECIES</h4><p id="f-similar">—</p></div>
      <div class="fact"><h4>ECOLOGY</h4><p id="f-ecology">—</p></div>
      <div class="fact"><h4>STATUS</h4><p id="f-status">—</p></div>
    </div>

    <div class="section" id="sec-desc" hidden>
      <h3>Short Description</h3>
      <p id="d-desc"></p>
    </div>

    <div class="section" id="sec-notes" hidden>
      <h3>Field Notes</h3>
      <ul id="d-notes"></ul>
    </div>

    <div class="section" id="sec-credits" hidden>
      <h3>Photo Credits</h3>
      <p id="d-credits"></p>
    </div>
  </div>
</div>

<script>
  /* =============================================================
     HOWKER RIDGE — PLANT DETAILS (standalone page)
     Focused on rendering a single plant identified by the "id" query parameter.
  ============================================================= */

  /* ---------- Data & State ---------- */
  let PLANTS = [];
  // Carousel state
  let carouselTimer = null;
  let timerInterval = null;
  let carouselIdx = 0;
  let carouselImgs = [];
  let currentDelay = 8000;
  const BASE_DELAY = 8000;
  let isCarouselPaused = false;

  // DOM helpers
  const $ = s => document.querySelector(s);
  const carouselEl = $("#carousel");
  const dotsEl = $("#dots");
  const prevBtn = document.getElementById('prevBtn');
  const nextBtn = document.getElementById('nextBtn');
  const detailTitle = document.getElementById('detail-title');
  const detailBreadcrumb = document.getElementById('detail-breadcrumb');
  const detailHero = document.querySelector('.plant-hero');

  // Placeholders for images
  const LQ_PLACEHOLDER = 'data:image/svg+xml;utf8,' + encodeURIComponent(
    `<svg xmlns="http://www.w3.org/2000/svg" width="1200" height="800"><rect width="100%" height="100%" fill="#0f1320"/><text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle" fill="#a5b4c3" font-family="system-ui" font-size="22">image loading…</text></svg>`
  );
  const PLACEHOLDER = 'data:image/svg+xml;utf8,' + encodeURIComponent(
    `<svg xmlns="http://www.w3.org/2000/svg" width="1200" height="800"><rect width="100%" height="100%" fill="#0f1320"/><text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle" fill="#a5b4c3" font-family="system-ui" font-size="22">image unavailable</text></svg>`
  );

  const normalizeTextForWeb = (input) => {
    if (!input) return '';
    let s = String(input);
    s = s
      .replace(/â€”/g, '—')
      .replace(/â€“/g, '–')
      .replace(/â€˜|â€™/g, "'")
      .replace(/â€œ|â€�/g, '"')
      .replace(/Â/g, '');
    s = s.replace(/[—–]/g, ' - ');
    return s.replace(/\s+/g, ' ').trim();
  };

  function updateMeta(id, content){
    if (!content) return;
    let el = document.getElementById(id);
    if (!el) {
      el = document.querySelector(`meta[name="${id}"]`) || document.querySelector(`meta[id="${id}"]`);
    }
    if (!el) {
      el = document.querySelector(`meta[property="${id}"]`);
    }
    if (el) {
      el.setAttribute('content', content);
    }
  }

  /* ---------- Data source: static JSON from GitHub Pages ---------- */
  async function fetchPlants() {
    const res = await fetch(
      '/data/howker-plants',
      { mode: 'cors' }
    );
    if (!res.ok) {
      throw new Error(`HTTP ${res.status}`);
    }
    return res.json();
  }

  /* ---------- Carousel and Details Rendering ---------- */
  function buildCarousel(images, p){
    carouselEl.innerHTML = '';
    dotsEl.innerHTML = '';
    carouselImgs = [];
    if (!images || !images.length){ images = [PLACEHOLDER]; }
    const startingIndex = images.length > 1 ? 1 : 0;
    carouselIdx = startingIndex;
    const timerEl = document.getElementById('carouselTimer');
    images.forEach((src, i)=>{
      const slide = document.createElement('div');
      slide.className = 'slide' + (i===startingIndex ? ' active' : '');
      const figure = document.createElement('figure');
      const img = document.createElement('img');
      const altBase = (p && p.common) ? p.common : 'Plant';
      const descSnippet = (p && (p.morph || p.teaser || p.desc) || '').trim();
      const altDetail = descSnippet ? ` – ${descSnippet.slice(0, 100)}` : '';
      img.alt = `${altBase}${altDetail} (image ${i+1} of ${images.length})`;
      img.title = (p && (p.desc || p.teaser || p.morph) || '').trim().slice(0, 160);
      img.dataset.desc = (p && p.desc) || '';
      img.dataset.credits = (p && p.credits) || '';
      img.loading = 'lazy';
      img.decoding = 'async';
      if (i===startingIndex){
        img.src = src;
      } else {
        img.setAttribute('data-src', src);
        img.src = LQ_PLACEHOLDER;
      }
      img.onerror = ()=>{ img.onerror=null; img.src=PLACEHOLDER; };
      figure.appendChild(img);
      slide.appendChild(figure);
      const caption = document.createElement('p');
      caption.className = 'sr-only';
      caption.textContent = (p && (p.desc || p.teaser) || '').trim();
      slide.appendChild(caption);
      carouselEl.appendChild(slide);
      carouselImgs.push(img);
      const dot = document.createElement('button');
      dot.type = 'button';
      dot.className = 'dot' + (i===startingIndex ? ' active' : '');
      dot.style.backgroundImage = `url('${src}')`;
      dot.setAttribute('aria-label', `View photo ${i + 1}`);
      dot.title = dot.getAttribute('aria-label');
      dot.addEventListener('click', ()=>goTo(i, true));
      dotsEl.appendChild(dot);
    });
    const media = document.querySelector('.media');
    prevBtn.onclick = () => prev(true);
    nextBtn.onclick = () => next(true);
    media.onmouseenter = stopCarousel;
    media.onmouseleave = startCarousel;
    media.onfocusin = stopCarousel;
    media.onfocusout = startCarousel;
    if (timerEl){
      timerEl.hidden = images.length <= 1;
    }
    startCarousel();
  }
  function updateSlides(){
    const slides = Array.from(document.querySelectorAll('.slide'));
    const dots = Array.from(document.querySelectorAll('.dot'));
    slides.forEach((s, i)=> s.classList.toggle('active', i===carouselIdx));
    dots.forEach((d, i)=> d.classList.toggle('active', i===carouselIdx));
  }
  function ensureImgLoaded(i){
    const img = carouselImgs[i]; if (!img) return;
    const real = img.getAttribute('data-src');
    if (real){
      img.src = real;
      img.removeAttribute('data-src');
    }
  }
  function next(manual=false){
    carouselIdx = (carouselIdx + 1) % carouselImgs.length;
    ensureImgLoaded(carouselIdx);
    updateSlides();
    if (manual){
      restartCarousel();
    }
  }
  function prev(manual=false){
    carouselIdx = (carouselIdx - 1 + carouselImgs.length) % carouselImgs.length;
    ensureImgLoaded(carouselIdx);
    updateSlides();
    if (manual){
      restartCarousel();
    }
  }
  function goTo(i, manual=false){
    carouselIdx = i % carouselImgs.length;
    ensureImgLoaded(carouselIdx);
    updateSlides();
    if (manual){
      restartCarousel();
    }
  }
  function startCarousel(){
    stopCarousel();
    if (carouselImgs.length <= 1){
      updatePauseButton(false);
      return;
    }
    if (isCarouselPaused){
      updatePauseButton(true);
      return;
    }
    currentDelay = BASE_DELAY + Math.floor(Math.random()*2000);
    startTimer(currentDelay);
    carouselTimer = setInterval(() => {
      next(false);
      startTimer(currentDelay);
    }, currentDelay);
    updatePauseButton(false);
  }
  function stopCarousel(){
    if (carouselTimer){
      clearInterval(carouselTimer);
      carouselTimer=null;
    }
    if (timerInterval){
      clearInterval(timerInterval);
      timerInterval = null;
    }
  }

  function updatePauseButton(paused=isCarouselPaused){
    const btn = document.getElementById('carouselPauseBtn');
    if (!btn) return;
    btn.textContent = paused ? '▶' : '❚❚';
    btn.setAttribute('aria-pressed', paused);
    btn.setAttribute('aria-label', paused ? 'Resume carousel' : 'Pause carousel');
    btn.title = paused ? 'Resume carousel' : 'Pause carousel';
  }

  function pauseCarousel(){
    if (isCarouselPaused) return;
    isCarouselPaused = true;
    stopCarousel();
    updatePauseButton(true);
  }

  function resumeCarousel(){
    if (!isCarouselPaused) return;
    isCarouselPaused = false;
    startCarousel();
    updatePauseButton(false);
  }

  function restartCarousel(){
    if (isCarouselPaused) return;
    startCarousel();
  }

  function toggleCarouselPause(){
    if (isCarouselPaused){
      resumeCarousel();
    } else {
      pauseCarousel();
    }
  }

  const pauseBtn = document.getElementById('carouselPauseBtn');
  if (pauseBtn){
    pauseBtn.addEventListener('click', toggleCarouselPause);
    updatePauseButton(false);
  }

  function startTimer(duration){
    const ring = document.getElementById('timerRing');
    const textEl = document.getElementById('timerText');
    if (!ring || !textEl) return;

    const radius = 18;
    const circumference = 2 * Math.PI * radius;
    ring.style.strokeDasharray = circumference;
    ring.style.strokeDashoffset = 0;

    const start = Date.now();
    const end = start + duration;

    if (timerInterval) clearInterval(timerInterval);

    timerInterval = setInterval(() => {
      const now = Date.now();
      const remaining = Math.max(end - now, 0);
      const percent = remaining / duration;
      const offset = circumference * (1 - percent);
      ring.style.strokeDashoffset = offset;
      const secs = Math.ceil(remaining / 1000);
      textEl.textContent = secs;
      if (remaining <= 0){
        clearInterval(timerInterval);
        timerInterval = null;
      }
    }, 100);

    textEl.textContent = Math.ceil(duration / 1000);
  }

  /* ---------- Populate details ---------- */
  function populatePlant(p){
    const detailName = p.common || 'Plant';
    const titleText = `${detailName} • Howker Ridge Plant Catalog`;
    const headerText = `Howker Ridge • ${detailName}`;
    const descText = `Details for ${p.common || 'a plant'}${p.latin ? ` (${p.latin})` : ''} observed along the Howker Ridge Trail in the White Mountains of New Hampshire.`;
    document.title = titleText;
    updateMeta('meta-description', descText);
    updateMeta('og-title', titleText);
    updateMeta('og-description', descText);
    updateMeta('twitter-title', titleText);
    updateMeta('twitter-description', descText);
    if (detailTitle){
      detailTitle.textContent = headerText;
    }
    if (detailBreadcrumb){
      detailBreadcrumb.textContent = detailName;
    }

    document.getElementById('d-title').textContent = p.common || '';
    document.getElementById('d-latin').textContent = p.latin || '';
    document.getElementById('d-tags').innerHTML = `
      ${p.type ? `<span class="chip">${p.type}</span>` : ''}
      ${p.habitat ? `<span class="chip">${p.habitat}</span>` : ''}
      ${(p.tags||[]).map(t=>`<span class="chip">${t}</span>`).join("")}
    `;
    document.getElementById('f-type').textContent    = p.type      || "—";
    document.getElementById('f-elev').textContent    = p.elevation || "—";
    document.getElementById('f-habitat').textContent = p.habitat   || "—";
    document.getElementById('f-bloom').textContent   = p.bloom     || "—";
    document.getElementById('f-morph').textContent   = p.morph     || "—";
    document.getElementById('f-similar').textContent = p.similar   || "—";
    document.getElementById('f-ecology').textContent = p.ecology   || "—";
    document.getElementById('f-status').textContent  = p.status    || "—";

    const desc = (p.desc || p.teaser || "").trim();
    document.getElementById('d-desc').textContent = desc;
    if (desc) document.getElementById('sec-desc').removeAttribute('hidden');

    const notes = [p.fieldNotes1, p.fieldNotes2, p.fieldNotes3, p.fieldNotes4].filter(Boolean);
    document.getElementById('d-notes').innerHTML = notes.map(n=>`<li>${n}</li>`).join("");
    if (notes.length > 0) document.getElementById('sec-notes').removeAttribute('hidden');

    const credits = (p.credits || "").trim();
    document.getElementById('d-credits').textContent = credits;
    if (credits) document.getElementById('sec-credits').removeAttribute('hidden');

    const imgs = Array.isArray(p.imgs) && p.imgs.length ? p.imgs : (p.img ? [p.img] : []);
    buildCarousel(imgs, p);

    const heroCandidate = [imgs[1], imgs[0]].find(src => typeof src === 'string' && src.trim().length > 0);
    if (detailHero && heroCandidate){
      detailHero.style.backgroundImage = `url("${heroCandidate}")`;
    }

    const firstImage = Array.isArray(p.imgs) && p.imgs.length ? p.imgs[0] : (p.img || '');
    const caption = normalizeTextForWeb(`${p.common || ''} - ${p.teaser || p.desc || p.morph || ''}`.trim());
    if (firstImage){
      updateMeta('og-image', firstImage);
      updateMeta('twitter-image', firstImage);
    }
    if (caption){
      updateMeta('og-image-alt', caption);
      updateMeta('twitter-image-alt', caption);
    }

    const imagesList = imgs.map(src => ({
      '@type': 'ImageObject',
      'url': src,
      'caption': normalizeTextForWeb(p.desc || p.teaser || p.morph || ''),
      'license': 'https://creativecommons.org/licenses/by/4.0/'
    }));
    const jsonLd = {
      '@context': 'https://schema.org',
      '@type': 'WebPage',
      'name': document.title,
      'image': imagesList
    };
    const jsonLdEl = document.getElementById('plant-images-jsonld');
    if (jsonLdEl) {
      jsonLdEl.textContent = JSON.stringify(jsonLd);
    }
  }

  /* ---------- Init for details page ---------- */
  (async function initDetails(){
    // parse id from query string or path (/plant/{id})
    const params = new URLSearchParams(window.location.search);
    const pathMatch = window.location.pathname.match(/\/plant\/([^/]+)\/?$/);
    const plantId = params.get('id') || (pathMatch ? decodeURIComponent(pathMatch[1]) : null);
    if (!plantId){
      // No id provided
      document.getElementById('d-title').textContent = 'Plant not specified';
      document.title = 'Plant not specified • Howker Ridge Plant Catalog';
      if (detailTitle){
        detailTitle.textContent = 'Howker Ridge • Plant not specified';
      }
      if (detailBreadcrumb){
        detailBreadcrumb.textContent = 'Plant not specified';
      }
      return;
    }
    try{
      const items = await fetchPlants();
      PLANTS = items;
      const p = PLANTS.find(item => String(item.id) === String(plantId));
      if (p){
        populatePlant(p);
      } else {
        document.getElementById('d-title').textContent = 'Plant not found';
        document.title = 'Plant not found • Howker Ridge Plant Catalog';
        if (detailTitle){
          detailTitle.textContent = 'Howker Ridge • Plant not found';
        }
        if (detailBreadcrumb){
          detailBreadcrumb.textContent = 'Plant not found';
        }
      }
    }catch(err){
      console.error(err);
      document.getElementById('d-title').textContent = 'Error loading plant';
      document.title = 'Error loading plant • Howker Ridge Plant Catalog';
      if (detailTitle){
        detailTitle.textContent = 'Howker Ridge • Error loading plant';
      }
      if (detailBreadcrumb){
        detailBreadcrumb.textContent = 'Error loading plant';
      }
    }
  })();

  // Keyboard shortcuts for carousel navigation
  window.addEventListener('keydown', (e)=>{
    if (e.target && (/input|select|textarea/i).test(e.target.tagName)) return;
    if (e.key === 'ArrowRight') { next(); }
    if (e.key === 'ArrowLeft')  { prev(); }
  });
</script>
<div id="footer-placeholder"></div>
</body>
</html>
