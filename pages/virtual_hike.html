<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Virtual Hike of NH’s 4,000‑Footers – NH48</title>
<meta name="description" content="Take a virtual hike across New Hampshire’s 4,000‑foot peaks.  Explore interactive 3D models, photos and route information without leaving home.">
<meta name="robots" content="noindex,follow">
<link rel="canonical" href="https://nh48.info/virtual_hike.html">
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "WebPage",
  "name": "Virtual Hike of NH’s 4,000‑Footers",
  "url": "https://nh48.info/virtual_hike.html",
  "description": "Interactive virtual hike across all 48 of New Hampshire’s 4,000‑foot mountains."
}
</script>
<link rel="icon" type="image/png" href="../WMNF_Trails_API_logo.png">
<link href="https://cdnjs.cloudflare.com/ajax/libs/cesium/1.109.0/Widgets/widgets.min.css" rel="stylesheet">
<link rel="stylesheet" href="../css/virtual_hike.css">
<link rel="stylesheet" href="/css/quick-browse-footer.css">
</head>
<body>
<div id="toolbar">
  <h2 id="trailName">Virtual Hike</h2>
  <button id="playBtn">Fly Trail</button>
  <button id="clearBtn">Clear Markers</button>
</div>
<div id="cesiumContainer"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/cesium/1.109.0/Cesium.min.js"></script>
<script>
// Helper to get query parameters
function getQueryParam(name) {
  const params = new URLSearchParams(window.location.search);
  return params.get(name);
}

// Main async function to initialize the virtual hike
async function init() {
  const trail = getQueryParam('trail');
  const decoded = trail ? decodeURIComponent(trail) : '';
  document.getElementById('trailName').textContent = decoded ? decoded + ' — Virtual Hike' : 'Virtual Hike';

  // Create the Cesium viewer
  const viewer = new Cesium.Viewer('cesiumContainer', {
    terrainProvider: Cesium.createWorldTerrain(),
    animation: false,
    timeline: false,
    sceneModePicker: false,
    baseLayerPicker: false,
    navigationHelpButton: false,
    geocoder: false,
    homeButton: false,
    infoBox: false,
    fullscreenButton: false,
    selectionIndicator: false
  });

  // Store user-added markers
  const userMarkers = [];

  // Add click handler to add markers
  const handler = new Cesium.ScreenSpaceEventHandler(viewer.scene.canvas);
  handler.setInputAction(function(click) {
    const cartesian = viewer.scene.pickPosition(click.position);
    if (Cesium.defined(cartesian)) {
      const marker = viewer.entities.add({
        position: cartesian,
        point: {
          pixelSize: 8,
          color: Cesium.Color.YELLOW,
          outlineColor: Cesium.Color.BLACK,
          outlineWidth: 1
        }
      });
      userMarkers.push(marker);
    }
  }, Cesium.ScreenSpaceEventType.LEFT_CLICK);

  // Clear button to remove all markers
  document.getElementById('clearBtn').addEventListener('click', function() {
    userMarkers.forEach(entity => viewer.entities.remove(entity));
    userMarkers.length = 0;
  });

  // Load the GeoJSON trail data from the bundled copy first, then fall back to mirrors
  const geoUrls = [
    '../data/merged_trails.geojson',
    'https://cdn.jsdelivr.net/gh/natesobol/nh48-api@main/data/merged_trails.geojson',
    'https://raw.githubusercontent.com/natesobol/nh48-api/main/data/merged_trails.geojson',
    'https://unpkg.com/natesobol/nh48-api@main/data/merged_trails.geojson'
  ];
  let geoData;
  for (const url of geoUrls) {
    try {
      const res = await fetch(url, {cache: 'no-cache'});
      if (res.ok) {
        geoData = await res.json();
        break;
      }
    } catch {
      continue;
    }
  }
  if (!geoData) {
    alert('Failed to load trail data.');
    return;
  }

  // Filter features by name
  const features = geoData.features.filter(f => {
    const name = f.properties && f.properties.name;
    return name && name === decoded;
  });
  if (features.length === 0) {
    alert('Trail not found: ' + decoded);
    return;
  }

  // Create a GeoJsonDataSource for the selected trail
  const dataSource = await Cesium.GeoJsonDataSource.load(
    {type: 'FeatureCollection', features: features},
    {
      clampToGround: true,
      stroke: Cesium.Color.ORANGERED,
      strokeWidth: 4
    }
  );
  viewer.dataSources.add(dataSource);

  // Fly to the trail when the page loads
  viewer.flyTo(dataSource.entities, {duration: 3});

  // Play button: fly along the trail path
  document.getElementById('playBtn').addEventListener('click', function() {
    let positions;
    const entity = dataSource.entities.values[0];
    if (entity.polyline && entity.polyline.positions) {
      positions = entity.polyline.positions.getValue(Cesium.JulianDate.now());
    } else if (entity.polygon) {
      positions = entity.polygon.hierarchy.getValue(Cesium.JulianDate.now()).positions;
    }
    if (!positions || positions.length === 0) {
      alert('No positions found for this trail.');
      return;
    }
    // Create a set of sampled positions to fly through
    const total = positions.length;
    const flyPositions = [];
    for (let i = 0; i < total; i += Math.floor(total/100) || 1) {
      flyPositions.push(positions[i]);
    }
    let index = 0;
    function flyNext() {
      if (index >= flyPositions.length) return;
      viewer.camera.flyTo({
        destination: flyPositions[index],
        orientation: {
          heading: viewer.camera.heading,
          pitch: viewer.camera.pitch,
          roll: viewer.camera.roll
        },
        duration: 1.0,
        complete: function() {
          index++;
          flyNext();
        }
      });
    }
    flyNext();
  });
}

init();
</script>
<footer class="nh48-quick-footer" aria-labelledby="nh48-quick-footer-title" data-nh48-quick-footer>
  <div class="nh48-quick-footer__header">
    <div class="nh48-quick-footer__eyebrow">Quick Browse</div>
    <h2 id="nh48-quick-footer-title">Browse NH48 peaks of the White Mountains of New Hampshire</h2>
    <p>Jump directly into every New Hampshire 4,000-footer detail page to strengthen internal linking and keep crawlers flowing through the full NH48 set.</p>
  </div>
  <div class="nh48-quick-footer__grid" aria-label="NH48 quick browse footer links">
    <a class="nh48-quick-footer__link" href="/peaks/mount-washington">Mount Washington</a>
    <a class="nh48-quick-footer__link" href="/peaks/mount-lafayette">Mount Lafayette</a>
    <a class="nh48-quick-footer__link" href="/peaks/mount-lincoln">Mount Lincoln</a>
    <a class="nh48-quick-footer__link" href="/peaks/mount-tecumseh">Mount Tecumseh</a>
    <a class="nh48-quick-footer__link" href="/peaks/mount-moosilauke">Mount Moosilauke</a>
    <a class="nh48-quick-footer__link" href="/peaks/mount-pierce">Mount Pierce</a>
    <a class="nh48-quick-footer__link" href="/peaks/mount-liberty">Mount Liberty</a>
    <a class="nh48-quick-footer__link" href="/peaks/mount-adams">Mount Adams</a>
    <a class="nh48-quick-footer__link" href="/peaks/mount-eisenhower">Mount Eisenhower</a>
    <a class="nh48-quick-footer__link" href="/peaks/mount-osceola">Mount Osceola</a>
    <a class="nh48-quick-footer__link" href="/peaks/mount-jackson">Mount Jackson</a>
    <a class="nh48-quick-footer__link" href="/peaks/mount-monroe">Mount Monroe</a>
    <a class="nh48-quick-footer__link" href="/peaks/mount-jefferson">Mount Jefferson</a>
    <a class="nh48-quick-footer__link" href="/peaks/cannon-mountain">Cannon Mountain</a>
    <a class="nh48-quick-footer__link" href="/peaks/mount-madison">Mount Madison</a>
    <a class="nh48-quick-footer__link" href="/peaks/mount-flume">Mount Flume</a>
    <a class="nh48-quick-footer__link" href="/peaks/mount-garfield">Mount Garfield</a>
    <a class="nh48-quick-footer__link" href="/peaks/mount-carrigain">Mount Carrigain</a>
    <a class="nh48-quick-footer__link" href="/peaks/north-kinsman-mountain">North Kinsman Mountain</a>
    <a class="nh48-quick-footer__link" href="/peaks/south-kinsman-mountain">South Kinsman Mountain</a>
    <a class="nh48-quick-footer__link" href="/peaks/mount-whiteface">Mount Whiteface</a>
    <a class="nh48-quick-footer__link" href="/peaks/mount-passaconaway">Mount Passaconaway</a>
    <a class="nh48-quick-footer__link" href="/peaks/mount-field">Mount Field</a>
    <a class="nh48-quick-footer__link" href="/peaks/mount-tom">Mount Tom</a>
    <a class="nh48-quick-footer__link" href="/peaks/mount-willey">Mount Willey</a>
    <a class="nh48-quick-footer__link" href="/peaks/carter-dome">Carter Dome</a>
    <a class="nh48-quick-footer__link" href="/peaks/mount-moriah">Mount Moriah</a>
    <a class="nh48-quick-footer__link" href="/peaks/south-carter-mountain">South Carter Mountain</a>
    <a class="nh48-quick-footer__link" href="/peaks/middle-carter-mountain">Middle Carter Mountain</a>
    <a class="nh48-quick-footer__link" href="/peaks/mount-hale">Mount Hale</a>
    <a class="nh48-quick-footer__link" href="/peaks/mount-waumbek">Mount Waumbek</a>
    <a class="nh48-quick-footer__link" href="/peaks/mount-isolation">Mount Isolation</a>
    <a class="nh48-quick-footer__link" href="/peaks/mount-cabot">Mount Cabot</a>
    <a class="nh48-quick-footer__link" href="/peaks/north-tripyramid">North Tripyramid</a>
    <a class="nh48-quick-footer__link" href="/peaks/middle-tripyramid">Middle Tripyramid</a>
    <a class="nh48-quick-footer__link" href="/peaks/mount-osceola-east">Mount Osceola – East Peak</a>
    <a class="nh48-quick-footer__link" href="/peaks/wildcat-mountain-d">Wildcat Mountain – D Peak</a>
    <a class="nh48-quick-footer__link" href="/peaks/wildcat-mountain-a">Wildcat Mountain – A Peak</a>
    <a class="nh48-quick-footer__link" href="/peaks/galehead-mountain">Galehead Mountain</a>
    <a class="nh48-quick-footer__link" href="/peaks/zealand-mountain">Zealand Mountain</a>
    <a class="nh48-quick-footer__link" href="/peaks/west-bond">West Bond</a>
    <a class="nh48-quick-footer__link" href="/peaks/mount-bond">Mount Bond</a>
    <a class="nh48-quick-footer__link" href="/peaks/south-twin-mountain">South Twin Mountain</a>
    <a class="nh48-quick-footer__link" href="/peaks/north-twin-mountain">North Twin Mountain</a>
    <a class="nh48-quick-footer__link" href="/peaks/mount-hancock-south">Mount Hancock – South Peak</a>
    <a class="nh48-quick-footer__link" href="/peaks/mount-hancock">Mount Hancock – North Peak</a>
    <a class="nh48-quick-footer__link" href="/peaks/owls-head">Owl's Head</a>
    <a class="nh48-quick-footer__link" href="/peaks/bondcliff">Bondcliff</a>
  </div>
  <div class="nh48-quick-footer__meta">
    <div class="nh48-quick-footer__legal">© 2024 NH48 API · White Mountains data, trails &amp; photos</div>
    <div class="nh48-quick-footer__meta-links" aria-label="Footer navigation links">
      <a href="/catalog">Catalog</a>
      <a href="/trails">WMNF Trails</a>
      <a href="/long-trails">Long Trails</a>
      <a href="https://nh48pics.com" target="_blank" rel="noopener">NH48 Pics</a>
      <a href="https://nh48.app" target="_blank" rel="noopener">Peak Bagger</a>
      <a href="https://www.instagram.com/nate_dumps_pics/" target="_blank" rel="noopener">Latest WMNF Photos</a>
    </div>
  </div>
</footer>
</body>
</html>
