<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Long-Distance Trails – NH48</title>
  <meta name="description" content="Explore long-distance trail campaigns with interactive maps, segment details, and downloadable data on NH48.">
  <link rel="canonical" href="https://nh48.info/long-trails.html">
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    crossorigin=""
  />
  <style>
    * {
      box-sizing: border-box;
    }

    :root {
      --bg-primary: #1a1d23;
      --bg-secondary: #25282f;
      --bg-tertiary: #2d3039;
      --border-color: #3d4048;
      --text-primary: #ffffff;
      --text-secondary: #d9dde5;
      --accent: #4a9eff;
    }

    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      background-color: var(--bg-primary);
      color: var(--text-primary);
    }

    .page-header {
      max-width: 1200px;
      margin: 1.5rem auto 0;
      padding: 0 20px;
    }

    .page-header h1 {
      margin: 0 0 0.35rem;
      font-size: 2rem;
    }

    .page-header p {
      margin: 0.2rem 0;
      color: var(--text-secondary);
      line-height: 1.5;
    }

    #app {
      max-width: 1200px;
      margin: 1.5rem auto 2rem;
      padding: 0 20px;
      display: grid;
      grid-template-columns: minmax(280px, 360px) 1fr;
      gap: 16px;
      height: 70vh;
    }

    .sidebar {
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: 12px;
      padding: 16px;
      overflow-y: auto;
    }

    .map-panel {
      border: 1px solid var(--border-color);
      border-radius: 12px;
      overflow: hidden;
      background: var(--bg-secondary);
    }

    #map {
      height: 100%;
      width: 100%;
      min-height: 360px;
    }

    .trail-details {
      border: 1px solid var(--border-color);
      border-radius: 10px;
      margin-bottom: 12px;
      background: var(--bg-tertiary);
      overflow: hidden;
    }

    .trail-summary {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 12px 14px;
      cursor: pointer;
      font-weight: 600;
    }

    .trail-summary::marker {
      content: '';
    }

    .trail-summary span {
      flex: 1;
    }

    .color-dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      display: inline-block;
    }

    .trail-meta {
      font-size: 0.85rem;
      color: var(--text-secondary);
      margin-left: 22px;
      margin-bottom: 8px;
    }

    .section-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
      padding: 0 14px 14px;
    }

    .section-item {
      padding: 10px 12px;
      border-radius: 8px;
      border: 1px solid transparent;
      background: #20242b;
      cursor: pointer;
      transition: border-color 0.2s ease, background 0.2s ease;
    }

    .section-item:hover {
      border-color: var(--accent);
      background: #242833;
    }

    .section-item.active {
      border-color: var(--accent);
      background: #1f2a38;
    }

    .section-title {
      font-weight: 600;
      margin-bottom: 4px;
    }

    .section-subtitle {
      font-size: 0.85rem;
      color: var(--text-secondary);
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    .legend {
      margin-top: 16px;
      padding-top: 12px;
      border-top: 1px solid var(--border-color);
    }

    .legend h2 {
      font-size: 1rem;
      margin: 0 0 8px;
    }

    .legend-item {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 0.9rem;
      margin-bottom: 6px;
    }

    .empty-state {
      padding: 16px;
      border-radius: 8px;
      background: #20242b;
      border: 1px dashed var(--border-color);
      color: var(--text-secondary);
      margin-top: 12px;
    }

    @media (max-width: 900px){
      #app {
        grid-template-columns: 1fr;
        height: auto;
      }

      .map-panel {
        height: 60vh;
      }
    }
  </style>
</head>
<body>
  <header class="page-header">
    <h1>Long-Distance Trails</h1>
    <p>Explore multi-day trail campaigns with interactive maps, segment details, and color-coded highlights.</p>
    <p>Click a section to fly the map to that segment and inspect its stats.</p>
  </header>

  <main id="app">
    <aside class="sidebar" aria-live="polite">
      <div id="trailList"></div>
      <div class="legend">
        <h2>Trail colors</h2>
        <div id="legendList"></div>
      </div>
    </aside>
    <section class="map-panel">
      <div id="map"></div>
    </section>
  </main>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin=""></script>
  <script>
    const DATA_URLS = [
      '../data/long-trails-index.json',
      '/data/long-trails-index.json'
    ];

    let map;
    let activeSection = null;
    const sectionLayers = new Map();

    function createMap(){
      map = L.map('map', { zoomControl: true });
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
      }).addTo(map);
    }

    function fitBounds(bounds){
      if(!bounds){
        map.setView([44.0, -71.4], 7);
        return;
      }
      const southWest = [bounds.minLat, bounds.minLon];
      const northEast = [bounds.maxLat, bounds.maxLon];
      map.fitBounds([southWest, northEast], { padding: [20, 20] });
    }

    function buildSectionLabel(section){
      if(section.name){
        return section.name;
      }
      const start = section.start && section.start.name ? section.start.name : 'Start';
      const end = section.end && section.end.name ? section.end.name : 'End';
      return `${start} → ${end}`;
    }

    function resetActiveSection(){
      if(!activeSection) return;
      const previous = sectionLayers.get(activeSection.id);
      if(previous){
        previous.lines.forEach(line => line.setStyle({ weight: 3, opacity: 0.7 }));
        previous.markers.forEach(marker => marker.setStyle({ radius: 6, opacity: 0.9, fillOpacity: 0.9 }));
      }
      const previousEl = document.querySelector(`[data-section-id="${activeSection.id}"]`);
      if(previousEl){
        previousEl.classList.remove('active');
      }
      activeSection = null;
    }

    function setActiveSection(section){
      resetActiveSection();
      activeSection = section;
      const layer = sectionLayers.get(section.id);
      if(layer){
        layer.lines.forEach(line => line.setStyle({ weight: 5, opacity: 1 }));
        layer.markers.forEach(marker => marker.setStyle({ radius: 8, opacity: 1, fillOpacity: 1 }));
      }
      const el = document.querySelector(`[data-section-id="${section.id}"]`);
      if(el){
        el.classList.add('active');
      }
    }

    function focusSection(section){
      setActiveSection(section);
      if(section.bounds){
        fitBounds(section.bounds);
      }else if(section.center){
        map.setView([section.center.lat, section.center.lon], 11);
      }
    }

    function addSectionLayers(trail, section){
      const color = trail.color || '#4a9eff';
      const markers = [];
      const lines = [];

      if(section.start && section.start.lat && section.start.lon){
        markers.push(L.circleMarker([section.start.lat, section.start.lon], {
          radius: 6,
          color,
          fillColor: color,
          fillOpacity: 0.9
        }).bindTooltip(`Start: ${section.start.name || ''}`.trim()));
      }
      if(section.end && section.end.lat && section.end.lon){
        markers.push(L.circleMarker([section.end.lat, section.end.lon], {
          radius: 6,
          color,
          fillColor: color,
          fillOpacity: 0.9
        }).bindTooltip(`End: ${section.end.name || ''}`.trim()));
      }

      if(section.gpxGeoJson){
        const line = L.geoJSON(section.gpxGeoJson, {
          style: { color, weight: 3, opacity: 0.7 }
        });
        lines.push(line);
      }

      markers.forEach(marker => marker.addTo(map));
      lines.forEach(line => line.addTo(map));

      sectionLayers.set(section.id, { markers, lines });
    }

    function renderLegend(trails){
      const legend = document.getElementById('legendList');
      legend.innerHTML = '';
      trails.forEach(trail => {
        const item = document.createElement('div');
        item.className = 'legend-item';
        item.innerHTML = `<span class="color-dot" style="background:${trail.color}"></span>${trail.name}`;
        legend.appendChild(item);
      });
    }

    function renderTrailList(trails){
      const container = document.getElementById('trailList');
      container.innerHTML = '';

      if(trails.length === 0){
        const empty = document.createElement('div');
        empty.className = 'empty-state';
        empty.textContent = 'Add trail JSON files to data/long-trails and run scripts/prepare-long-trails.js to populate this view.';
        container.appendChild(empty);
        return;
      }

      trails.forEach(trail => {
        const details = document.createElement('details');
        details.className = 'trail-details';

        const summary = document.createElement('summary');
        summary.className = 'trail-summary';
        summary.innerHTML = `<span class="color-dot" style="background:${trail.color}"></span><span>${trail.name}</span>`;

        const meta = document.createElement('div');
        meta.className = 'trail-meta';
        const distance = trail.stats && (trail.stats.officialLength || trail.stats.distance);
        meta.textContent = distance ? `Official length: ${distance}` : 'Sections available';

        const sectionList = document.createElement('div');
        sectionList.className = 'section-list';
        (trail.sections || []).forEach(section => {
          const item = document.createElement('div');
          item.className = 'section-item';
          item.dataset.sectionId = section.id;
          item.innerHTML = `
            <div class="section-title">${buildSectionLabel(section)}</div>
            <div class="section-subtitle">
              ${section.distance ? `<span>${section.distance} mi</span>` : ''}
              ${section.difficulty && section.difficulty.rating ? `<span>Difficulty: ${section.difficulty.rating}</span>` : ''}
              ${section.jurisdictions && section.jurisdictions.length ? `<span>${section.jurisdictions.join(', ')}</span>` : ''}
            </div>
          `;
          item.addEventListener('click', () => focusSection(section));
          sectionList.appendChild(item);
        });

        details.appendChild(summary);
        details.appendChild(meta);
        details.appendChild(sectionList);
        container.appendChild(details);
      });
    }

    async function loadTrails(){
      for(const url of DATA_URLS){
        try{
          const response = await fetch(url);
          if(!response.ok) continue;
          const data = await response.json();
          return data;
        }catch(error){
          console.warn('Unable to load long trail data:', error);
        }
      }
      return { trails: [], bounds: null };
    }

    async function init(){
      createMap();
      const data = await loadTrails();
      const trails = data.trails || [];
      trails.forEach(trail => {
        (trail.sections || []).forEach(section => addSectionLayers(trail, section));
      });
      renderTrailList(trails);
      renderLegend(trails);
      fitBounds(data.bounds || null);
    }

    window.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>
