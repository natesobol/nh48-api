<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Peak Planning Tool | NH48</title>
    <meta
      name="description"
      content="Plan NH48 day-trip traverses with a drag-and-drop itinerary builder based on popular NH 4,000-footer groupings."
    />
    <link rel="icon" href="/favicons/favicon.ico" sizes="48x48" />
    <link rel="icon" type="image/x-icon" href="/favicons/favicon.ico" />
    <link rel="stylesheet" href="/css/quick-browse-footer.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans:wght@400;600;700&display=swap"
      rel="stylesheet"
    />
    <script type="module" src="/js/i18n.js"></script>
    <style>
      :root {
        --background: #0a0a0a;
        --surface: #111522;
        --card: #171b2b;
        --text: #f8fafc;
        --muted: #cbd5f5;
        --border: rgba(255, 255, 255, 0.14);
        --primary: #22c55e;
        --primary-strong: #4ade80;
        --accent: #38bdf8;
        --shadow: 0 18px 40px rgba(5, 8, 20, 0.45);
      }
      * {
        box-sizing: border-box;
      }
      body {
        margin: 0;
        font-family: 'Noto Sans', system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
        background: var(--background);
        color: var(--text);
        -webkit-font-smoothing: antialiased;
      }
      a {
        color: var(--primary);
      }
      a:hover {
        color: var(--primary-strong);
      }
      .wrap {
        max-width: 1200px;
        margin: 0 auto;
        padding: 18px 20px 70px;
      }
      .section {
        margin: 30px 0;
      }
      .section-banner {
        position: relative;
        width: 100%;
        min-height: 250px;
        background-size: cover;
        background-position: center;
        border-radius: 16px;
        padding: 22px 24px;
        margin-bottom: 16px;
        display: flex;
        align-items: flex-end;
        box-shadow: var(--shadow);
        overflow: hidden;
      }
      .section-banner::before {
        content: '';
        position: absolute;
        inset: 0;
        background: linear-gradient(180deg, rgba(0, 0, 0, 0.25) 0%, rgba(3, 6, 17, 0.75) 80%);
        border-radius: inherit;
        pointer-events: none;
      }
      .section-banner h2 {
        position: relative;
        z-index: 1;
        margin: 0;
        font-size: clamp(1.8rem, 3vw, 2.3rem);
        font-weight: 600;
        text-shadow: 0 2px 12px rgba(0, 0, 0, 0.45);
      }
      .section-banner h2 a {
        text-decoration: none;
        color: #ffffff;
      }
      .planner-shell {
        background: var(--surface);
        border-radius: 18px;
        border: 1px solid var(--border);
        padding: 22px;
        display: grid;
        gap: 18px;
        box-shadow: var(--shadow);
      }
      .strategy-toolbar {
        display: grid;
        gap: 10px;
        padding: 12px;
        border-radius: 14px;
        border: 1px solid rgba(148, 163, 184, 0.25);
        background: rgba(9, 12, 20, 0.45);
      }
      .strategy-toolbar-label {
        font-size: 0.85rem;
        color: var(--muted);
        font-weight: 600;
        letter-spacing: 0.04em;
        text-transform: uppercase;
      }
      .strategy-toolbar-list {
        display: flex;
        gap: 8px;
        overflow-x: auto;
        padding-bottom: 2px;
      }
      .strategy-pill {
        border: 1px solid rgba(148, 163, 184, 0.3);
        background: rgba(15, 23, 42, 0.6);
        color: var(--text);
        border-radius: 999px;
        padding: 6px 12px;
        display: inline-flex;
        align-items: center;
        gap: 8px;
        cursor: pointer;
        white-space: nowrap;
        font-size: 0.85rem;
      }
      .strategy-pill:hover {
        border-color: rgba(56, 189, 248, 0.7);
      }
      .strategy-pill.is-active {
        border-color: rgba(34, 197, 94, 0.8);
        box-shadow:
          0 0 0 1px rgba(34, 197, 94, 0.25) inset,
          0 0 12px rgba(34, 197, 94, 0.28);
        color: #d1fae5;
      }
      .strategy-pill-icon {
        display: inline-flex;
        width: 16px;
        justify-content: center;
      }
      .planner-filters {
        background: rgba(9, 12, 20, 0.55);
        border: 1px solid rgba(56, 189, 248, 0.18);
        border-radius: 16px;
        padding: 16px;
        display: grid;
        gap: 14px;
        box-shadow:
          0 0 0 1px rgba(9, 12, 20, 0.55) inset,
          0 0 20px rgba(56, 189, 248, 0.12);
      }
      .planner-filters.is-disabled {
        opacity: 0.7;
      }
      .filters-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 12px;
      }
      .filters-header h3 {
        margin: 0;
        font-size: 1.1rem;
      }
      .filter-clear {
        border: 1px solid rgba(148, 163, 184, 0.35);
        background: rgba(15, 23, 42, 0.6);
        color: var(--text);
        border-radius: 10px;
        padding: 6px 12px;
        cursor: pointer;
        font-weight: 600;
      }
      .filter-clear:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }
      .filters-grid {
        display: grid;
        gap: 14px;
      }
      .filter-block {
        display: grid;
        gap: 8px;
      }
      .metrics-block {
        gap: 10px;
      }
      .metrics-toggle {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 12px;
        width: 100%;
        background: rgba(9, 12, 20, 0.45);
        border: 1px solid rgba(148, 163, 184, 0.25);
        color: var(--text);
        border-radius: 12px;
        padding: 8px 12px;
        font-weight: 600;
        cursor: pointer;
      }
      .metrics-toggle-icon {
        font-size: 0.8rem;
        color: var(--muted);
        text-transform: uppercase;
        letter-spacing: 0.08em;
      }
      .filter-title {
        font-weight: 600;
        color: var(--muted);
        font-size: 0.95rem;
      }
      .filter-chips {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
      }
      .chip-button {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        border: 1px solid rgba(148, 163, 184, 0.25);
        background: rgba(9, 12, 20, 0.45);
        color: var(--text);
        border-radius: 999px;
        padding: 6px 12px;
        font-size: 0.85rem;
        cursor: pointer;
        transition: border-color 0.2s ease, background 0.2s ease;
      }
      .chip-button:hover {
        border-color: rgba(56, 189, 248, 0.8);
      }
      .chip-button.is-active {
        border: 1px solid var(--chip-color, #38bdf8);
        background: rgba(12, 18, 30, 0.6);
        box-shadow:
          0 0 0 1px rgba(12, 18, 30, 0.45) inset,
          0 0 10px var(--chip-color, #38bdf8);
      }
      .chip-button.is-disabled {
        cursor: not-allowed;
        opacity: 0.6;
      }
      .chip-dot {
        width: 10px;
        height: 10px;
        border-radius: 999px;
        display: inline-block;
      }
      .filter-empty {
        color: var(--muted);
        font-size: 0.85rem;
      }
      .filter-numbers {
        display: grid;
        gap: 8px;
      }
      .filter-numbers label {
        font-size: 0.85rem;
        color: var(--muted);
      }
      .numeric-range {
        display: grid;
        grid-template-columns: 1fr auto 1fr;
        align-items: center;
        gap: 10px;
      }
      .numeric-range input {
        width: 100%;
        min-width: 110px;
        padding: 8px 10px;
        border-radius: 8px;
        border: 1px solid rgba(148, 163, 184, 0.35);
        background: rgba(15, 23, 42, 0.6);
        color: var(--text);
        font-size: 0.9rem;
        min-height: 36px;
      }
      .numeric-range input:disabled {
        opacity: 0.6;
      }
      .range-sep {
        color: var(--muted);
        font-size: 0.85rem;
      }
      .filter-note {
        font-size: 0.85rem;
        color: var(--muted);
      }
      .selection-actions {
        display: flex;
        align-items: center;
        gap: 10px;
        flex-wrap: wrap;
        padding: 10px 12px;
        border-radius: 12px;
        background: rgba(15, 23, 42, 0.45);
        border: 1px solid rgba(148, 163, 184, 0.25);
      }
      .group-status {
        font-size: 0.9rem;
        color: var(--muted);
      }
      .selection-warning {
        font-size: 0.85rem;
        color: #fbbf24;
        padding: 8px 12px;
        border-radius: 10px;
        border: 1px solid rgba(251, 191, 36, 0.4);
        background: rgba(120, 53, 15, 0.15);
      }
      .group-btn {
        border: 1px solid rgba(34, 197, 94, 0.6);
        background: rgba(34, 197, 94, 0.2);
        color: var(--text);
        border-radius: 10px;
        padding: 6px 12px;
        font-weight: 600;
        cursor: pointer;
      }
      .group-btn.ghost {
        border-color: rgba(148, 163, 184, 0.35);
        background: rgba(15, 23, 42, 0.5);
      }
      .group-btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }
      .itinerary-list {
        display: flex;
        flex-direction: column;
        gap: 12px;
      }
      .itinerary-row {
        display: grid;
        grid-template-columns: auto 1fr auto;
        gap: 16px;
        align-items: flex-start;
        padding: 14px 16px;
        border-radius: 14px;
        background: var(--card);
        border: 1px solid rgba(148, 163, 184, 0.2);
        cursor: default;
        transition: transform 0.2s ease, border-color 0.2s ease, background 0.2s ease;
        position: relative;
        z-index: 0;
      }
      .itinerary-row.is-highlighted {
        border-color: var(--highlight-color, #38bdf8);
        box-shadow:
          0 0 0 1px rgba(9, 12, 20, 0.6) inset,
          0 0 14px var(--highlight-color, #38bdf8);
      }
      .itinerary-row.is-selected {
        border-color: rgba(34, 197, 94, 0.6);
        box-shadow: 0 0 0 1px rgba(34, 197, 94, 0.25) inset;
      }
      .itinerary-row > * {
        position: relative;
        z-index: 1;
      }
      .itinerary-row.is-dragging {
        background: rgba(34, 197, 94, 0.1);
        border-color: rgba(34, 197, 94, 0.5);
        transform: scale(1.01);
        transition: none;
      }
      /* Photo banner behind each peak list item */
      .itinerary-photo-banner {
        position: relative;
        background-size: cover;
        background-position: center;
        border-radius: 12px;
        padding: 12px;
        min-height: 86px;
        display: flex;
        flex-direction: column;
        justify-content: center;
        gap: 8px;
        color: #ffffff;
        overflow: hidden;
      }
      /* Dark gradient overlay to improve contrast on light images */
      .itinerary-photo-banner::before {
        content: '';
        position: absolute;
        inset: 0;
        border-radius: inherit;
        background: linear-gradient(180deg, rgba(0, 0, 0, 0.25) 0%, rgba(3, 6, 17, 0.75) 100%);
        pointer-events: none;
        z-index: 0;
      }
      /* Ensure all content sits above the gradient overlay */
      .itinerary-photo-banner > * {
        position: relative;
        z-index: 1;
      }
      .itinerary-index {
        width: 34px;
        height: 34px;
        border-radius: 999px;
        background: linear-gradient(135deg, var(--primary), var(--accent));
        color: #0b111b;
        font-weight: 700;
        display: grid;
        place-items: center;
        box-shadow: 0 4px 12px rgba(34, 197, 94, 0.35);
      }
      .drag-handle {
        cursor: grab;
        touch-action: none;
      }
      .itinerary-details {
        display: grid;
        gap: 6px;
      }
      .itinerary-name-row {
        display: flex;
        align-items: center;
        gap: 10px;
      }
      .row-checkbox {
        width: 16px;
        height: 16px;
        margin: 0;
        accent-color: #22c55e;
        cursor: pointer;
      }
      .itinerary-name {
        font-weight: 600;
        font-size: 1rem;
      }
      .itinerary-meta {
        font-size: 0.85rem;
        color: var(--muted);
      }
      /* Make the peak name and metrics pure white on the image */
      .itinerary-photo-banner .itinerary-name,
      .itinerary-photo-banner .itinerary-meta {
        color: #ffffff;
      }
      .risk-tags {
        display: flex;
        flex-wrap: wrap;
        gap: 6px;
      }
      .risk-tag {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        border-radius: 999px;
        padding: 2px 8px;
        border: 1px solid rgba(148, 163, 184, 0.2);
        font-size: 0.75rem;
        color: var(--muted);
      }
      .risk-tag-dot {
        width: 8px;
        height: 8px;
        border-radius: 999px;
        display: inline-block;
      }
      /* Risk tags overlay: white text, semi-transparent background, subtle border */
      .itinerary-photo-banner .risk-tag {
        border: 1px solid rgba(255, 255, 255, 0.4);
        background: rgba(0, 0, 0, 0.35);
        color: #ffffff;
      }
      .itinerary-photo-banner .risk-tag-dot {
        background: currentColor;
      }
      .itinerary-range {
        font-size: 0.85rem;
        color: var(--muted);
        text-align: right;
      }
      .itinerary-group {
        border: 1px solid transparent;
        border-radius: 14px;
        background:
          linear-gradient(rgba(15, 23, 42, 0.65), rgba(15, 23, 42, 0.65)) padding-box,
          var(--group-border, rgba(148, 163, 184, 0.25)) border-box;
        padding: 12px;
        display: grid;
        gap: 12px;
      }
      .itinerary-group.is-dragging {
        border-color: rgba(56, 189, 248, 0.7);
        box-shadow: 0 10px 24px rgba(56, 189, 248, 0.2);
        transition: none;
      }
      .group-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 12px;
      }
      .group-title {
        display: grid;
        gap: 2px;
      }
      .group-badge {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        font-size: 0.75rem;
        text-transform: uppercase;
        letter-spacing: 0.08em;
        color: var(--group-accent, var(--muted));
      }
      .group-meta {
        font-size: 0.8rem;
        color: var(--muted);
      }
      .group-list {
        display: grid;
        gap: 10px;
      }
      .group-list.is-disabled {
        opacity: 0.85;
        pointer-events: none;
      }
      .group-empty {
        font-size: 0.85rem;
        color: var(--muted);
        border: 1px dashed rgba(148, 163, 184, 0.3);
        border-radius: 12px;
        padding: 10px 12px;
      }
      .group-handle {
        font-size: 0.8rem;
        text-transform: uppercase;
        letter-spacing: 0.1em;
        color: var(--muted);
      }
      .auto-group {
        display: grid;
        gap: 8px;
      }
      .auto-group-toggles {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        align-items: center;
      }
      .toggle-button {
        border: 1px solid rgba(148, 163, 184, 0.3);
        background: rgba(10, 14, 24, 0.5);
        color: var(--text);
        border-radius: 999px;
        padding: 6px 14px;
        font-size: 0.85rem;
        cursor: pointer;
        transition: border-color 0.2s ease, box-shadow 0.2s ease;
      }
      .toggle-button.is-active {
        border-color: rgba(34, 197, 94, 0.85);
        box-shadow:
          0 0 0 1px rgba(10, 14, 24, 0.45) inset,
          0 0 14px rgba(34, 197, 94, 0.35);
        color: #d1fae5;
      }
      .itinerary-empty {
        border: 1px dashed rgba(148, 163, 184, 0.3);
        border-radius: 14px;
        padding: 20px;
        text-align: center;
        color: var(--muted);
        background: rgba(15, 23, 42, 0.4);
      }
      .planner-status {
        color: var(--muted);
        font-size: 0.95rem;
      }
      .context-menu {
        position: fixed;
        z-index: 9999;
        display: grid;
        gap: 6px;
        background: rgba(15, 23, 42, 0.95);
        border: 1px solid rgba(148, 163, 184, 0.35);
        border-radius: 12px;
        padding: 8px;
        min-width: 180px;
        box-shadow: 0 16px 30px rgba(5, 8, 20, 0.5);
      }
      .context-menu button {
        border: 1px solid rgba(148, 163, 184, 0.25);
        background: rgba(9, 12, 20, 0.6);
        color: var(--text);
        border-radius: 8px;
        padding: 6px 10px;
        text-align: left;
        cursor: pointer;
        font-size: 0.85rem;
      }
      .context-menu button:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }
      .strategy-modal-backdrop {
        position: fixed;
        inset: 0;
        background: rgba(2, 6, 23, 0.72);
        backdrop-filter: blur(2px);
        display: grid;
        place-items: center;
        z-index: 9800;
      }
      .strategy-modal {
        width: min(460px, calc(100vw - 36px));
        border-radius: 16px;
        border: 1px solid rgba(148, 163, 184, 0.3);
        background: linear-gradient(145deg, rgba(9, 12, 20, 0.96), rgba(15, 23, 42, 0.96));
        box-shadow: 0 20px 40px rgba(5, 8, 20, 0.55);
        padding: 18px;
        display: grid;
        gap: 12px;
      }
      .strategy-modal h3 {
        margin: 0;
        font-size: 1.1rem;
      }
      .strategy-modal p {
        margin: 0;
        color: var(--muted);
        font-size: 0.92rem;
      }
      .strategy-modal-actions {
        display: flex;
        justify-content: flex-end;
        gap: 10px;
      }
      .planner-status strong {
        color: var(--text);
      }
      @media (max-width: 720px) {
        .filters-header {
          flex-direction: column;
          align-items: flex-start;
        }
        .numeric-range {
          grid-template-columns: 1fr;
        }
        .itinerary-row {
          grid-template-columns: auto 1fr;
          grid-template-rows: auto auto;
        }
        .itinerary-range {
          grid-column: 1 / -1;
          text-align: left;
        }
      }
    </style>
  </head>
  <body data-route="nh48-planner" data-page="nh48-planner">
    <div id="nav-placeholder"></div>
    <script>
      document.addEventListener('DOMContentLoaded', () => {
        const navPlaceholder = document.getElementById('nav-placeholder');
        const footerPlaceholder = document.getElementById('footer-placeholder');
        const activeRoute = document.body.dataset.route || document.body.dataset.page;

        if (navPlaceholder) {
          fetch('/pages/nav.html')
            .then((r) => r.text())
            .then((html) => {
              navPlaceholder.innerHTML = html;
              const links = navPlaceholder.querySelectorAll('.site-nav-links a');
              links.forEach((link) => {
                const routes = (link.dataset.routes || link.dataset.route || '')
                  .split(',')
                  .map((value) => value.trim())
                  .filter(Boolean);

                if (routes.includes(activeRoute)) {
                  link.classList.add('active');
                  link.setAttribute('aria-current', 'page');
                }
              });
              if (window.NH48_I18N && window.NH48_I18N.refreshLangPicker) {
                window.NH48_I18N.refreshLangPicker();
              }
            })
            .catch((err) => console.error('Navigation failed to load', err));
        }

        if (footerPlaceholder) {
          fetch('/pages/footer.html')
            .then((r) => r.text())
            .then((html) => {
              footerPlaceholder.innerHTML = html;
            })
            .catch((err) => console.error('Footer failed to load', err));
        }
      });
    </script>

    <main class="wrap">
      <section class="section" id="peak-planner">
        <div
          class="section-banner"
          style="background-image: url('https://photos.nh48.info/mount-madison/mount-madison__002.jpg');"
        >
          <h2><a href="#peak-planner">Peak Planning Tool</a></h2>
        </div>
        <p>
          Use this interactive planner to organize your NH48 hiking journey. The full list loads
          automatically and starts grouped by difficulty, so easier hikes like Tecumseh and Pierce
          rise to the top while the most demanding peaks sit at the end. Drag peaks to reorder,
          group day-trip classics from the filters, and use the highlighting controls to spot
          risks and route traits without hiding anything. All data comes from the live NH48
          manifest; confirm conditions and routes with official sources.
        </p>
        <div id="planner-root"></div>
      </section>
    </main>

    <div id="footer-placeholder"></div>

    <script type="module" src="/js/nh48-planner.js"></script>
  </body>
</html>
